xui.ui={};(function(){var d=xutil.dom.ieVersion;var j=xutil.dom.addClass;var k=xutil.dom.removeClass;var m=xutil.object.inheritsObject;var h=xutil.number.formatNumber;var t=xutil.date.getQuarterBegin;var p=xutil.date.dateToString;var l=xutil.date.stringToDate;var s=xutil.date.getQuarter;var f=xutil.date.getWeekend;var c=xutil.date.getWorkday;var t=xutil.date.getQuarterBegin;var g=xutil.string.encodeHTML;var w=xutil.object.extend;var z=xutil.fn.bind;var v=xui.XObject;var x=xui.ui.HChart=m(v,function(A){var C=A.el;this._sType="xui-h-chart";j(C,this._sType);A.resizable=false;Highcharts.setOptions(this.CHART_OPTIONS);var B=this._sType;C.innerHTML=['<div class="'+B+'-header">','<div class="'+B+'-legend"></div>',"</div>",'<div class="'+B+'-content"></div>'].join("");this._eLegend=C.childNodes[0].firstChild;this._eContent=C.childNodes[1]});var n=x.prototype;n.CHART_OPTIONS={colors:["#50bfc6","#e9693c","#0ca961","#f6ab1a","#88d915","#0380ea","#3c2dc9","#8e45e9","#f44dce","#e21d3d"],global:{useUTC:false}};var o=["周日","周一","周二","周三","周四","周五","周六"];var e=1000*60*60*24;var u=35;n.EXT_RANGE_SELECTOR_TYPE={thisMonth:function(A){A.type=function(C){var B=new Date(C.newMax);return{newMin:new Date(B.getFullYear(),B.getMonth(),1).getTime()}}},thisQuarter:function(A){A.type=function(B){return{newMin:t(new Date(B.newMax)).getTime()}}},thisYear:function(A){A.type=function(C){var B=new Date(C.newMax);return{newMin:new Date(B.getFullYear(),0,1).getTime()}}},xMonth:function(A){A.type=function(C){var B=new Date(C.newMax);return{newMin:new Date(B.getFullYear(),B.getMonth()-A.count+1,1).getTime()}}},xQuarter:function(A){A.type=function(B){var C=t(new Date(B.newMax));C.setMonth(C.getMonth()-(A.count-1)*3);return{newMin:C.getTime()}}}};var b=n.EXT_AXIS_FORMAT={};b.date={parse:function(A){return A!=null?l(A,"yyyy-MM-dd").getTime():void 0},format:function(A){return p(new Date(A),"yyyy-MM-dd")},formatTooltip:function(B){var A=new Date(B);return p(A,"yyyy-MM-dd")+" ("+o[A.getDay()]+")"},inputFormat:"%Y-%m-%d",minRange:2*24*60*60*1000};b.week={parse:b.date.parse,format:function(D,C){var B=new Date(D);var A=(C||{}).range;return p(r(c(B),A),"yyyy-MM-dd")+"<br>"+p(r(f(B),A),"yyyy-MM-dd")},formatTooltip:function(E,C){var B=new Date(E);var A=(C||{}).range;var F=r(c(B),A);var D=r(f(B),A);return p(F,"yyyy-MM-dd")+" ("+o[F.getDay()]+") ~ "+p(D,"yyyy-MM-dd")+" ("+o[D.getDay()]+")"},formatNavigator:function(C,B){var A=(B||{}).range;return p(r(c(new Date(C)),A),"yyyy-MM-dd")},inputFormat:"%Y-%m-%d",minRange:2*7*24*60*60*1000};b.month={parse:function(A){return A!=null?l(A,"yyyy-MM").getTime():void 0},format:function(A){return p(new Date(A),"yyyy-MM")},inputFormat:"%Y-%m",minRange:2*31*24*60*60*1000};b.quarter={parse:i,format:function(B){var A=new Date(B);return String(A.getFullYear()+"-Q"+s(A))},inputFormat:"%Y-%q",minRange:2*3*31*24*60*60*1000};b.year={parse:function(A){return A!=null?new Date(parseInt(A,10),0,1).getTime():void 0},format:function(A){return new Date(A).getFullYear()},inputFormat:"%Y",minRange:2*366*24*60*60*1000};function i(A){if(A==null){return null}var B=[0,0,3,6,9];A=A.split("-Q");return new Date(parseInt(A[0],10),B[parseInt(A[1],10)],1).getTime()}n.init=function(){};n.setData=function(A,B){A=A||{};this._sChartType=q(A.chartType,"line");this._bSeriesHasValue=null;this._nWidth=A.width;this._nHeight=A.height;this._aXAxis=A.xAxis||[];this._aYAxis=A.yAxis||[];this._aSeries=A.series||[];this._oRangeSelector=A.rangeSelector||{};this._oLegend=A.legend||{};this._sEmptyHTML=A.emptyHTML||"数据为空";!B&&this.render()};n.$setupSeries=function(D){var F=[];var G=this._aXAxis[0];for(var E=0,B,A;A=this._aSeries[E];E++){B={data:[]};B.name=A.name||"";B.yAxis=A.yAxisIndex||0;B.color=A.color||void 0;B.format=A.format||void 0;B.type=q(A.type);A.id!==null&&(B.id=A.id);if(G.type in this.EXT_AXIS_FORMAT){B.data=[];for(var C=0;C<A.data.length;C++){B.data.push([this.EXT_AXIS_FORMAT[G.type].parse(G.data[C]),A.data[C]])}}else{B.data=A.data}F.push(B)}D.series=F};n.$setupTooptip=function(C){var E=this._aXAxis[0];var D=E.type;var F=E.tipCallback;var B=this._aSeries;var A=this.EXT_AXIS_FORMAT[E.type];A=A&&(A.formatTooltip||A.format)||function(G){return G};if(this._sChartType=="bar"){C.tooltip={useHTML:false,shared:true,borderColor:"#11A4F2",formatter:F||function(){var G=[];G.push('<span style="color:#4770A7;font-size:13px;font-weight:bold;font-family:"微软雅黑",Arial">',A(this.x,{range:E.range}),"</span><br>");for(var H=0,I;I=this.points[H];H++){if(I.series.name!=null){G.push('<span style="color:'+I.series.color+';font-size:12px;font-weight:bold">'+I.series.name+": </span>")}G.push('<span style="color:#000;font-size:12px;font-family:Arial">'+I.point.config[2]+"</span>");if(I.point.config[3]!=null){G.push(' <span style="color:#000;font-size:12px;font-family:Arial">( '+I.point.config[3]+" )</span>")}if(H<this.points.length-1){G.push("<br>")}}return G.join("")}}}else{C.tooltip={useHTML:false,shared:true,borderColor:"#11A4F2",formatter:F||function(){var G=[];G.push('<span style="color:#4770A7;line-height:20px;font-size:13px;font-weight:bold;font-family:"微软雅黑",Arial">',A(this.x,{range:E.range}),"</span><br />");for(var H=0,I;I=this.points[H];H++){sFormat=B[H].format;if(I.series.name!=null){G.push('<span style="color:'+I.series.color+';font-size:12px;font-weight:bold">',I.series.name+": ","</span>",'<span style="text-align:right;color:#000;font-size:12px;font-family:Arial">',sFormat!=null?h(I.y,sFormat,null,null,true):I.y,"</span>")}if(H<this.points.length-1){G.push("<br>")}}return G.join("")}}}};n.$setupXAxis=function(L){var H=this;var J=[];for(var K=0,G,D,F;G=this._aXAxis[K];K++){F=G.data;if((D=this.EXT_AXIS_FORMAT[G.type])&&F&&F.length>0&&G.range){G.range=[G.range[0]?D.parse(G.range[0]):null,G.range[1]?D.parse(G.range[1]):null]}var C={gridLineWidth:0,gridLineColor:"#DBDBDB",tickPosition:"inside",tickLength:5,startOnTick:false,lineColor:G.color||"#8CA5C9",lineWidth:2,endOnTick:false,maxPadding:0.002,minRange:(this.EXT_AXIS_FORMAT[G.type]||{}).minRange,tickPositioner:(function(P,M,N,O){return function(R,Q){return a.call(this,P,M,N,O,R,Q)}})(H,G.type,G.type in this.EXT_AXIS_FORMAT,G.useYearMonthAdjust),tickPixelInterval:G.tickPixelInterval!=null?G.tickPixelInterval:void 0,title:this._aXAxis[K].title!=null?{enabled:true,text:this._aXAxis[K].title,align:"high",rotation:0,tickInterval:1,offset:0,y:-12,x:10}:void 0,labels:{overflow:void 0,formatter:(function(N,M){return function(){var O=N[M.type];return O?O.format.call(null,this.value,{range:M.range}):this.value}})(this.EXT_AXIS_FORMAT,G),style:{fontFamily:"Arial,Serif,Times",fontSize:"12px",color:"#6B6B6B"}}};if(F&&!(this._aXAxis[K].type in this.EXT_AXIS_FORMAT)){C.categories=F}if(this._aXAxis[K].plotLines!=null){C.plotLines=[];for(var E=0,B,I,A;B=this._aXAxis[K].plotLines[E];E++){if(B.value!=null){B.value=this.EXT_AXIS_FORMAT[this._aXAxis[K].type].parse(B.value);C.plotLines.push(B)}else{if(B.valueBefore!=null||B.valueAfter!=null){I=B.valueBefore!=null?B.valueBefore:B.valueAfter;A=B.valueAfter!=null?B.valueAfter:B.valueBefore;B.value=Math.round((this.EXT_AXIS_FORMAT[this._aXAxis[K].type].parse(I)+this.EXT_AXIS_FORMAT[this._aXAxis[K].type].parse(A))/2);C.plotLines.push(B)}}}}J.push(C)}L.xAxis=!J.length?void 0:(J.length>1?J:J[0])};n.$setupYAxis=function(C){var B=[];var H=["right","left"];var F=[false,true];var E=[-7,5];for(var D=0,A,G;A=this._aYAxis[D];D++){G={gridLineWidth:1,gridLineColor:"#DBDBDB",lineColor:A.color||"#8CA5C9",lineWidth:2,tickPosition:"inside",tickmarkPlacement:"on",labels:{align:H[D%2],x:this._sChartType=="bar"?20:E[D%2],style:{fontFamily:"Arial,Serif,Times",fontSize:"11px",color:"#6B6B6B"},formatter:A.format?(typeof A.format=="string"?(function(I){return function(){return h(this.value,I,null,null,true)}})(A.format):A.format):void 0},opposite:F[D%2],title:(A.title!=null&&this.$seriesHasValue())?w({enabled:true,align:"high",rotation:0,x:30,y:-10},A.title):void 0};if(this._sChartType=="bar"){G.tickPixelInterval=210;G.min=A.min}B.push(G)}C.yAxis=!B.length?{}:(B.length>1?B:B[0])};n.$seriesHasValue=function(){if(this._bSeriesHasValue!=null){return this._bSeriesHasValue}for(var C=0,A;C<this._aSeries.length;C++){if((A=this._aSeries[C])&&A.data&&A.data.length){var D=false;for(var B=0;B<A.data.length;B++){if(A.data[B]!=null){D=true}}if(D){return this._bSeriesHasValue=true}}}return this._bSeriesHasValue=false};n.$setupPlotOptions=function(E){var D=E.plotOptions=E.plotOptions||{};var C=D.series=D.series||{};var G=D.column=D.column||{};if(!d){G.shadow=true;G.borderWidth=1}var B=false;for(var F=0,A;A=this._aSeries[F];F++){A.stack&&(B=true)}B&&(C.stacking="normal")};n.$setupLegend=function(C){if(this._oLegend.xMode=="pl"){var E=this._sType;this._eLegend.style.marginRight=u+"px";for(var D=0,F,A,B;A=this._aSeries[D];D++){F=document.createElement("span");j(F,E+"-legend-item");B=A.color||this.CHART_OPTIONS.colors[D];F.style.backgroundColor=B;F.setAttribute("rel",B);F.innerHTML=g(A.name)+'<span class="'+E+'-legend-item-icon"></span>';this._eLegend.appendChild(F);F.onclick=z(this.$handleLegendClick,this,D,F)}C.legend={enabled:false}}else{C.legend={enabled:true,align:"center",borderColor:"#FFF",verticalAlign:"top",margin:15}}};n.$handleLegendClick=function(A,D){var B=0;var C=this._sType;this.$foreachSeries(function(F,G){if(F&&F.visible){B++}});var E=this._oChart.series[A];if(!E){return}if(E.visible){if(B<=1){return}else{E.hide();j(D,C+"-legend-item-hidden");D.style.background="#B9B9B9"}}else{E.show();k(D,C+"-legend-item-hidden");D.style.background=D.getAttribute("rel")}};n.$setupZoom=function(C){var D=this._aXAxis[0];var A=D.type;C.chart=C.chart||{};C.navigator=C.navigator||{};if(A in this.EXT_AXIS_FORMAT){C.navigator.enabled=true;C.scrollbar={enabled:true};C.chart.zoomType="x";y.call(this,C,true)}else{C.navigator.enabled=false;C.chart.zoomType="";C.scrollbar={enabled:false};y.call(this,C,false)}if(C.navigator.enabled){C.navigator.height=30;C.navigator.series={dataGrouping:{smoothed:false}};var B=this.EXT_AXIS_FORMAT[D.type];B=B&&B.formatNavigator||B.format;C.navigator.xAxis={labels:{formatter:function(){return B?B.call(null,this.value,{range:D.range}):this.value},style:{fontFamily:"Arial",fontSize:"11px"}}}}};function y(J,F){var G;var C;var H=this._aXAxis[0].type;if(!F){J.rangeSelector={enabled:false};return}var E=this._oRangeSelector;var A=E.byAxisType?E.byAxisType[H]:E;if(A){G=[];for(var D=0,B,I;D<A.buttons.length;D++){G.push(B=w({},A.buttons[D]));if(I=this.EXT_RANGE_SELECTOR_TYPE[B.type]){I(B)}}C=A.selected}else{if(H=="date"){G=[{type:"month",count:1,text:"1月"},{type:"month",count:3,text:"3月"},{type:"month",count:6,text:"6月"},{type:"year",count:1,text:"1年"},{type:"all",text:"全部"}];C=4}else{if(H=="month"){G=[{type:"month",count:6,text:"6月"},{type:"year",count:1,text:"1年"},{type:"all",text:"全部"}];C=2}else{G=[{type:"all",text:"全部"}];C=0}}}J.rangeSelector={enabled:true,buttons:G,selected:C,buttonTheme:{fill:"none",stroke:"none",style:{color:"#282828",fontFamily:"微软雅黑, Arial"},states:{hover:{fill:"white",stroke:"#50bfc6"},select:{fill:"#d7ebf6",stroke:"#50bfc6"}}},inputEnabled:true,inputDateFormat:this.EXT_AXIS_FORMAT[H].inputFormat,inputEditDateFormat:this.EXT_AXIS_FORMAT[H].inputFormat,inputStyle:{color:"#3784b7",fontWeight:"bold"},labelStyle:{color:"#b0b0b0",fontWeight:"bold"}}}function a(J,K,P,L,N,O){var C=this;var W=[];var G=C.series[0];if(!G){return[N,O]}var D=G.processedXData;var X;var A;var E;var I;var Y;for(var Q=0,T,R=D.length;Q<R;Q++){T=D[Q];if(T==null){continue}if(T>=N&&(T-N<X||typeof X=="undefined")){E=Q;X=T-N}if(T<=O&&(O-T<A||typeof A=="undefined")){I=Q;A=O-T}}if(typeof I=="undefined"||typeof E=="undefined"){return[N,O]}Y=I-E+1;if(L&&K=="date"&&(Y==365||Y==366)){var B={"4":1,"6":1,"9":1,"11":1};var S=new Date(D[I]);var U=S.getDate();var V=S.getMonth();var M=S.getFullYear();while(true){if(V+1==2&&U>=29){S=new Date(M,V,29);if(S.getMonth()+1!=2){S=new Date(M,V,28)}}else{if(V+1 in B&&U>=31){S=new Date(M,V,30)}else{S=new Date(M,V,U)}}if(S.getTime()<D[E]){break}W.splice(0,0,S.getTime());(V<=0)?((V=11)&&(M--)):(V--)}}else{var H=J._aXAxis[0].splitNumber==null?(P?5:Y):J._aXAxis[0].splitNumber;var F=Math.ceil(Y/H);for(Q=I;Q>=E;Q-=F){W.splice(0,0,D[Q])}}return W}function r(B,A){if(!A||!B){return B}var C=B.getTime();if(C<A[0]){return new Date(A[0])}else{if(A[1]<C){return new Date(A[1])}}return B}function q(A,B){if(A=="bar"){return"column"}return A||B||"line"}n.sortPoints=function(C){if(!C){return null}var D=[];for(var B=0,A=C.length;B<A;B++){D.push(C[B])}return D.sort(function(F,E){if(!F){return -1}if(!E){return 1}if(F.y>E.y){return -1}else{if(F.y<E.y){return 1}else{return 0}}})};n.$foreachSeries=function(C){for(var B=0,A=this._aSeries.length;B<A;B++){C(this._oChart.series[B],B)}};n.render=function(){this.$disposeChart();if(!this._aSeries||this._aSeries.length==0){this._eContent.innerHTML='<div class="'+this._sType+'-empty">'+this._sEmptyHTML+"</div>";return}this.$createChart(this.$initOptions())};n.$createChart=function(A){if(this._aXAxis[0].type in this.EXT_AXIS_FORMAT){this._oChart=new Highcharts.StockChart(A)}else{this._oChart=new Highcharts.Chart(A)}};n.$initOptions=function(){var A={chart:{type:this._sChartType,renderTo:this._eContent,zoomType:"x",width:this._nWidth,height:this._nHeight},credits:{enabled:false},title:{text:""}};if(this._aYAxis.length>0){A.chart.marginRight=u}this.$setupSeries(A);this.$setupPlotOptions(A);this.$setupXAxis(A);this.$setupYAxis(A);this.$setupTooptip(A);this.$setupLegend(A);this.$setupZoom(A);return A};n.$disposeChart=function(){if(this._oChart){this._oChart.destroy();this._oChart=null}this._eContent&&(this._eContent.innerHTML="");this._eLegend&&(this._eLegend.innerHTML="")};n.dispose=function(){this.$disposeChart();n.superClass.dispose.call(this)}})();