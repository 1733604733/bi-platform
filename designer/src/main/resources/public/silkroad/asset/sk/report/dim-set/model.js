define(["url"],function(a){var b=Backbone.Model.extend({defaults:{defaultDate:{level:[{id:"TimeYear",name:"年"},{id:"TimeQuarter",name:"季"},{id:"TimeMonth",name:"月"},{id:"TimeWeekly",name:"周"},{id:"TimeDay",name:"日"}],dateFormatOptions:{TimeDay:["yyyy-MM-dd","yyyy/MM/dd"],TimeWeekly:["yyyy-W","yyyy/W"],TimeMonth:["yyyy-MM","yyyy/MM"],TimeQuarter:["yyyy-QQ","yyyy/QQ"],TimeYear:["yyyy"]}},id:"report1"},initialize:function(){},getDimSetData:function(){var b,c=this;$.ajax({url:a.getDimSetList(c.get("id")),success:function(a){0===a.status&&(b=a.data,c.set("cubes",b.cubes),c.set("relationTables",b.relationTables),c.set("dateRelationTables",b.dateRelationTables),c.set("dim",c._buildDefaultData(b.dim)),c.trigger("getDimSetDataSucess"))}})},_buildDefaultData:function(a){var b,c,d,e;b=a.normal;for(var f=0,g=b.length;g>f;f++)0===b[f].children.length&&a.normal[f].children.push({currDim:"",relationTable:"",field:""});c=a.date;for(var f=0,g=c.length;g>f;f++)0===c[f].children.length&&a.date[f].children.push({relationTable:"0",currDim:"0",field:"0",format:"0"});d=a.callback;for(var f=0,g=d.length;g>f;f++)0===d[f].children.length&&a.callback[f].children.push({address:"",refreshType:1,currDim:""});e=a.custom;for(var f=0,g=e.length;g>f;f++)0===e[f].children.length&&a.custom[f].children.push({dimName:"",sql:""});return a},buildNormalData:function(){var a=this,b={};return b.dim={},b.dim.normal=a.get("dim").normal,b.relationTables=a.get("relationTables"),b.cubes=a.get("cubes"),b},buildNormalNewLineData:function(a){var b=this,c={};return c.relationTables=b.get("relationTables"),c.currDims=b.get("cubes")[a].currDims,c},getFieldListByRelationTable:function(a){for(var b=this,c=b.get("relationTables"),d=0,e=c.length;e>d;d++)if(c[d].name===a)return c[d].fields;return null},buildDateData:function(){var a=this,b={};return b.dim={},b.dim.date=a.get("dim").date,b.dateRelationTables=a.get("dateRelationTables"),b.defaultDate=a.get("defaultDate"),b.cubes=a.get("cubes"),b},getDateTypeByDateLevel:function(a){return this.get("defaultDate").dateFormatOptions[a]},buildDateFieldsData:function(b,c,d){var e,f=this,g={},h=f.get("cubes");"0"===b?(g.tableId=b,g.level=[],g.dateFormatOptions={},f.trigger("getDateFieldsDataSucess",g,d)):"ownertable"===b?(g.tableId=b,g.currDims=h[c].currDims,e=f.get("defaultDate"),g.fields=e.level,f.trigger("getDateFieldsDataSucess",g,d)):$.ajax({url:a.getDimDateRelationTableList(f.get("id"),b),success:function(a){0===a.status&&(g.tableId=b,g.currDims=h[c].currDims,g.fields=a.data.fields,g.dateFormatOptions=a.data.dateFormatOptions,f.trigger("getDateFieldsDataSucess",g,d))}})},buildCallbackData:function(){var a=this,b={};return b.dim={},b.dim.callback=a.get("dim").callback,b.relationTables=a.get("relationTables"),b.cubes=a.get("cubes"),b},buildCallbackNewLineData:function(a){var b=this,c={};return c.currDims=b.get("cubes")[a].currDims,c.address="",c.refreshType=1,c},buildCustomData:function(){var a=this,b={};return b.dim={},b.dim.custom=a.get("dim").custom,b.cubes=a.get("cubes"),b},submit:function(b){var c=this;$.ajax({url:a.submitDimSetInfo(c.get("id")),type:"POST",data:b,success:function(a){0===a.status&&c.trigger("submitSucess")}})}});return b});