define(["template","dialog","report/edit/drag-ind-dim/main-model"],function(a,b,c){return Backbone.View.extend({initialize:function(a){this.model=new c({id:this.id,parentModel:a.parentView.model}),this.parentView=a.parentView},initAll:function(){this.initDrag(),this.initAcceptDragToGroup(),this.initAcceptIndToOrgDim(),this.initAcceptDimToOrgInd()},initDrag:function(){var a=this;$(".j-olap-element",a.$el).draggable({helper:"clone",appendTo:"body",opacity:.8,zIndex:10,start:function(a,b){b.helper.addClass("olap-element-dragging"),b.helper.find(".icon-letter").remove()},stop:function(a,b){b.helper.removeClass("olap-element-dragging")}})},initAcceptDragToGroup:function(){var a=this;$(".j-dim-group",this.el).sortable({items:".j-sub-dim",axis:"y",stop:function(b,c){var d,e=c.item.prev(),f=c.item.parent().attr("data-id"),g=c.item.attr("data-id");d=e.hasClass("j-group-title")?-1:c.item.prev().attr("data-id"),a.model.sortSubDim(f,g,d)}}),$(".j-dim-group",this.el).droppable({accept:".j-org-dim,.j-time-dim,.j-callback-dim",drop:function(c,d){var e=$(this),f=$(this).attr("data-id"),g=d.draggable.attr("data-id"),h="已存在此维度是否依然执行拖拽进入",i=".j-sub-dim[data-id="+g+"]";e.find(i).length>0&&b.confirm(h,function(){a.model.dimToGroup(f,g)},function(){e.removeClass("active")}),a.model.dimToGroup(f,g),e.removeClass("active")},out:function(){$(this).removeClass("active")},over:function(){$(this).addClass("active")},helper:"clone"})},initAcceptIndToOrgDim:function(){var a=this;$(".j-con-org-dim",this.el).droppable({accept:".j-can-to-dim",drop:function(b,c){$(this).removeClass("active");var d=c.draggable,e=d.attr("data-id");a.model.indDimSwitch("ind","dim",e)},out:function(){$(this).removeClass("active")},over:function(){$(this).addClass("active")},helper:"clone"})},initAcceptDimToOrgInd:function(){var a=this;$(".j-con-org-ind",this.el).droppable({accept:".j-can-to-ind",drop:function(b,c){$(this).removeClass("active");var d=c.draggable,e=d.attr("data-id");a.model.indDimSwitch("dim","ind",e,function(){d.remove(),a.parentView.model.loadIndList()})},out:function(){$(this).removeClass("active")},over:function(){$(this).addClass("active")},helper:"clone"})}})});