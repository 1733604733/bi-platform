define(["template","dialog","report/set-cube/cube-model","report/set-cube/main-template","report/set-cube/cube-list-template"],function(a,b,c,d,e){return Backbone.View.extend({events:{"click .j-root-data-sources-list .j-item":"loadFactTableList","click .j-con-cube-list .j-item":"selectCubes","click .j-root-set-group .j-set-group":"addFormLine","click .j-root-set-group .j-delete":"deleteFormLine","click .j-create-data-sources-link":"enterCreateDataSources","click .j-submit":"submit","click .j-cancel":"cancel"},initialize:function(a){var b=this;this.model=new c({id:this.id}),this.listenTo(this.model,"change:dataSourcesList",function(a,c){var e=d.render({dataSourcesList:c});b.$el.html(e)}),this.listenTo(this.model,"change:factTableList",function(a,c){var d=e.render(c);b.$el.find(".j-con-cube-list").html(d)}),a.edit===!0?b.model.loadSelectedDataSources(function(){b.model.dataSourcesModel.loadDataSourcesList(),b.model.loadFactTableList(!0)}):b.model.dataSourcesModel.loadDataSourcesList(),window.dataInsight.main=this},loadFactTableList:function(a){var b=$(a.target),c=b.attr("data-id"),d=".j-root-data-sources-list .j-item.selected";this.$el.find(d).removeClass("selected"),b.addClass("selected"),this.model.selectedDsId=c,this.model.loadFactTableList()},selectCubes:function(a){var b=$(a.target);b.hasClass("selected")?b.removeClass("selected"):b.addClass("selected")},addFormLine:function(a){var b=$(a.target),c=".j-root-set-group .j-template",d=this.$el.find(c).clone(),e=d.removeClass("hide j-template");b.after(e.addClass("j-item"))},deleteFormLine:function(a){var b=$(a.target);b.parents(".j-item").remove()},enterCreateDataSources:function(){require(["data-sources/create-view"],function(a){new a({el:$(".j-main"),isAdd:!0})})},submit:function(){var a=this,c=".j-con-cube-list .j-item.selected",d=this.$el.find(c),e=this.$el.find(".j-root-set-group .j-item input"),f={};return 0==d.length?(b.error("至少需要选择一个实体表作为cube"),void 0):(c=".j-root-data-sources-list .j-item.selected",f.dataSourceId=this.$el.find(c).attr("data-id"),f.selectedTables=[],d.each(function(){f.selectedTables.push($(this).attr("data-id"))}),f.selectedTables=f.selectedTables.join(","),f.regexps=[],e.each(function(){var a=$(this).val().trim();""!==a&&f.regexps.push(a)}),f.regexps=f.regexps.join(","),this.model.submit(f,function(){window.dataInsight.main.destroy(),require(["report/dim-set/view"],function(b){new b({el:$(".j-main"),id:a.id})})}),void 0)},cancel:function(){window.dataInsight.main.destroy(),require(["report/list/main-view"],function(a){new a({el:$(".j-main")})})},destroy:function(){this.model.clear({silent:!0}),this.stopListening(),this.$el.unbind().empty()}})});