xui.XProject.setNamespaceBase(window.__$DI__NS$__=window.__$DI__NS$__||{});var $namespace=xui.XProject.namespace;var $link=xui.XProject.link;var $end=xui.XProject.end;var $getNamespaceBase=xui.XProject.getNamespaceBase;var di=$namespace("di");$getNamespaceBase().ecui=ecui;$getNamespaceBase().xui=xui;$getNamespaceBase().xutil=xutil;xutil.object.PATH_DEFAULT_CONTEXT=$getNamespaceBase();$namespace("di.config");(function(){var c=xutil.ajax;var f=xutil.lang.isFunction;var d;var b;$link(function(){d=di.config.Lang;b=di.helper.Dialog});var a=$namespace().AJAX=function(){};var e={showWaiting:true};a.handleDefaultFailure=function(g,h,i){switch(g){case 100:case 201:case 301:case 302:case 99999:b.alert(d.SAD_FACE+d.RE_LOGIN,null,true);break;case 333:b.alert(d.SAD_FACE+d.NO_AUTH_SYSTEM);break;case 1:case 403:case 404:case 405:case 500:b.alert(d.SAD_FACE+d.ERROR);break;default:if(f(i)){i(g,h)}else{b.alert(d.SAD_FACE+d.ERROR)}}};a.handleDefaultTimeout=function(){b.hidePrompt()};a.getDefaultParam=function(){var g=new Date(),h=[];h.push("_cltime="+g.getTime());h.push("_cltimezone="+g.getTimezoneOffset());return h.join("&")};a.showWaiting=function(){b.waitingPrompt(d.AJAX_WAITING)};a.hideWaiting=function(){b.hidePrompt()};c.DEFAULT_FAILURE_HANDLER=a.handleDefaultFailure;c.DEFAULT_ONTIMEOUT=a.handleDefaultTimeout;c.DEFAULT_PARAM=a.getDefaultParam;c.SHOW_WAITING_HANDLER=a.showWaiting;c.HIDE_WAITING_HANDLER=a.hideWaiting;c.DEFAULT_OPTIONS=e})();$namespace("di.config");(function(){var c=$namespace().Dict={};c.DEFAULT_MASK_OPACITY=0.5;c.TEST_ATTR="data-o_o-di-test";c.META_STATUS={DISABLED:0,NORMAL:1,SELECTED:2};c.DEFAULT_CLZ_KEY={SNIPPET:"GENERAL_SNIPPET",VCONTAINER:"GENERAL_VCONTAINER",VPART:"GENERAL_VPART"};c.CLZ_DEFS=[{clzKey:"GENERAL_SNIPPET",clzPath:"di.shared.ui.GeneralSnippet",clzType:"SNIPPET"},{clzKey:"GENERAL_VCONTAINER",clzPath:"di.shared.ui.GeneralVContainer",clzType:"VCONTAINER"},{clzKey:"GENERAL_VPART",clzPath:"di.shared.ui.GeneralVPart",clzType:"VPART"},{clzKey:"GENERAL_COMPONENT",clzPath:"di.shared.ui.InteractEntity",clzType:"COMPONENT"},{clzKey:"DI_TABLE",clzPath:"di.shared.ui.DITable",clzType:"COMPONENT"},{clzKey:"DI_CHART",clzPath:"di.shared.ui.DIChart",clzType:"COMPONENT"},{clzKey:"DI_FORM",clzPath:"di.shared.ui.DIForm",clzType:"COMPONENT"},{clzKey:"OLAP_META_CONFIG",clzPath:"di.shared.ui.OlapMetaConfig",clzType:"COMPONENT"},{clzKey:"DI_TAB",clzPath:"di.shared.ui.DITab",clzType:"VCONTAINER"},{clzKey:"FOLD_PANEL",clzPath:"di.shared.ui.FoldPanel",clzType:"VCONTAINER"},{clzKey:"HIDDEN_INPUT",clzPath:"di.shared.vui.HiddenInput",adapterMethod:{create:"xuiCreate",dispose:"xuiDispose"},clzType:"VUI"},{clzKey:"H_CHART",clzPath:"xui.ui.HChart",adapterMethod:{create:"xuiCreate",dispose:"xuiDispose"},adapterPath:"di.shared.adapter.HChartVUIAdapter",clzType:"VUI"},{clzKey:"OLAP_META_DRAGGER",clzPath:"di.shared.vui.OlapMetaDragger",clzType:"VUI",adapterPath:"di.shared.adapter.MetaConfigVUIAdapter"},{clzKey:"TEXT_LABEL",clzPath:"di.shared.vui.TextLabel",clzType:"VUI",adapterMethod:{create:"xuiCreate",dispose:"xuiDispose"}},{clzKey:"OLAP_META_IND_SELECT",clzPath:"ecui.ui.Select",clzType:"VUI",adapterMethod:{dispose:"ecuiDispose"},adapterPath:"di.shared.adapter.MetaConfigVUIAdapter",dataOpt:{optionSize:15}},{clzKey:"DAY_POP_CALENDAR",clzPath:"ecui.ui.IstCalendar",clzType:"VUI",adapterMethod:{dispose:"ecuiDispose"},adapterPath:"di.shared.adapter.IstCalendarVUIAdapter",dataOpt:{mode:"DAY",viewMode:"POP"}},{clzKey:"RANGE_POP_CALENDAR",clzPath:"ecui.ui.IstCalendar",clzType:"VUI",adapterMethod:{dispose:"ecuiDispose"},adapterPath:"di.shared.adapter.IstCalendarVUIAdapter",dataOpt:{mode:"RANGE",viewMode:"POP"}},{clzKey:"CALENDAR_PLUS",clzPath:"ecui.ui.CalendarPlus",clzType:"VUI",adapterMethod:{dispose:"ecuiDispose"},adapterPath:"di.shared.adapter.CalendarPlusVUIAdapter"},{clzKey:"X_CALENDAR",clzPath:"ecui.ui.XCalendar",clzType:"VUI",adapterMethod:{dispose:"ecuiDispose"},adapterPath:"di.shared.adapter.XCalendarVUIAdapter"},{clzKey:"OLAP_TABLE",clzPath:"ecui.ui.OlapTable",clzType:"VUI",adapterMethod:{create:"ecuiCreate",dispose:"ecuiDispose"},dataOpt:{defaultCCellAlign:"right"}},{clzKey:"BEAKER_CHART",clzPath:"ecui.ui.BeakerChart",clzType:"VUI",adapterPath:"di.shared.adapter.BeakerChartVUIAdapter"},{clzKey:"BREADCRUMB",clzPath:"ecui.ui.Breadcrumb",clzType:"VUI",adapterMethod:{create:"ecuiCreate",dispose:"ecuiDispose"}},{clzKey:"BUTTON",clzPath:"ecui.ui.Button",clzType:"VUI",adapterMethod:{create:"ecuiCreate",dispose:"ecuiDispose"}},{clzKey:"H_BUTTON",clzPath:"ecui.ui.HButton",clzType:"VUI",adapterMethod:{create:"ecuiCreate",dispose:"ecuiDispose"}},{clzKey:"OFFLINE_DOWNLOAD",clzPath:"di.shared.vui.OfflineDownload",clzType:"VUI",adapterMethod:{create:"xuiCreate",dispose:"xuiDispose"},dataOpt:{headText:"请输入邮箱（多个邮箱使用逗号分隔）：",confirmText:"确定",cancelText:"取消",text:"离线下载1"}},{clzKey:"SWITCH_BUTTON",clzPath:"ecui.ui.SwitchButton",clzType:"VUI",adapterMethod:{create:"ecuiCreate",dispose:"ecuiDispose"}},{clzKey:"ECUI_SELECT",clzPath:"ecui.ui.Select",clzType:"VUI",adapterMethod:{create:"ecuiCreate",dispose:"ecuiDispose"},adapterPath:"di.shared.adapter.EcuiSelectVUIAdapter",dataOpt:{optionSize:15}},{clzKey:"ECUI_INPUT_TREE",clzPath:"ecui.ui.InputTree",clzType:"VUI",adapterMethod:{create:"ecuiCreate",dispose:"ecuiDispose"},adapterPath:"di.shared.adapter.EcuiInputTreeVUIAdapter"},{clzKey:"ECUI_SUGGEST",clzPath:"ecui.ui.Suggest",clzType:"VUI",adapterMethod:{create:"ecuiCreate",dispose:"ecuiDispose"},adapterPath:"di.shared.adapter.EcuiSuggestVUIAdapter"},{clzKey:"ECUI_INPUT",clzPath:"ecui.ui.Input",clzType:"VUI",adapterMethod:{create:"ecuiCreate",dispose:"ecuiDispose"}}];c.CLZ={};for(var b=0,a;a=c.CLZ_DEFS[b];b++){if(a.clzKey in c.CLZ){throw new Error("dupicate clzKey: "+a.clzKey)}c.CLZ[a.clzKey]=a}})();$namespace("di.config");(function(){var a=$namespace().Lang={};a.AJAX_FAILURE=function(b){return b+" SERVER ERROR"};a.AJAX_TIMEOUT="请求超时，请稍后重试";a.AJAX_WAITING="加载中...";a.SMILE_FACE='&nbsp;<div class="global-smile-face"></div>&nbsp;&nbsp;&nbsp;';a.SAD_FACE='&nbsp;<div class="global-sad-face"></div>&nbsp;&nbsp;&nbsp;';a.NO_DATA="缺失数据";a.NO_AUTH="抱歉，您没有查看当前页面的权限";a.NO_AUTH_OPERATION="抱歉，您没有权限进行此操作";a.NO_AUTH_SYSTEM="抱歉，您没有系统权限";a.ERROR="系统异常";a.DATA_ERROR="数据异常";a.RE_LOGIN="请重新登陆";a.EMPTY_TEXT="未查询到相关信息";a.SAVE_FAIL="抱歉，保存失败，请重试";a.PARAM_ERROR="抱歉，参数校验失败";a.FATAL_DATA_ERROR="抱歉，服务器异常，操作无法继续";a.INPUT_MANDATORY="必填";a.INVALID_FORMAT="格式错误";a.NUMBER_OVERFLOW="数据过大";a.NUMBER_UNDERFLOW="数据过小";a.TEXT_OVERFLOW="输入文字过多";a.DOWNLOAD_FAIL="下载失败";a.OFFLINE_DOWNLOAD_FAIL="离线下载请求失败";a.DELETE_SUCCESS="删除成功";a.GET_DIM_TREE_ERROR="抱歉，维度数据获取失败，请重试";a.CONFIRM_ADD_SHARE="您真的要添加分享吗？";a.CONFIRM_REMOVE_SHARE="您真的要取消分享吗？";a.CONFIRM_DELETE="您真的要删除吗？";a.DIM_MANDATORY="请确认每种维度都有勾选，再点击查询";a.DESC_OVERFLOW="解释说明文字过多";a.DESC_MANDATORY="解释说明必填";a.PLAN_OVERFLOW="跟进计划文字过多";a.PLAN_MANDATORY="跟进计划必填";a.REASON_ADD_ERROR="原因添加失败，请重试";a.DRILL_DIM_DATA_ERROR="[维度数据校验失败]";a.WAITING_HTML='<span class="waiting-icon"></span>&nbsp;<span class="waiting-text">加载中...</span>'})();$namespace("di.config");(function(){var b=xui.XDatasource.extend;var a=$namespace().URL=function(d){var e=c[d];if(!e){throw new Error("empty url!")}return a.getWebBase()+e};var c={};a.getWebBase=function(){return $getNamespaceBase().WEB_ROOT||""};a.addURL=function(e,d){if(c[e]){throw new Error("Duplicate URL! name="+e+" url="+d)}c[e]=d};c.OLAP_REPORT_INIT="/reportTemplate/create.action";c.CUBE_META="/meta/getCubeTree.action";c.DIM_TREE_TABLE="/reportTemplate/table/getDimTree.action";c.DIM_TREE_CHART="/reportTemplate/chart/getDimTree.action";c.DIM_SELECT_SAVE_TABLE="/reportTemplate/table/updateDimNodes.action";c.DIM_SELECT_SAVE_CHART="/reportTemplate/chart/updateDimNodes.action";c.META_CONDITION_IND_DIM_TABLE="/reportTemplate/table/getMetaData.action";c.META_CONDITION_IND_DIM_CHART="/reportTemplate/chart/getMetaData.action";c.META_CONDITION_SELECT_TABLE="/reportTemplate/table/dragAndDrop.action";c.META_CONDITION_SELECT_CHART="/reportTemplate/chart/dragAndDrop.action";c.META_CONDITION_LIST_SELECT_CHART="/reportTemplate/chart/selectInd.action";c.FORM_DATA="/reportTemplate/initParams.action";c.FORM_ASYNC_DATA="/reportTemplate/interactParam.action";c.OLAP_TABLE_DATA="/reportTemplate/table/transform.action";c.OLAP_TABLE_DRILL="/reportTemplate/table/drill.action";c.OLAP_TABLE_LINK_DRILL="/reportTemplate/table/drillByLink.action";c.OLAP_TABLE_SORT="/reportTemplate/table/sort.action";c.OLAP_TABLE_CHECK="/reportTemplate/table/checkRow.action";c.OLAP_TABLE_SELECT="/reportTemplate/table/selectRow.action";c.OLAP_TABLE_DOWNLOAD="/reportTemplate/table/download.action";c.OLAP_TABLE_OFFLINE_DOWNLOAD="/reportTemplate/table/downloadOffLine.action";c.OLAP_TABLE_LINK_BRIDGE="/reportTemplate/table/linkBridge.action";c.OLAP_CHART_DATA="/reportTemplate/chart/transform.action";c.OLAP_CHART_X_DATA="/reportTemplate/chart/reDraw.action";c.OLAP_CHART_S_DATA="/reportTemplate/chart/reDrawSeries.action";c.OLAP_CHART_S_ADD_DATA="/reportTemplate/chart/addChartSeries.action";c.OLAP_CHART_S_REMOVE_DATA="/reportTemplate/chart/removeChartSeries.action";c.OLAP_CHART_BASE_CONFIG_INIT="/reportTemplate/chart/config.action";c.OLAP_CHART_BASE_CONFIG_SUBMIT="/reportTemplate/chart/config.action";c.OLAP_CHART_DOWNLOAD="/reportTemplate/chart/download.action";c.OLAP_CHART_OFFLINE_DOWNLOAD="/reportTemplate/chart/downloadOffLine.action";c.REPORT_PREVIEW="/layout-tpl/ka-income.html"})();$namespace("di.helper");(function(){var p=ecui;var n=xutil.string.encodeHTML;var b;var h;var e;var j;$link(function(){b=di.config.Lang;e=di.config.Dict;h=di.helper.Util;j=di.shared.model.DIFactory});var f=$namespace().Dialog={};var a=null;var g=false;var d=null;f.prompt=function(){c.apply(this,arguments)};f.waitingPrompt=function(){l.apply(this,arguments)};f.hidePrompt=function(){i.apply(this,arguments)};f.setPromptDef=function(r,q){if(q=="STUB"&&r&&r.anchor=="E"){c=k("prompt");i=k("hideprompt");l=k("waitingprompt")}};function k(q){return function(){var r=j().getEventChannel();if(r){r.triggerEvent(q,arguments)}}}function c(v,r,s){var u;try{u=window}catch(t){}var q=h.getScrollLeft(u)+h.getViewWidth(u)/2;var w=5;if(!a){a=document.createElement("div");a.style.cssText="display:none;position:fixed;*position:absolute";a.className="global-prompt";document.body.appendChild(a)}m();if(a.style.display==""){return false}a.innerHTML=v;a.style.display="";a.style.left=q-a.offsetWidth/2+"px";a.style.top=w+"px";if(r){p.mask(0);g=true}if(s){d=setTimeout(function(){f.hidePrompt()},s)}return true}function l(q){if(q==null){q=b.AJAX_WAITING}q=['<div class="global-prompt-waiting"></div>','<div class="global-prompt-waiting-text">',q,"</div>"].join("");f.prompt(q)}function i(){m();a.style.display="none";if(g){g=false;p.mask()}}function m(){if(d){clearTimeout(d);d=null}}f.showDialog=function(t,s,r,q){p.$messagebox(t,s,r,q)};f.alert=function(s,q,r){f.showDialog(s,"提示",r?[]:[{text:"确定",className:"ui-button-g",action:q}],e.DEFAULT_MASK_OPACITY)};f.confirm=function(r,q,s){f.showDialog(r,"确认",[{text:"确定",className:"ui-button-g",action:q},{text:"取消",action:s}],e.DEFAULT_MASK_OPACITY)};f.dialog=function(t,s,r){var q;r=r||[];q.push('<div class="ui-messagebox-icon"></div>','<div class="ui-messagebox-content">','<div class="ui-messagebox-text">',n(s),"</div>","</div>");f.showDialog(q.join(""),t,r,e.DEFAULT_MASK_OPACITY)};f.errorAlert=function(){f.alert(b.ERROR)}})();$namespace("di.helper");(function(){var l=xutil.lang;var g=l.isFunction;var j=l.isArray;var d=l.isString;var m=l.hasValue;var h=l.hasValueNotBlank;var k=xutil.string.encodeHTML;var n=xutil.string.textLength;var b=xutil.string.textSubstr;var f=xutil.number.formatNumber;var c=Array.prototype.slice;var e;$link(function(){e=di.config.Dict});var i=$namespace().Formatter=function(q){var p=c.call(arguments,1);return function(s){var r=c.call(arguments,1);return i[q].apply(this,[s].concat(p,r))}};i.DEFAULT_RATE_FORMAT="I,III.DD%";i.tableFormatter=function(s,q){var p=c.call(arguments,2);var t;var r;if(d(s)){t=s}else{t=s.data;r=s.link}return function(u){var v=i[q].apply(u,[u[t]].concat(p));return a(u,v,r)}};i.SIMPLE_TEXT=function(q,p){p=m(p)?p:true;q=h(q)?q:"-";q=p?k(q):q;return q};i.CUT_TEXT=function(v,u,t,r,w){var s="",q,p="",t=m(t)?t:true;v=h(v)?v:"-";if(n(v)>u){s=b(v,0,u-2)+"..";q=true}else{s=v;q=false}s=t?k(s):s;if(q&&m(r)){p="color:"+r+""}v=t?k(v):v;return'<span class="'+w+'" style="'+p+'" title="'+v+'" >'+s+"&nbsp;</span>"};i.SIMPLE_RATE=function(p,q){var r,s;if(!h(p)){return"-"}q=q||i.DEFAULT_RATE_FORMAT;r=f(p,q);return r};i.SIMPLE_NUMBER=function(p,q){p=h(p)?(!q?p:f(p,q)):"-";return p};i.COLORED_NUMBER=function(r,s,u,q){var p,t="-";u=u||"red";q=q||"green";if(h(r)){p='style="color:'+(r<0?q:u)+'" ';t="<span "+p+">"+(!s?r:f(r,s))+"</span>"}return t};function a(r,u,s,q){var p;if(h(s)){p=r[s]}if(!h(p)||!h(u)){return u}var t=q?"":' target="_blank" ';return"<a "+t+' href="'+p+'">'+u+"</a>"}})();$namespace("di.helper");(function(){var a=xutil.object.setByPath;var e=xutil.object.getByPath;var c=xutil.dom.getParent;var b=xutil.object.merge;var f;var n;$link(function(){f=di.config.Dict;n=di.helper.Dialog});$namespace().SnippetParser=function(){return p=p||{parseProdSnippet:t,setupEventChannel:h}};var p;var s="data-o_o-di";var d="BODY";var q="data-d-outward-d-atad";var m="data-d-inward-d-atad";var i=".";function h(B,w,y){var A=r(B);var v=w.domAttrName||s;for(var z=0,x,u;x=A[z];z++){u=x.getAttribute(v);if(u==d){return k(x,y)}}}function t(B,v,y,G){y=y||{};var K=y.domAttrName||s;var E=r(B);var A;var I;var H;var J;var C;var x;var F;var D;var u;j(v);G.installClz();var w=v.entityDefs||[];var z={};for(F=0;F<w.length;F++){A=w[F];z[A.id]=A}for(F=0;u=E[F];F++){I=u.getAttribute(K);if(I==d){continue}if(I){A=z[I];l(A.id);g(A,u,G)}}G.forEachEntity(["COMPONENT"],function(Q,L,S){var P=Q.id.split(i);var O=G.getEntity(P[0],"DEF");if(!O){throw new Error(Q.id+" 未定义隶属的snippet")}a("belong.snippet",O.id,Q);var M=Q.el;var N;var R=e("layout.parentSnippet",Q);if(!R){a("layout.parentSnippet",R=[],Q)}while((M=c(M))&&M!=document){N=G.getEntity(M.getAttribute(K),"DEF");if(N&&N.clzType=="SNIPPET"){R.push(N.id)}}});G.forEachEntity(["VPART"],function(N,R,M){var U=r(N.el);var S={COMPONENT:0,VUI:0};var P={COMPONENT:"componentRef",VUI:"vuiRef"};for(var Q=0,L,T,O;L=U[Q];Q++){T=G.getEntity(L.getAttribute(K),"DEF");if(!T){continue}P[O=T.clzType]&&a(P[O]+".inner["+(S[O]++)+"]",T.id,N)}});G.rootSnippet(v.rootSnippet)}function j(y){var w=y.clzDefs||[];var u={};for(var x=0,v;v=w[x];x++){u[v.clzKey]=v}b(f.CLZ,u)}function k(w,u){var y=function(A,B){var C=w[q];if(C){try{C(A,B)}catch(D){}}};w[m]=function(B,C){var A=z[B];if(A){for(var D=0;D<A.length;D++){try{A[D]&&A[D].apply(null,C||[])}catch(E){}}}};var z={};var x=function(B,C){var A=z[B];if(!A){A=z[B]=[]}A.push(C)};var v;u.setEventChannel(v={anchorEl:w,triggerEvent:y,addEventListener:x});return v}function g(w,v,u){w.el=v;u.addEntity(w,"DEF")}function l(u){if(!/[1-9a-zA-Z\-_\.]/.test(u)){throw new Error("id is illegal: "+u)}}function r(u){return u.all||u.getElementsByTagName("*")}})();$namespace("di.helper");(function(){var a=xutil.lang;var b=a.isFunction;var m=a.isArray;var q=a.isString;var s=xutil.date.stringToDate;var d=a.hasValue;var E=a.hasValueNotBlank;var i=xutil.string.encodeHTML;var D=xutil.collection.sortList;var v=xutil.date.dateToString;var c=xutil.date.getWorkday;var f=xutil.date.getWeekend;var w=xutil.date.getQuarter;var x=xutil.date.getQuarterBegin;var y=xutil.dom.g;var C=xutil.lang.isDate;var e=ecui.$fastCreate;var u=baidu.json.stringify;var k=xutil.object.getByPath;var r;var z;var h;var p=RegExp;$link(function(){r=k("ecui.ui.Control");z=di.helper.Dialog;h=di.config.Lang});var j=$namespace().Util={};var n=1000*60*60*24;j.assert=function(g,F){if(!g){throw new Error(F||"Assert fail!")}};j.preInit=function(G,F,g){g.primary=G.getType();F.className=G.getTypes().join(" ")+F.className};j.ecuiCreate=function(I,H,G,g){var F=I.types[0];g=g||{};!g.primary&&(g.primary=F);H.className=I.TYPES+" "+H.className;return e(I,H,G,g)};j.disposeInnerControl=function(F){for(var g in F){/_u\w+/.test(g)&&F[g]&&j.ecuiDispose(F[g])}};j.validDimSel=function(I){var G,H,F,g;if(!E(I)){return false}g=I.split("|");for(G=0;G<g.length;G++){if(!E(H=g[G])){return false}F=H.split(":");if(!E(F[0])||!E(F[1])){return false}}return true};j.completeDimSel=function(I,G){if(!E(I)){return false}var H=j.parseDimSel(I);var g;for(var F in H){g=G[F].datasource.rootNode;if(g&&(!H[F]||H[F].length==0)){H[F]=[g.dimNodeId]}}return j.stringifyDimSel(H)};j.parseDimSel=function(K){var H,J,F,I,g,G={};if(!E(K)){return null}g=K.split("|");for(H=0;H<g.length;H++){if(!E(J=g[H])){continue}F=J.split(":");if(!E(F[0])){continue}G[F[0]]=E(F[1])?F[1].split(","):[]}return G};j.stringifyDimSel=function(G){var F,g=[];if(!G){return""}for(F in G){g.push(F+":"+(G[F]||[]).join(","))}return g.join("|")};j.getDomAttrJSON=function(G,F){var g=G.getAttribute(F);if(g){return(new Function("return ("+g+");"))()}};j.sameDimSel=function(H,G,J){var F,g,L,K=j.parseDimSel(H),I=j.parseDimSel(G);for(F in J){D((g=K[F]),null,"<",false);D((L=I[F]),null,"<",false);if(g.join(",")!==L.join(",")){return false}}return true};j.sameDimNodeIdArr=function(G,F){G=G||[];F=F||[];if(G.length!=F.length){return false}D(G,null,"<",false);D(F,null,"<",false);for(var g=0;g<G.length;g++){if(G[g]!=F[g]){return false}}return true};j.emptyTable=function(F,H){var g,G="";if(d(H)){g=F.getEmptyText();F.setEmptyText(H)}F.setData([]);if(d(g)){F.setEmptyText(g)}};j.waitingTable=function(g){j.emptyTable(g,h.WAITING_HTML)};j.getWrapSelected=function(F){for(var g=0;o=F.list[g];g++){if(o.value==F.selected){return o}}};j.logError=function(g){try{if(console&&console.log){console.log(g);(g.message!=null)&&console.log(g.message);(g.stack!=null)&&console.log(g.stack)}}catch(g){}};j.formatTime=function(F,G,g){if(!F){return}if(!C(F)){F=new Date(F)}g=g||{};switch(G){case"D":return v(F,"yyyy-MM-dd");case"W":return g.firstWeekDay?v(c(F),"yyyy-MM-dd"):v(F,"yyyy-MM-dd");case"M":return v(F,"yyyy-MM");case"Q":return F.getFullYear()+"-Q"+w(F);case"Y":return String(F.getFullYear());default:return""}};j.parseTime=function(g){if(!g){return null}if(C(g)){return g}if(g.indexOf("-Q")>=0){var F=[0,0,3,6,9];g=g.split("-Q");return new Date(parseInt(g[0],10),F[parseInt(g[1],10)],1)}else{return s(g)}};j.parseTimeDef=function(J,I){var G=[];var K=[];if(m(J)&&J.length){var g=J[0];if(q(g)){G=[J]}else{if(m(g)){G=J}else{j.assert("TimeDef illegal: "+J)}}for(var F=0,H;F<G.length;F++){if(m(H=G[F])){K.push(j.parseTimeUnitDef(H,I))}else{j.assert("TimeDef illegal: "+J)}}}return K};j.parseTimeUnitDef=function(I,H){if(!I||!I.length){return null}var G={};var L=I[0];var g=I[1];var F=I[2];G.start=j.parseTimeOffset(H[0],L);G.end=j.parseTimeOffset(H[1],g);if((!L||!g)&&F){var K;var J;if(L){K="start";J="end"}else{K="end";J="start"}G[J]=j.parseTimeOffset(G[K],F)}else{if(!g&&!F){G.end=G.start}}return G};j.parseTimeOffset=function(H,J){if(J==null){return null}if(!H){return H}if(q(H)){H=j.parseTime(H)}J=J.toUpperCase();var M=[H.getFullYear(),H.getMonth(),H.getDate()];var g={Y:0,M:1,D:2};if(/^([-+]?)(\d+)([YMDWQ])([BE]?)$/.test(J)){var F=!p.$1||p.$1=="+";var G=parseInt(p.$2);var L=p.$3;var I=p.$4;if("YMD".indexOf(L)>=0){M[g[L]]+=F?(+G):(-G)}else{if(L=="W"){G=G*7;M[g.D]+=F?(+G):(-G)}else{if(L=="Q"){G=G*3;M[g.M]+=F?(+G):(-G)}}}var K=new Date(M[0],M[1],M[2]);if(I){if(L=="Y"){I=="B"?(K.setMonth(0),K.setDate(1)):(K.setFullYear(K.getFullYear()+1),K.setMonth(0),K.setDate(1),K.setTime(K.getTime()-n))}else{if(L=="M"){I=="B"?K.setDate(1):(K.setMonth(K.getMonth()+1),K.setDate(1),K.setTime(K.getTime()-n))}else{if(L=="W"){K=(I=="B"?c:f)(K)}else{if(L=="Q"){(I=="B")?(K=x(K)):(K.setMonth(K.getMonth()+3),K=x(K),K.setTime(K.getTime()-n))}}}}}return K}else{return j.parseTime(J)}};j.parseQuarter=function(g){var F=[0,0,3,6,9];g=g.split("-Q");return new Date(parseInt(g[0],10),F[parseInt(g[1],10)],1)};j.jsonStringify=function(g){return g?u(g):""};j.ecuiTriggerEvent=function(H,F,G,g){if(!ecui){return}return ecui.triggerEvent(H,F,G,g)};j.ecuiAddEventListener=function(I,F,g,H){if(!ecui){return}var G=H?function(){ecui.removeEventListener(I,F,arguments.callee);return g.apply(this,arguments)}:g;return ecui.addEventListener(I,F,G)};j.ecuiDispose=function(g){ecui&&ecui.dispose(g)};j.isEcuiControl=function(g){return !!(r&&g instanceof r)};j.download=function(G,I,F){I=I||new Function();var H=F?function(){z.alert(h.SAD_FACE+h.DOWNLOAD_FAIL,I)}:I;var g=y(l);if(!g){var g=document.createElement("iframe");g.id=l;g.style.display="none";document.body.appendChild(g)}g.onload=function(){var J=g.contentWindow.document;if(J.readyState=="complete"||J.readyState=="loaded"){H()}g.onload=null};g.src=G};j.targetBlank=function(F){var H=document;var g=H.body;var G=H.createElement("a");G.style.display="none";G.href=F||"#";G.target="_blank";g.appendChild(G);G.click();g.removeChild(G)};j.foreachDo=function(G,g){for(var F=0,H;F<G.length;F++){(H=G[F])&&(H.$di?H.$di(g):H[g])}};var l=String("download-iframe-"+Math.round(Math.random()*10000000000000));function B(g,F){return F+g.charAt(0).toUpperCase()+g.slice(1)}function A(g,G){var F="";if(j.isEcuiControl(G)){F="_u"}else{if(m(G)){F="_a"}else{if(b(G)){F="_f"}else{F="_m"}}}return B(g,F)}j.evalJsonLogic=function(I,g){if(!I||!g){t(I)}var F;var H;var G;if(m(I)){I.length<2&&t(I);F=I[0];if(F=="and"){G=true;for(H=1;H<I.length;H++){G=G&&j.evalJsonLogic(I[H],g)}return G}else{if(F=="or"){G=false;for(H=1;H<I.length;H++){G=G||j.evalJsonLogic(I[H],g)}return G}else{if(F=="not"){return !j.evalJsonLogic(I[H],g)}else{t(I)}}}}else{return g(I)}};function t(g,F){throw new Error("Illegle json logic express, "+(F||"")+". "+u(g))}j.getScrollLeft=function(g){g=g||window;var F=g.document;return g.pageXOffset||F.documentElement.scrollLeft||F.body.scrollLeft};j.getScrollTop=function(g){g=g||window;var F=g.document;return g.pageYOffset||F.documentElement.scrollTop||F.body.scrollTop};j.getViewWidth=function(G){G=G||window;var F=G.document;var g=F.compatMode=="BackCompat"?F.body:F.documentElement;return g.clientWidth};j.getViewHeight=function(G){G=G||window;var F=G.document;var g=F.compatMode=="BackCompat"?F.body:F.documentElement;return g.clientHeight};j.getWidth=function(I){I=I||window;var H=I.document;var g=H.body;var G=H.documentElement;var F=H.compatMode=="BackCompat"?g:H.documentElement;return Math.max(G.scrollWidth,g.scrollWidth,F.clientWidth)};j.getHeight=function(I){I=I||window;var H=I.document;var g=H.body;var G=H.documentElement;var F=H.compatMode=="BackCompat"?g:H.documentElement;return Math.max(G.scrollHeight,g.scrollHeight,F.clientHeight)};j.ref=function(g,F,H){var G;if(b(G=g[B(F,"set")])){G.call(g,H)}else{if(d(G=A(F,H))){g[G]=H}}return H};j.getModel=function(g,F){var G;if(b(G=g[B(F,"get")])){return G.call(g)}else{return g[B(F,"_m")]}}})();(function(){var b=xutil.ajax;var h=xutil.lang.isFunction;var a=di.config.AJAX;var d=di.config.Lang;var g=di.helper.Dialog.alert;var c=di.helper.Dialog.confirm;var e=di.helper.Dialog.waitingPrompt;var f=di.helper.Dialog.hidePrompt})();(function(){var a=di.config.Dict})();(function(){var a=di.config.Lang})();(function(){var a=di.config.URL;a.addURL("CONSOLE_FRAME_INIT","/xxx/xxxxxxxxx1.action")})();(function(){var a=di.helper.Dialog})();(function(){var a=di.helper.Formatter})();(function(){var a=di.helper.Util})();$namespace("di.shared.vui");(function(){var f=xutil.object.inheritsObject;var g=xutil.object.extend;var e=xutil.string.encodeHTML;var d=xui.XObject;var b=$namespace().HiddenInput=f(d,c);var a=b.prototype;function c(h){(this._eMain=h.el).style.display="none"}a.setData=function(h){this._oData=h};a.getValue=function(){return(this._oData||{}).value}})();$namespace("di.shared.vui");(function(){var k=xutil.object.inheritsObject;var h=xutil.dom.addClass;var r=xutil.object.extend;var a=xutil.string.encodeHTML;var i=di.helper.Util.ecuiCreate;var f=xutil.lang.isObject;var g=xutil.lang.isArray;var s=xutil.string.template;var b=xutil.dom.children;var e=xutil.dom.remove;var d=xutil.object.getByPath;var j=di.config.Dict;var p=xui.XObject;var m;var q;$link(function(){m=d("ecui.ui.HButton");q=d("ecui.ui.Form")});var c=$namespace().OfflineDownload=k(p,n);var l=c.prototype;function n(t){var v=this._eMain=t.el;h(v,"offline-download");var w;var u;w=document.createElement("div");v.appendChild(w);this._uBtn=i(m,w,null,{text:t.text||"离线下载",skin:t.skin});if(!this._uDialog){w=document.createElement("div");u=["<label>离线下载</label>",'<span class="offline-download-head">'+(t.headText||"请输入邮箱")+"</span>",'<input type="input" class="offline-download-input"/>',"<div></div>","<div></div>"];w.innerHTML=u.join("");u=b(w);this._eInput=u[2];this._uDialog=i(q,w,null,{hide:true});this._uConfirmBtn=i(m,u[3],null,{text:t.confirmText||"确定",skin:t.skin});this._uCancelBtn=i(m,u[4],null,{text:t.cancelText||"取消",skin:t.skin});document.body.appendChild(w)}}l.init=function(){var t=this;this._uBtn.onclick=function(){t.$clear();t._uDialog.center();t._uDialog.showModal(j.DEFAULT_MASK_OPACITY)};this._uConfirmBtn.onclick=function(){t.notify("confirm",[t._eInput.value]);t._uDialog.hide()};this._uCancelBtn.onclick=function(){t._uDialog.hide()};this._uDialog.init();this._uBtn.init();this._uConfirmBtn.init();this._uCancelBtn.init()};l.$clear=function(){this._eInput.value=""};l.getValue=function(){return{email:this._eInput.value}};l.dispose=function(){if(this._uDialog){var t=this._uDialog.getOuter();this._uDialog.dispose();this._uBtn.dispose();this._uConfirmBtn.dispose();this._uCancelBtn.dispose();e(t)}}})();$namespace("di.shared.vui");(function(){var g=di.helper.Util;var r=xutil.object.inheritsObject;var j=xutil.dom.addClass;var w=xutil.object.extend;var n=xutil.dom.q;var y=xutil.fn.bind;var d=xutil.object.objKey;var x=xutil.string.template;var k=xutil.LinkedHashMap;var h=xutil.object.getByPath;var p=xutil.uid.getIncreasedUID;var u=xui.XObject;var b;var a;var v;var l=g.ecuiCreate;var e=g.ecuiDispose;$link(function(){b=h("ecui.ui.DroppableList");a=h("ecui.ui.DraggableList")});var c=$namespace().OlapMetaDragger=r(u,t);var f=c.prototype;var s=['<div class="meta-condition-src">','<div class="meta-condition-ind">','<div class="meta-condition-head-text">选择指标：</div>','<div class="meta-condition-ind-line q-di-meta-ind"></div>',"</div>",'<div class="meta-condition-dim">','<div class="meta-condition-head-text">选择维度：</div>','<div class="meta-condition-dim-line q-di-meta-dim"></div>',"</div>","</div>",'<div class="meta-condition-tar q-di-meta-tar">',"</div>"].join("");var i=['<div class="meta-condition-sel">','<div class="meta-condition-head-text">#{0}</div>','<div class="meta-condition-sel-line q-di-meta-sel-line"></div>',"</div>"].join("");var m={ROW:"行：",FILTER:"过滤：",COLUMN:"列："};function t(q){var z=this._eMain=q.el;j(z,"meta-condition");z.innerHTML=s;this._eSelLineArea=n("q-di-meta-tar",z)[0];this._oSelLineWrap=new k();this._oSelLineIdWrap={}}f.init=function(){};f.setData=function(q,z){this._oData=q||{};this._mModel=q.model;this._oRule=q.rule||{};!z&&this.render()};f.render=function(){var A=this;var z=this._eMain;var C=this._oData;this.$disposeInner();var B=["\x06_DI_META_COND_IND"+p("DI_META_COND"),"\x06_DI_META_COND_DIM"+p("DI_META_COND")];var q=C.inddim;this._uIndSrc=l(a,n("q-di-meta-ind",z)[0],null,{id:B[0],disableSelected:true,clazz:"IND"});q.indList.foreach(function(D,E){A._uIndSrc.addItem({value:E.uniqName,text:E.caption,clazz:E.clazz,fixed:E.fixed,align:E.align})});this._uDimSrc=l(a,n("q-di-meta-dim",z)[0],null,{id:B[1],disableSelected:true,clazz:"DIM"});q.dimList.foreach(function(D,E){A._uDimSrc.addItem({value:E.uniqName,text:E.caption,clazz:E.clazz,fixed:E.fixed,align:E.align})});C.selLineDataWrap.foreach(function(E,F,D){A.$addSelLine(E,(C.selLineTitleDef||m)[E.split("_")[0]],B.join(","),F)});this._uIndSrc.onchange=y(this.$handleSelLineChange,this);this._uDimSrc.onchange=y(this.$handleSelLineChange,this);this._oSelLineWrap.foreach(function(D,E){E.onitemclick=y(A.$handleItemClick,A,D);E.oncheckdroppable=y(A.$checkSelLineDroppable,A);E.oncheckdraggable=y(A.$checkSelLineDraggable,A)})};f.dispose=function(){this.$disposeInner();this._eSelLineArea=null;c.superClass.dispose.call(this)};f.$disposeInner=function(){if(this._uIndSrc){e(this._uIndSrc);this._uIndSrc=null}if(this._uDimSrc){e(this._uDimSrc);this._uDimSrc=null}this._oSelLineWrap.foreach(function(z,A,q){e(A)});this._eSelLineArea.innerHTML="";this._oSelLineWrap.cleanWithoutDefaultAttr();this._oSelLineIdWrap={}};f.$addSelLine=function(A,F,D,C){if(A==null){return}var B=this._oSelLineWrap;var z=this._oSelLineIdWrap;var E=document.createElement("div");E.innerHTML=x(i,F);this._eSelLineArea.appendChild(E=E.firstChild);B.addLast(l(b,n("q-di-meta-sel-line",E)[0],null,{id:z[A]="\x06_DI_META_COND_SEL"+p("DI_META_COND"),source:D,name:A,configBtn:false}),A);for(var q in z){if(q!=A){B.get(q).addTarget(z[A])}B.get(A).addTarget(z[q])}this._uIndSrc.addTarget(z[A]);this._uDimSrc.addTarget(z[A]);if(C){C.foreach(function(H,I,G){B.get(A).addItem({value:I.uniqName,text:I.caption,clazz:I.clazz,fixed:I.fixed,align:I.align})})}};f.refreshStatus=function(q){if(q){this._uIndSrc.setState({disable:q.indMetas.disabledMetaNames,selected:q.indMetas.selectedMetaNames});this._uDimSrc.setState({disable:q.dimMetas.disabledMetaNames,selected:q.dimMetas.selectedMetaNames})}};f.enable=function(q){d.remove(this,q);if(d.size(this)==0&&this._bDisabled){this._uIndSrc&&this._uIndSrc.enable();this._uDimSrc&&this._uDimSrc.enable();this._oSelLineWrap.foreach(function(A,B,z){B.enable()})}c.superClass.enable.call(this)};f.disable=function(q){d.add(this,q);if(!this._bDisabled){this._uIndSrc&&this._uIndSrc.disable();this._uDimSrc&&this._uDimSrc.disable();this._oSelLineWrap.foreach(function(A,B,z){B.disable()})}c.superClass.disable.call(this)};f.$handleSelLineChange=function(z,D,A,B,E){var C={};this._oSelLineWrap.foreach(function(F,H,G){C[F]=H.getValue()});var q={from:E,to:A,toPosition:D,uniqNameList:[z.value]};this.notify("sellinechange",[C,q])};f.$handleItemClick=function(A,B,z){var q=this._mModel.getMetaItem(z.value);if(q&&q.clazz=="DIM"){v().open("EDIT",{uniqName:z.value,reportType:this._sReportType,selLineName:A,dimMode:q.isTimeDim?"TIME":"NORMAL",commonParamGetter:this._fCommonParamGetter})}else{}};f.$findItemFromSelLine=function(C,B,z){var A=[];function q(F,E){var D=E.getItems();for(var G=0,H;H=D[G];G++){if(H!=z&&H.getClazz()==C){A.push({item:H,selLineName:F,index:G})}}}if(B){q(B,this._oSelLineWrap.get(B))}else{this._oSelLineWrap.foreach(q)}return A};f.$checkSelLineDroppable=function(q,C,B){var E=this._oRule;if(q.clazz=="IND"&&B.indexOf("COL")<0){return false}if(q.clazz=="DIM"&&B.indexOf("COL")>=0){return false}if(B.indexOf("FILTER")>=0){return false}var A=this._oSelLineWrap.get(B);var z=A.getItems();var D;if(((D=z[C])&&D.getWrap().align=="LEFT")||((D=z[C-1])&&D.getWrap().align=="RIGHT")){return false}return true};f.$checkSelLineDraggable=function(q,B,A){var C=this._oRule;var z=this._oSelLineWrap.get(A);if(z.count()<=1){if(C.forbidColEmpty&&A.indexOf("COL")>=0){return false}if(C.forbidRowEmpty&&A.indexOf("ROW")>=0){return false}}if(q.fixed){return false}if(A.indexOf("FILTER")>=0){return false}return true};f.$fixSelLineChange=function(K,M,D,N){if(M==null){return}var I=(K.calcColumnRefInd||[]).length>0;var L=this._oSelLineWrap.get(D);var B=L.getItems()||[];var q=B[M];var F=B[M-1];var G=B[M+1];var O=F&&F.getWrap();var C=G&&G.getWrap();var E;var H;var A;var P;var J;var z={IND:[],DIM:[],WALL:[]};O?(z[O.clazz][0]=1):(z.WALL[0]=1);C?(z[C.clazz][1]=1):(z.WALL[1]=1);if(K.clazz=="DIM"){if(z.IND.length>0&&z.WALL.length>0){E=this.$findItemFromSelLine("DIM",D,q);for(J=0;H=E[J];J++){this._oSelLineWrap.get(H.selLineName).remove(H.item)}for(J=0;H=E[J];J++){L.add(H.item,z.IND[0]?(L.count()-1):1)}}else{if(z.IND[0]&&z.IND[1]){A=B[0].getClazz()=="DIM";for(J=A?0:(B.length-1);H=B[J];J+=A?1:-1){if(H.getClazz()=="IND"){P=A?J:(J+1);break}}L.remove(q);L.add(q,P<=M?P:P-1)}}}else{if(K.clazz=="IND"){if(z.DIM.length>0&&z.WALL.length>0){E=this.$findItemFromSelLine("IND",null,q);for(J=0;H=E[J];J++){this._oSelLineWrap.get(H.selLineName).remove(H.item)}for(J=0;H=E[J];J++){L.add(H.item,z.DIM[0]?(L.count()-1):1)}}else{if(z.DIM[0]&&z.DIM[1]){A=M>(B.length-1)/2;L.remove(q);L.add(q,A?L.count():0);E=this.$findItemFromSelLine("IND",null,q);for(J=0;H=E[J];J++){this._oSelLineWrap.get(H.selLineName).remove(H.item)}for(J=0;H=E[J];J++){L.add(H.item,A?(L.count()-1):1)}}}}}B=L.getItems()||[];for(J=0;H=B[J];J++){if(H.getClazz=="IND"){}}}})();$namespace("di.shared.vui");(function(){var b=xutil.object.inheritsObject;var f=xutil.dom.addClass;var g=xutil.object.extend;var i=xutil.string.encodeHTML;var l=xutil.lang.isObject;var e=xutil.lang.isArray;var j=xutil.string.template;var k=xui.XObject;var h=$namespace().TextLabel=b(k,a);var c=h.prototype;function a(m){var n=this._eMain=m.el;f(n,"vui-text-area");this._sInitTpl=n.innerHTML;n.innerHTML="";this.setData(m)}c.setData=function(n){var m=this._eMain;n=n||{};if(n.html!=null){m.innerHTML=n.html}else{if(n.text!=null){m.innerHTML=i(n.text)}else{if(n.tpl!=null){d.call(this,n.tpl,n.args)}else{if(this._sInitTpl!=null){d.call(this,this._sInitTpl,n.args)}}}}};function d(n,m){var p=this._eMain;if(l(m)){p.innerHTML=j(n,m)}else{if(e(m)){p.innerHTML=j.apply(null,n,m)}else{p.innerHTML=j.tpl||""}}}})();$namespace("di.shared.model");(function(){var a=ecui.inheritsModel,d=xui.XDatasource;$link(function(){});var c=$namespace().AuthModel=a(d),b=c.prototype;b.getUserId=function(){}})();$namespace("di.shared.model");(function(){var e=xutil.object.clone;var d=xutil.object.extend;var h=xutil.url.textParam;var f=di.helper.Util.jsonStringify;var c=xutil.lang.isArray;var j=xutil.lang.isObject;var b=$namespace().CommonParamFactory=function(k){this.externalParam=k&&e(k.externalParam)||{}};var i=b.prototype;var g="diF\x06^_^jsonnosj^_^\x06";b.markParamMode=function(l,k){if(j(l)){if(!k||k=="NORMAL"){delete l[g]}else{l[g]=k}}return l};i.getGetter=function(m){m=m||{};var k=this.externalParam;var n=m.reportTemplateId;var p="INIT";function l(r,q){if(p=="INIT"){p="FORBIDDEN"}else{if(p=="FORBIDDEN"){throw new Error("一个snippet中的第一个请求不能并发，请调整报表设计。在第一请求返回后再发出其他请求。")}}var s={};d(s,k,r);s.reportTemplateId=n;return a(s,q)}l.update=function(q){var r=q&&q.reportTemplateId||null;if(r){p="OPEN";n=r}else{if(p!="OPEN"){p="INIT"}}};l.getReportTemplateId=function(){return n};return l};function a(n,l){var r=[];l=l||{};function q(s,t){r.push(h(s)+"="+h(t))}var k;var p;var m;for(k in n){p=n[k];if(j(p)&&(l.paramMode=="JSON"||p[g]=="JSON")){delete p[g];q(k,f(p));p[g]=1}else{if(c(p)){for(m=0;m<p.length;m++){q(k,p[m])}}else{q(k,p)}}}return r.join("&")}})();$namespace("di.shared.model");(function(){var A=di.helper.Formatter;var h=di.config.Dict;var c=di.config.Lang;var b=di.config.URL;var d=di.helper.Util;var m=xutil.object.inheritsObject;var j=xutil.dom.q;var v=xutil.dom.g;var B=xutil.fn.bind;var w=xutil.object.extend;var s=xutil.object.assign;var l=baidu.json.parse;var p=baidu.json.stringify;var a=xutil.lang.hasValue;var x=xutil.object.clone;var k=xutil.date.stringToDate;var r=xutil.date.dateToString;var u=xutil.url.textParam;var n=xutil.url.wrapArrayParam;var f=xutil.LinkedHashMap;var y=xutil.collection.travelTree;var i=xui.XDatasource;var e=$namespace().CubeMetaModel=m(i,t);var z=e.prototype;function t(){}z.init=function(){};z.url=new i.Set({INIT:b("CUBE_META")});z.parse=new i.Set({INIT:function(g){this._aCubeForest=g.cubeTree}});z.getMenuByCubeMeta=function(){var E={menuList:[]};var C;E.menuList.push({text:"报表类型",value:1});for(var q=0,g,D;g=this._aCubeForest[q];q++){D=g.schemaName;y(g=x(g.root),function(G,F){G.value=G.nodeName;G.text=G.caption||" - ";G.floatTree=[{text:G.caption,value:String(Math.random()),url:"schemaName="+D,children:[{text:"创建表",value:String(Math.random()),url:"di.console.editor.ui.OLAPEditor?reportType=TABLE&schemaName="+D+"&cubeTreeNodeName="+G.nodeName},{text:"创建图",url:"di.console.editor.ui.OLAPEditor?reportType=CHART&schemaName="+D+"&cubeTreeNodeName="+G.nodeName}]}]},"children");E.menuList.push(g)}E.selMenuId=1;E.menuList.push({text:"效果试验",value:19999,url:"di.console.editor.ui.ReportPreview"});return{menuTree:E}}})();$namespace("di.shared.model");(function(){var b=ecui.inheritsModel,d=xui.XDatasource;var c=$namespace().DateModel=b(d);var a=c.prototype;a.result=function(e){this.businessData=true;this._nInitServerTime=parseInt(e.serverTime)||new Date().getTime();this._nServerTimeOffset=this._nInitServerTime-(new Date).getTime()};a.now=function(){var e=new Date();e.setTime(e.getTime()+this._nServerTimeOffset);return e}})();$namespace("di.shared.model");(function(){var k=di.config.URL;var h=di.helper.Util;var f=xutil.object.inheritsObject;var b=xutil.url.wrapArrayParam;var n=h.logError;var m=xutil.uid.getUID;var a=xui.XDatasource;var j=$namespace().DIChartModel=f(a,e);var i=j.prototype;function e(p){this._fCommonParamGetter=p.commonParamGetter;this._oRawChartData={};this._oChartData={}}i.init=function(){};i.url=new a.Set({DATA:k("OLAP_CHART_DATA"),X_DATA:k("OLAP_CHART_X_DATA"),S_DATA:k("OLAP_CHART_S_DATA"),S_ADD_DATA:k("OLAP_CHART_S_ADD_DATA"),S_REMOVE_DATA:k("OLAP_CHART_S_REMOVE_DATA"),OFFLINE_DOWNLOAD:k("OLAP_CHART_OFFLINE_DOWNLOAD")});i.businessKey=new a.Set({DATA:"DI_CHART_MODEL_DATA_"+m(),X_DATA:"DI_CHART_MODEL_X_DATA_"+m(),S_DATA:"DI_CHART_MODEL_S_DATA_"+m(),S_ADD_DATA:"DI_CHART_MODEL_S_ADD_DATA_"+m(),S_REMOVE_DATA:"DI_CHART_MODEL_S_REMOVE_DATA_"+m(),OFFLINE_DOWNLOAD:"DI_CHART_OFFLINE_DOWNLOAD_"+m()});i.param=new a.Set({DATA:d,X_DATA:d,S_DATA:d,S_ADD_DATA:d,S_REMOVE_DATA:d,OFFLINE_DOWNLOAD:function(p){return this._fCommonParamGetter({mainTo:p.args.param.email})}});function d(p){var q=p.args.param;if(q.uniqueName){q.dimTags=q.uniqueName;delete q.uniqueName}if(q.uniqueNames){q.dimTagsList=q.uniqueNames;delete q.uniqueNames}return this._fCommonParamGetter(q)}i.complete=new a.Set({DATA:c,X_DATA:c,S_DATA:c,S_ADD_DATA:c,S_REMOVE_DATA:c,OFFLINE_DOWNLOAD:c});function c(p){this._fCommonParamGetter.update(p.data)}i.parse=new a.Set({DATA:g,X_DATA:g,S_DATA:g,S_ADD_DATA:g,S_REMOVE_DATA:g});function g(u,s,q){try{var w=this._oRawChartData=u.reportChart;var t={};if(w.xAxisType=="datetime"){w.xAxisType="date"}t.chartType="line";t.series=w.seriesData;t.xAxis=[{type:w.xAxisType,data:w.xAxisCategories}];t.yAxis=[];if(w.yAxises){for(var r=0,p;p=w.yAxises[r];r++){t.yAxis.push({format:p.format,title:p.unitName?{text:p.unitName}:null})}}this._oChartData=t}catch(v){n(v);this.$goError()}}i.error=new a.Set({DATA:l,X_DATA:l,S_DATA:l,S_ADD_DATA:l,S_REMOVE_DATA:l});function l(p,r,q){this._oRawChartData={};this._oChartData={}}i.getChartData=function(){return this._oChartData}})();$namespace("di.shared.model");(function(){var L=di.helper.Util;var v=di.config.Dict;var h=di.helper.Dialog;var aF=xutil.lang;var G=xutil.object;var R=xutil.url;var aY=aF.isString;var e=aF.isArray;var I=aF.isObject;var aM=aF.isFunction;var a2=G.isEmptyObj;var aO=G.getByPath;var B=G.objKey;var aR=G.assign;var am=G.extend;var E=G.merge;var F=G.clone;var x=xutil.uid.getUID;var aS=xutil.fn.bind;var w=L.assert;var ao=L.ecuiAddEventListener;var aB=L.ecuiTriggerEvent;var ac=L.targetBlank;var u=Object.prototype.toString;var at=Object.prototype.hasOwnProperty;var aN=Array.prototype.push;var aW=L.isEcuiControl;var aZ=L.evalJsonLogic;var a=R.stringifyParam;var aq=xui.XObject;var J;var aP;$link(function(){aP=di.shared.arg.ArgHandlerFactory;J=di.shared.model.CommonParamFactory});$namespace().DIFactory=function(){if(!aX){aX={installClz:Q,getClz:aJ,addEntity:ar,removeEntity:t,createIns:aC,mountInteractions:ak,mountInteraction:aL,getDIMethod:O,getEntity:function(a5,a4){return a3(a5,a4=="RAW"?"DEF":a4)},findEntity:b,forEachEntity:az,createDIEvent:al,getRef:af,mergeOpt:an,setGlobalTemp:ai,getGlobalTemp:ah,setEventChannel:ab,getEventChannel:N,setInteractMemo:Y,getInteractMemo:H,rootSnippet:aV,isDIEvent:ae,setFuncAuth:q,INIT_EVENT_NAME:av,INIT_EVENT_AGENT_ID:aa}}return aX};var d="\x06diA^_^";var aT="\x06diM^_^";var aU="\x06diDef^_^";var S="\x06diEAgt^_^";var aH="\x06diEvt^_^";var P="\x06diTmp^_^";var c="\x06diOpt^_^";var M="\x06diOpt_cache^_^";var p="\x06diOpt_id^_^";var aG="\x06_";var av="\x06diEvt_init^_^";var aa="\x06diEvtAgtId_init^_^";var aj=["SNIPPET","COMPONENT","VUI","VCONTAINER","VPART"];var aE="di.shared.adapter.GeneralAdapterMethod";var j;var aX;var aA={CLZ:{},SNIPPET:{},SNIPPET_DEF:{},COMPONENT:{},COMPONENT_DEF:{},VUI:{},VUI_DEF:{},VCONTAINER:{},VCONTAINER_DEF:{},VPART:{},VPART_DEF:{}};var T;var K;var f={};var au={};var l={INS:function(a4,a5){return(this[aT+a4]||this[a4]).apply(this,Array.prototype.slice.call(arguments,1))},DEF:function(a4,a5){return a1[a4].apply(this,Array.prototype.slice.call(arguments,1))}};var A={start:function(a4){var a5=a4[P];this.$di("setId",a5.id);this.$di("setEl",a5.el);var a7=a3(a5.id,"DEF");if(a5.el&&a5.el.style.display=="none"){aI(this,"styleDisplay",a7.styleDisplay)}var a6;(a6=O(this,"setTplMode"))&&a6.call(this,a5.tplMode);(a6=O(this,"setCommonParamGetter"))&&a6.call(this,a5.commonParamGetter)},getDIFactory:function(){return aX},getMethod:function(a4){return O(this,a4)},getDef:function(){return a3(A.getId.call(this),"DEF")},setId:function(a4){aI(this,"id",a4)},getId:function(){return s(this,"id")},setEl:function(a4){aI(this,"el",a4)},getEl:function(a4){return s(this,"el")},setTplMode:function(a4){aI(this,"tplMode",a4)},getTplMode:function(){return s(this,"tplMode")},setCommonParamGetter:function(a4){aI(this,"commonParamGetter",a4)},getCommonParamGetter:function(){return s(this,"commonParamGetter")},getEventChannel:N,diShow:function(){var a7=this.$di("getDef");var a5=this.$di("getEl");var a6=s(this,"styleDisplay");var a4=s(this,"hideByAuth");if(a6!=null&&!a4){aI(this,"styleDisplay",null);a5.style.display=a6}},diHide:function(){var a4=this.$di("getEl");if(a4&&s(this,"styleDisplay")==null){aI(this,"styleDisplay",a4.style.display);a4.style.display="none"}},setDeaf:function(a5,a4){var a6="deaf";if(a5){B.add(this,a4,a6);aI(this,a6,true)}else{B.remove(this,a4,a6);(a4==null||B.size(this,a6)==0)&&aI(this,a6,false)}},isDeaf:function(){return s(this,"deaf")},setValueDisabled:function(a4,a5){var a6="valueDisabled";if(a4){B.add(this,a5,a6);aI(this,a6,true)}else{B.remove(this,a5,a6);(a5==null||B.size(this,a6)==0)&&aI(this,a6,false)}},isValueDisabled:function(){return s(this,"valueDisabled")},getClzType:"placeholder",disable:function(a4){B.add(this,a4);if(!s(this,"disabled")){aI(this,"disabled",true);this.disable&&this.disable()}},enable:function(a4){B.remove(this,a4);if(B.size(this)==0&&s(this,"disabled")){aI(this,"disabled",false);this.enable&&this.enable()}},getOpt:function(a6,a4){var a5=a3(this.$di("getId"),"RAW");return aK(a5,a6,a4,{clone:true})},setOpt:function(a7,a4,a6){var a5=a3(this.$di("getId"),"RAW");ay(a5,a7,a4,a6)},getRef:function(a6,a4,a5){return af(this,a6,a4,a5)},registerEventAgent:function(a4){k(this,a4)},addEventListener:function(bd,bh,bi,bk){w(bd&&bh&&bi,"Event listener can not be empty.");bk=bk||{};var a7=bk.argHandler;var bj=bk.dontClone;var a8=bk.once;var a6=bk.checkDeaf;var bc=bk.bindArgs||[];var a5=bk.id;var ba=bk.dispatcherId;var bb=bk.interactionId;var be=bk.viewDisableDef;var bf=bk.rule;var a9=bk.eventMatchMode;var bg=D(this,bd)||this;var a4=function(){if(a6!==false&&(aM(a6)?a6(bi):(bi&&bi.$di&&bi.$di("isDeaf")))){return}var bn=arguments[0];var bm=Array.prototype.slice.call(arguments,ae(bn)?(bn=U(bn),1):(bn=al(bd),0));i(bn,"dispatcherId",ba,true),i(bn,"interactionId",bb,true),bn.viewDisableDef=be;if(bf&&!aZ(bf,aS(z,null,bn))){return}!bj&&(bm=Z(bm));bm=a7?a7.call(bi,bm):bm;bi.$di&&Y(bi,"diEvent",bn);var bl=bh.apply(bi,bc.concat(bm));bi.$di&&Y(bi,"diEvent",void 0);return bl};if(bg instanceof aq){bg[a8?"attachOnce":"attach"](bd,a4)}else{if(aW(bg)){ao(bg,bd,a4,a8)}}bk=null},dispatchEvent:function(a4,a6,a5){a5=a5||{};var a8=D(this,a4)||this;var a7;if(ae(a4)){w(a8!=this,"如果使用diEvent，必须先registerEventAgent。");a7=a4;a4=a7.getEventName();(a6=a6||[]).splice(0,0,a7)}if(a8 instanceof aq){a8.notify(a4,a6)}else{if(aW(a8)){aB(a8,a4,null,a6)}}},funcAuthVerify:function(){var a4=V(this,"vuiSet");var a6;var a7;for(var a5 in a4){a6=a4[a5];a7=a6.$di("getDef");if(a7.funcAuth&&!(a7.funcAuth in au)){a6.$di("getEl").style.display="none";aI(a6,"hideByAuth",true)}}},vuiCreate:function(a6,bd){var a5=this.$di("getRef","vuiRef",a6,"DEF");if(!a5){return null}bd=an(a5,am({},bd,{id:a5.id,el:a5.el}),"DATA_INIT");var a9=V(this,"vuiSet");var a7=a0(a6);w(!a9[a7],"vui已经存在: refPath="+a6+" vuiSetKey="+a7);if(aK(a5,"cfgOpt","paramMode")==null){ay(a5,"cfgOpt","paramMode","NORMAL")}var a4=a5.adapterMethod||{};var a8=a5.adapter&&a5.adapter(a5,bd)||{};var ba;if(a8.create){ba=a8.create(a5,bd)}else{if(a4.create){ba=j[a4.create](a5,bd)}}if(!ba){return null}ba.$di=l.INS;aI(ba,"id",a5.id);aI(ba,"el",a5.el);if(a5.el&&a5.el.style.display=="none"){aI(ba,"styleDisplay",a5.styleDisplay)}a9[a7]=ba;ar(ba,"INS");var bb;var bc;for(bc in a4){if(bc!="create"){m(ba,bc,j[bc])}}for(bc in a8){if(bc!="create"){m(ba,bc,a8[bc])}}ad(ba);aQ(ba);ax(ba);g(ba,a9,a7);return ba},vuiGet:function(a4){return V(this,"vuiSet")[a0(a4)]},vpartCreate:function(a7,a6){var a8=this.$di("getRef","vpartRef",a7,"DEF");if(!a8){return null}a6=an(a8,am({},a6,{id:a8.id,el:a8.el}),"DATA_INIT");var a4=V(this,"vpartSet");var a9=a0(a7);w(!a4[a9],"vpart已经存在: refPath="+a7+" vpartSetKey="+a9);var a5=new a8.clz(a6);if(!a5){return null}a5.$di=l.INS;aI(a5,"id",a8.id);aI(a5,"el",a8.el);if(a8.el&&a8.el.style.display=="none"){aI(a5,"styleDisplay",a8.styleDisplay)}a4[a9]=a5;ar(a5,"INS");g(a5,a4,a9);return a5},vpartGet:function(a4){return V(this,"vpartSet")[a0(a4)]},getValue:function(){var a5=this.$di("getDef");var a9=a5.valueDisabledMode;var a6=this.$di("isValueDisabled");if(a6&&a9=="NORMAL"){return null}var bc={};var a8=V(this,"vuiSet");var a7;var bb;var a4;if(this.getValue){bc=this.getValue()||{}}var ba;for(var bd in a8){a7=a8[bd];bb=a7.$di("getDef");ba=a6||a7.$di("isValueDisabled");if(bb.name==null||(ba&&a9=="NORMAL")){continue}bc[bb.name]=ba&&a9=="DI"?null:(I(a4=a7.$di("getValue"))?J.markParamMode(a4,aK(bb,"cfgOpt","paramMode")):a4)}return bc},getEvent:function(){var a4=H(this,"diEvent");return a4},syncViewDisable:function(a7,a4){w(a7=="enable"||a7=="disable","Wrong actName: "+a7);var a8=this.$di("getDef");var a6="ASYNC_VIEW_DISABLE_"+this.$di("getId");var a5=(a8.sync||{}).viewDisable;C(a5=="ALL"?a5:(I(a5)&&a5[a4]),a7,a6)},linkBridge:function(a4,a5,a6){if(a4=="I"){ac(a5+"?"+a6)}else{if(a4=="E"){K&&K.triggerEvent("linkbridge",[a5,a6])}}}};var a1={getDIFactory:A.getDIFactory,getMethod:function(a4){return a1[a4]},setId:function(a4){this.id=a4},getId:function(){return this.id},getOpt:A.getOpt,setOpt:A.setOpt,getRef:A.getRef};function z(a4,a6){var a5={includes:ag,excludes:ag,equals:aD};w(a6.operator in a5,"Illegal rule: "+a6.operator);return a5[a6.operator](a4,a6)}function ag(a6,a8){if(!a6){return false}var a7={includes:{},excludes:{}};for(var a4=0;a4<(a8.interactionIds||[]).length;a4++){a7[a8.operator][a8.interactionIds[a4]]=1}var bb=n(a6,"interactPath");for(var a5=0,ba,a9;ba=bb[bb.length-a5-1];a5++){a9=n(ba,"interactionId");if(a9 in a7.excludes){return false}if(a7.includes[a9]){delete a7.includes[a9]}}if(!a2(a7.includes)){return false}return true}function aD(a4,a5){var a6=r(a5).call(null,[])[0];return a6==a5.value}function al(a5,a6){a6=a6||{};var a4=function(a9){return al(a9,{interactPath:a4[aH].interactPath})};var a7=a4[aH]={eventName:a5,dispatcherId:a6.dispatcherId,interactionId:a6.interactionId,interactPath:(a6.interactPath||[]).slice()};var a8=a7.interactPath;a6.isClone?a8.splice(a8.length-1,1,a4):a8.push(a4);am(a4,ap);return a4}var ap={getEventName:function(){return this[aH].eventName},getInteractionId:function(){return this[aH].interactionId}};function U(a5){var a4=a5[aH];return al(a4.eventName,{dispatcherId:a4.dispatcherId,interactionId:a4.interactionId,interactPath:a4.interactPath,isClone:true})}function n(a5,a4){return a5[aH][a4]}function i(a6,a5,a7,a4){if(a4&&a6[aH][a5]!==void 0){throw new Error('请使用diEvent("newEventName")创建新的diEvent实例')}a6[aH][a5]=a7}function ae(a4){return I(a4)&&a4[aH]}function X(a9,ba){var a7=a9[M];if(!a7){a7=a9[M]={}}a7[ba]={};var a6=a9[c];if(!a6){a6=a9[c]={}}var a5=a6[ba]=a9[ba]||{};var a8=a6[ba+"s"]=a9[ba+"s"]||[];a9[ba]=null;a9[ba+"s"]=null;a5[p]="DI_OPT_"+x("DI_OPT");for(var a4=0;a4<a8.length;a4++){a8[a4][ba][p]="DI_OPT_"+x("DI_OPT")}}function aK(a8,bi,bd,bj){bj=bj||{};var bb=a8[c];var a6=a8[M][bi];var a5=bb[bi];var a4=bb[bi+"s"];var a9=bj.diEvent;var ba;var a7;var bc;var bh=[];var bf=[];var bg=aS(z,null,a9);bh.push(a5);bf.push(a5[p]);for(ba=0;ba<a4.length;ba++){if((a7=a4[ba])&&a7.rule&&a7[bi]&&aZ(a7.rule,bg)){bh.push(a7[bi]);bf.push(a7[bi][p])}}var be=bf.join(aG);if(!(bc=a6[be])){bc=a6[be]={};for(ba=0;ba<bh.length;ba++){E(bc,bh[ba],{overwrite:true,clone:"WITHOUT_ARRAY"})}}if(bd!=null){bc=bc[bd]}return bj.clone?F(bc,{exclusion:[M]}):bc}function ay(a6,a7,a4,a5){a6[c][a7][a4]=a5;a6[M][a7]={}}function an(a5,ba,a7,be){a5=a5||{};be=be||{};var a8={};var bc={overwrite:true,clone:"WITHOUT_ARRAY"};var bb=am({},bc,{exclusion:[p]});var a4={diEvent:be.diEvent};var a6=aJ(a5.clzKey)||{};var bd=aK(a6,"dataOpt",null,a4);var a9=aK(a5,"dataOpt",null,a4);E(a8,bd,bb);E(a8,ba,bc);E(a8,a9,bb);if(a7=="DATA_SET"){E(a8,aK(a5,"dataSetOpt",null,a4),bb)}else{if(a7=="DATA_INIT"){E(a8,aK(a5,"dataInitOpt",null,a4),bb)}else{throw new Error("error optType:"+a7)}}be.forceData&&E(a8,be.forceData,bc);return a8}function r(a4,a7){var a5;var a8=[];if(a5=a4.argHandler){a8.push(a5)}if(a5=a4.argHandlers){a8.push.apply(a8,a5)}for(var a6=0;a6<a8.length;a6++){a8[a6]=[a7].concat(a8[a6])}return aP.apply(null,a8)}function Q(){var a6;var a4;var a5;j=aO(aE,$getNamespaceBase());for(a6 in v.CLZ){aA.CLZ[a6]=a4=F(v.CLZ[a6]);if(a4.clzPath&&(a4.clz=aO(a4.clzPath,$getNamespaceBase()))){a5=a4.clz.prototype;a5.$di=l.INS;W(a5,["start","getDIFactory","setId","getId","getDef","isDeaf","setDeaf","setEl","getEl","disable","enable","diShow","diHide","setValueDisabled","isValueDisabled","addEventListener","dispatchEvent","registerEventAgent","getOpt","setOpt","getRef"],A);if(a4.clzType=="COMPONENT"){W(a5,["setTplMode","getTplMode","vuiCreate","vuiGet","getValue","getEvent","getEventChannel","getCommonParamGetter","setCommonParamGetter","linkBridge","syncViewDisable","funcAuthVerify"],A)}if(a4.clzType=="VCONTAINER"){W(a5,["vpartCreate","vpartGet"],A)}m(a5,"getClzType",(function(a7){return function(){return a7}})(a4.clzType))}a4.adapterPath&&(a4.adapter=aO(a4.adapterPath,$getNamespaceBase()));X(a4,"dataOpt");X(a4,"dataInitOpt");X(a4,"dataSetOpt");X(a4,"valueGetOpt");X(a4,"cfgOpt")}}function W(a8,a5,a4){for(var a7=0,a6,a9;a6=a5[a7];a7++){m(a8,a6,a4[a6])}}function ad(a4){var a5=O(a4,"setData");m(a4,"setData",a5?function(a7,a6){a6=a6||{};a7=an(this.$di("getDef"),a7,"DATA_SET",a6);return a5.call(this,a7)}:new Function())}function aQ(a4){var a5=O(a4,"getValue");m(a4,"getValue",a5?function(){return this.$di("isValueDisabled")?null:a5.call(this)}:new Function())}function ax(a4){var a5=O(a4,"init");m(a4,"init",function(){ak(a4);a5&&a5.call(this)})}function g(a5,a6,a4){var a7=O(a5,"dispose");m(a5,"dispose",function(){delete a6[a4];t(a5);a7&&a7.call(this);this.$di("setEl",null)})}function aC(a7,a5){a5=a5||{};var a6={id:a7.id,el:a7.el,tplMode:a5.tplMode||"FROM_SNIPPET",commonParamGetter:a5.commonParamGetter};a6[P]=am({},a6);var a4=new a7.clz(an(a7,am(a5,a6),"DATA_INIT"));ar(a4);return a4}function ak(a4){var a7=a4.$di("getDef");if(!a7.interactions){return}for(var a5=0,a6;a6=a7.interactions[a5];a5++){aL(a4,a6)}}function aL(a7,a9){var ba=a7.$di("getDef");var a8=[];a9.event&&a8.push(a9.event);a9.events&&aN.apply(a8,a9.events);for(var a6=0,a5,a4;a6<a8.length;a6++){a5=a8[a6];a4=a5.triggerIns||a3(a5.rid,"INS");w(a4.$di("getDef").clzType!="VUI","不允许监听vui事件");if(!a4){return}a4.$di("addEventListener",a5.name,O(a7,a9.action.name),a7,{interactionId:a9.id,dispatcherId:a5.rid,argHandler:r(a9,a7),once:a9.once,viewDisableDef:a9.viewDisable,rule:a5.rule?["and",a9.rule,a5.rule]:a9.rule})}}function af(a7,a9,a6,a8,a5){a5=a5||{};var a4=(a3(a7.$di("getId"),"DEF")||{})[a9];if(!a4){return null}return b(aO(a6,a4),a8,{isClone:true,flatReturn:a5.flatReturn})}function m(a7,a4,a8,a5){a5==null&&(a5=true);var a6=aT+a4;if(a5||!a7[a6]){a7[a6]=a8}}function O(a5,a4){return a5[aT+a4]||a5[a4]}function aJ(a4){return aA.CLZ[a4]}function ar(a6,a5){if(a5=="DEF"){if(a6.clzType&&a6.id){var a4=aJ(a6.clzKey||v.DEFAULT_CLZ_KEY[a6.clzType]);a6=E(F(a4),a6);a6[aU]=true;a6.$di=l.DEF;X(a6,"dataOpt");X(a6,"dataInitOpt");X(a6,"dataSetOpt");X(a6,"cfgOpt");aA[a6.clzType+"_DEF"][a6.id]=aR({},a6)}}else{aA[a6.$di("getClzType")][a6.$di("getId")]=a6}return aX}function t(a4){if(a4[aU]){delete aA[a4.clzType+"_DEF"][a4.id]}else{delete aA[a4.$di("getClzType")][a4.$di("getId")]}}function a3(bb,ba){var a8=ba=="INS"?"":"_DEF";var a9;var a5;var a4;for(var a6=0,a7;a7=aj[a6];a6++){if(a7!="CLZ"&&(a9=aA[a7+a8][bb])){if(ba=="INS"||ba=="RAW"){return a9}else{a5=F(a9,{exclusion:[M]});a5[M]=a9[M];return a5}}}return null}function b(a8,a9,a5){a5=a5||{};var a4;var a6;var a7=a5.flatReturn?[]:null;if(e(a8)){a4=a5.isClone?[]:a8;for(a6=0;a6<a8.length;a6++){a8.hasOwnProperty(a6)&&(a4[a6]=b(a8[a6],a9))}}else{if(I(a8)){a4=a5.isClone?{}:a8;for(a6 in a8){a8.hasOwnProperty(a6)&&(a4[a6]=b(a8[a6],a9))}}else{a4=a3(a8,a9);a7&&a7.push(a4)}}return a7?a7:a4}function az(a7,ba){a7=aY(a7)?[a7]:(a7||[]);for(var a6=0,a9,a4,a5;a9=a7[a6];a6++){var a5=aA[a9+"_DEF"];var a4=aA[a9];for(var a8 in a5){a5[a8]&&ba(a5[a8],a4[a8],a8)}}}function aI(a6,a4,a5){if(a6&&a4!=null){a6[d+a4]=a5}}function s(a5,a4){if(a5&&a4!=null){return a5[d+a4]}return null}function V(a4,a5,a6){if(a6===void 0){a6={}}var a7=s(a4,a5);if(a7===void 0){aI(a4,a5,a7=a6)}return a7}function aw(a6,a5){var a4=s(a6,a5);if(a4==null){a4=(ah("DI_DEF_FOR_NEW")||{})[a5]}return a4}function ab(a4){K=a4}function N(){return K}function ai(a4,a5){f[a4]=a5}function ah(a4){return f[a4]}function a0(a4){return a4.replace(/[\]\s]/g,"").replace(/\[/g,".")}function k(a6,a4){var a5=a6[S];if(!a5){a5=a6[S]=new aq();a5.eventNameMap={}}if(a4!=null){a5.eventNameMap[a4]=1}else{a5.eventNameAll=1}}function D(a6,a4){var a5=a6[S];if(a5&&(a5.eventNameAll||a5.eventNameMap[a4])){return a5}}function aV(a5){a5&&(aV=a5)||(a5=aV);var a4=a3(a5,"DEF");w(a4,"no def. id="+a5);return a4}function q(a5){if(!a5){return}au={};for(var a4=0;a4<(a5||[]).length;a4++){au[a5[a4]]=1}}function C(a6,a9,a8){if(!a6){return null}var a4=aA.COMPONENT;var ba=aA.VCONTAINER;if(a6=="ALL"){a6=[];for(bb in a4){a6.push(bb)}for(bb in ba){a6.push(bb)}}for(var a7=0,a5,bb;a7<a6.length;a7++){bb=a6[a7];a5=a4[bb]||ba[bb];a5&&a5.$di(a9,a8)}}function Y(a6,a4,a7){var a5=s(a6,"interactMemo");if(!a5){aI(a6,"interactMemo",a5={})}if(a7!==void 0){a5[a4]=a7}else{delete a5[a4]}}function H(a6,a4){var a5=s(a6,"interactMemo");return a5?a5[a4]:void 0}function Z(a7){var a5;var a8;var a4;var a6=u.call(a7);var a9;if(a6=="[object Date]"){a5=new Date(a7.getTime())}else{if(a6=="[object Function]"||a6=="[object RegExp]"){a5=a7}else{if((a9=a6=="[object Array]")||a7===Object(a7)){a5=a9?[]:{};!a9&&y(a7);for(a8 in a7){if(a7.hasOwnProperty(a8)){a5[a8]=Z(a7[a8])}}}else{a5=a7}}}return a5}function y(a5){var a4=true;if(Object.prototype.toString.call(a5)!="[object Object]"||!("isPrototypeOf" in a5)){a4=false}if(a5.constructor&&!at.call(a5,"constructor")&&!at.call(a5.constructor.prototype,"isPrototypeOf")){a4=false}if(!a4){throw new Error("Object can not be clone: "+a5)}}})();$namespace("di.shared.model");(function(){var i=di.config.URL;var g=di.helper.Util;var f=xutil.object.inheritsObject;var b=xutil.url.wrapArrayParam;var h=xutil.object.extend;var l=g.logError;var j=xutil.uid.getUID;var a=xui.XDatasource;var d=$namespace().DIFormModel=f(a,e);var k=d.prototype;function e(m){this._fCommonParamGetter=m.commonParamGetter}k.init=function(){};k.url=new a.Set({DATA:i("FORM_DATA"),ASYNC_DATA:i("FORM_ASYNC_DATA")});k.businessKey=new a.Set({DATA:"DI_FORM_MODEL_DATA_"+j(),ASYNC_DATA:"DI_FORM_MODEL_ASYNC_DATA_"+j()});k.complete=new a.Set({DATA:c,ASYNC_DATA:c});function c(m){this._fCommonParamGetter.update(m.data)}k.param=new a.Set({DATA:function(m){return this._fCommonParamGetter(m.args.param)},ASYNC_DATA:function(m){return this._fCommonParamGetter(m.args.param)}});k.parse=new a.Set({DATA:function(p,n,m){this._oInitData=(p||{}).params||{};return p},ASYNC_DATA:function(p,n,m){return(p||{}).params||{}}});k.error=new a.Set({DATA:function(m,p,n){},ASYNC_DATA:function(m,p,n){}});k.getInitData=function(){return this._oInitData}})();$namespace("di.shared.model");(function(){var m=di.config.URL;var j=di.helper.Util;var g=xutil.object.inheritsObject;var b=xutil.url.wrapArrayParam;var l=xutil.object.extend;var p=j.logError;var n=xutil.uid.getUID;var a=xui.XDatasource;var q=$namespace().DITableModel=g(a,f);var k=q.prototype;function f(r){this._fCommonParamGetter=r.commonParamGetter}k.init=function(){};k.url=new a.Set({DATA:m("OLAP_TABLE_DATA"),DRILL:m("OLAP_TABLE_DRILL"),LINK_DRILL:m("OLAP_TABLE_LINK_DRILL"),SORT:m("OLAP_TABLE_SORT"),CHECK:m("OLAP_TABLE_CHECK"),SELECT:m("OLAP_TABLE_SELECT"),OFFLINE_DOWNLOAD:m("OLAP_TABLE_OFFLINE_DOWNLOAD")});k.businessKey=new a.Set({DATA:"DI_TABLE_MODEL_DATA_"+n(),DRILL:"DI_TABLE_MODEL_DRILL_"+n(),LINK_DRILL:"DI_TABLE_MODEL_LINK_DRILL_"+n(),SORT:"DI_TABLE_MODEL_SORT_"+n(),CHECK:"DI_TABLE_MODEL_CHECK_"+n(),SELECT:"DI_TABLE_MODEL_SELECT_"+n(),OFFLINE_DOWNLOAD:"DI_TABLE_OFFLINE_DOWNLOAD_"+n()});k.param=new a.Set({DATA:function(r){return this._fCommonParamGetter(r.args.param)},DRILL:function(r){return e.call(this,r)},LINK_DRILL:function(r){return e.call(this,r)},SORT:function(r){var s=r.args.param;return this._fCommonParamGetter({uniqueName:s.uniqueName,sortType:s.currentSort})},CHECK:function(r){return this._fCommonParamGetter({uniqueName:r.args.param.uniqueName})},SELECT:function(r){return this._fCommonParamGetter({uniqueName:r.args.param.uniqueName})},OFFLINE_DOWNLOAD:function(r){return this._fCommonParamGetter({mailTo:r.args.param.email})}});function e(r){var t=r.args.param;var s={};s.uniqueName=t.uniqueName;s.lineUniqueName=t.lineUniqueName;s.action=t.action;s.drillAxisName="ROW";return this._fCommonParamGetter(s)}k.complete=new a.Set({DATA:c,DRILL:c,LINK_DRILL:c,SORT:c,CHECK:c,OFFLINE_DOWNLOAD:c});function c(r){this._fCommonParamGetter.update(r.data)}k.parse=new a.Set({DATA:h,DRILL:h,LINK_DRILL:h,SORT:h,CHECK:function(r){return r},SELECT:function(r){return r}});function h(x,G,H){try{var A={};var t=A.tableData=x.pivottable;t.datasource=t.dataSourceRowBased;var y;var v;var s;var u;var B;var F=t.colFields[0];var E=t.colDefine;var r=[];for(y=0;y<F.length;y++){s=F[y];if(!s){continue}u=s.colspan||1;for(v=0;v<u;v++){r.push({width:1})}}B=r.length-E.length;for(y=0;y<E.length;y++){l(r[y+B],E[y])}t.colDefine=r;i(t,B);d(t,B);var w;var z={ASC:"asc",DESC:"desc",NONE:"none"};for(y=0;y<r.length;y++){if(w=r[y].currentSort){r[y].orderby=z[w]}}A.tableData.rowCheckMax=x.rowCheckMax;A.tableData.rowCheckMin=x.rowCheckMin;var D=x.mainDimNodes||[];if(D){for(y=0;s=D[y];y++){s.text=s.showName;s.value=y;s.url=null;if(y==D.length-1){s.disabled=true}if(y==0){s.isFirst=true}}}A.breadcrumbData={datasource:D,maxShow:5,hidePosPercent:0.5};A.pageInfo={totalRecordCount:x.totalSize,currRecordCount:x.currentSize};return A}catch(C){p(C);this.$goError()}}function i(t,y){var x;var w;var v;var s;var A;var z;var u;var r=[];for(x=0;z=t.colFields[x];x++){r.push(A=[]);if(x>0){for(v=0;v<y;v++){A.push({})}}for(w=0;w<z.length;w++){A.push(s=z[w]);u=(s||{}).colspan||1;for(v=1;v<u;v++){A.push({})}}}t.colFields=r}function d(x,s){var v;var t;var r;var u;var w=[];for(v=0;u=x.rowHeadFields[v];v++){w.push(r=[]);for(t=0;t<s-u.length;t++){r.push({})}for(t=0;t<u.length;t++){r.push(u[t])}}x.rowHeadFields=w}k.error=new a.Set({DATA:function(r,t,s){this._oTableData={};this._oBreadcrumbData={}}})})();$namespace("di.shared.model");(function(){var C=di.helper.Formatter;var k=di.config.Dict;var e=di.config.Lang;var d=di.config.URL;var h=di.helper.Util;var m=ecui.dom.create;var c=ecui.dom.getStyle;var A=xutil.object.extend;var i=xutil.object.getByPath;var s=xutil.object.inheritsObject;var p=xutil.dom.q;var z=xutil.dom.g;var E=xutil.fn.bind;var v=xutil.object.assign;var b=xutil.lang.hasValue;var r=xutil.date.stringToDate;var u=xutil.date.dateToString;var y=xutil.url.textParam;var t=xutil.url.wrapArrayParam;var w=Array.prototype.push;var a=h.download;var B=h.logError;var f=ecui.ui.Control;var n=xui.XDatasource;var j=$namespace().DimSelectModel=s(n,x);var l=j.prototype;function x(g){this._oHierarchyRoot;this._oCurrDimTree;this._sDimName;this._sSchemaName;this._sDimType;this._oLevelMap}var D={TREE:{TABLE:d("DIM_TREE_TABLE"),CHART:d("DIM_TREE_CHART")},SAVE:{TABLE:d("DIM_SELECT_SAVE_TABLE"),CHART:d("DIM_SELECT_SAVE_CHART")}};l.url=function(g){return D[g.datasourceId][g.args.reportType]};l.param=new n.Set({TREE:function(g){var q=this.$createBaseParam(g);if(g.args.dimMode=="TIME"){q.push("isTimeDim=true")}return q.join("&")},SAVE:function(F){var q=F.args;var G=this.$createBaseParam(F);G.push("hierarchyName="+y(this._oCurrDimTree.name));w.apply(G,t(q.treeSelected,"selectedNodes"));w.apply(G,t(q.levelSelected,"levelUniqueNames"));if(q.dimMode=="TIME"){var H=q.timeSelect.start?u(q.timeSelect.start):"";var g=q.timeSelect.end?u(q.timeSelect.end):H;G.push("startDay="+H);G.push("endDay="+g)}return G.join("&")}});l.parse=new n.Set({TREE:function(I,G,q){try{var H=I.timeType;this._oTimeSelect=I.timeSelects||{};var F=I.dimTree;var g=this._oHierarchyRoot=F.dimTree;this._oCurrDimTree=g.children[0];this._oLevelMap=F.hierarchyLevelUniqueNames;this._sDimName=F.dimName;this._sSchemaName=F.schemaName;this._sDimType=F.isTimeDim?"TIME":"NORMAL"}catch(J){B(J);this.$goError()}}});l.getCurrDimTree=function(){return this._oCurrDimTree};l.getTimeSelect=function(){return this._oTimeSelect};l.getCurrLevelList=function(){return(this._oLevelMap&&this._oCurrDimTree)?this._oLevelMap[this._oCurrDimTree.name]:null};l.$createBaseParam=function(q){var g=q.args;var F=[];if(g.commonParamGetter){F.push(g.commonParamGetter())}F.push("dimSelectName="+y(g.uniqName));F.push("from="+y(g.selLineName));return F}})();$namespace("di.shared.model");(function(){var a=ecui.inheritsModel;var f=xutil.fn.bind;var b=xutil.object.getByPath;var e=xui.XDatasource;var d=$namespace().GlobalMenuManager=a(e);var c=d.prototype;c.init=function(){};c.$dispose=function(){d.superClass.$dispose.call(this)};c.getSelected=function(){!this.businessData&&this.sync();return this.businessData&&this.businessData.selMenu};c.getMenuData=function(){!this.businessData&&this.sync();return this.businessData&&this.businessData.menuList};c.getControlClass=function(){var g=(this.getSelected()||{}).menuPage;return g?b(g):null};c.parse=function(h){var g=h&&h.globalMenu||{};this.businessData={menuList:g.menuList,selMenu:g.selMenu};return this.businessData};c.changeMenu=function(g){}})();$namespace("di.shared.model");(function(){var f=ecui.util.inherits,b,e,g,j,a=xui.XDatasource;$link(function(){var k=di.shared;b=k.model.UserModel;e=k.model.AuthModel;g=k.model.DateModel;j=k.model.GlobalMenuManager});var i=$namespace().GlobalModel=function(){return h||(h=new c())};var d=f(i,a);function c(){a.client.call(this);this._oHTMLData=$getNamespaceBase().HTML_DATA;this._sGlobalType=this._oHTMLData.globalType;this.addSyncCombine(this._mUserModel=new b());this.addSyncCombine(this._mAuthModel=new e());this.addSyncCombine(this._mDateModel=new g());if(this._sGlobalType=="CONSOLE"){this.addSyncCombine(this._mGlobalMenuManager=new j())}}var h;d.init=function(){this.sync()};d.local=function(){return this.wrapEJson(this._oHTMLData)};d.getDateModel=function(){return this._mDateModel};d.getUserModel=function(){return this._mUserModel};d.getAuthModel=function(){return this._mAuthModel};d.getGlobalMenuManager=function(){return this._mGlobalMenuManager};f(c,i)})();$namespace("di.shared.model");(function(){var l=ecui.inheritsModel;var k=ecui.dom.create;var a=ecui.util.getModel;var f=xutil.fn.bind;var j=xutil.url.parseParam;var d=xutil.lang.isString;var e=xutil.object.getByPath;var h=di.helper.Util.ecuiCreate;var c=xui.XDatasource;var i;$link(function(){i=di.shared.model.GlobalModel});var g=$namespace().MenuPageManager=l(c);var b=g.prototype;b.init=function(){this._uMenu.onchange=f(this.$menuChangeHandler,this);this._mPanelPageManager.attach("page.active",this.$pageActiveHandler,this)};b.param=function(m){var n=a(i(),"globalMenuManager").getSelected()||{};return"rootMenuId="+(n.menuId||"")};b.parse=function(m){var n=m.menuTree;if(n){this._uMenu.setData(n.menuList)}};b.$menuChangeHandler=function(q){var r,m,p,t;var u=q.menuId;m=q.menuUrl.split("?");p=e(m[0]);t=j(m[1]);var s=q.menuName;if(t&&t.reportType=="TABLE"){s="[表] "+s}else{if(t&&t.reportType=="CHART"){s="[图] "+s}}var n;if(true||!this._mPanelPageManager.exists(u)){n=this._mPanelPageManager.add(function(v){var x,w;v.el.appendChild(x=k());w=h(p,x,v.parent,t);w.init();return w},{title:s,canClose:true})}this._mPanelPageManager.select(n)};b.$pageActiveHandler=function(m){this._uMenu.select(m)}})();$namespace("di.shared.model");(function(){var E=di.helper.Formatter;var l=di.config.Dict;var h=di.config.Lang;var f=di.config.URL;var i=di.helper.Util;var s=xutil.object.inheritsObject;var n=xutil.dom.q;var A=xutil.dom.g;var G=xutil.fn.bind;var B=xutil.object.extend;var w=xutil.object.assign;var r=baidu.json.parse;var u=baidu.json.stringify;var d=xutil.lang.hasValue;var p=xutil.date.stringToDate;var v=xutil.date.dateToString;var z=xutil.url.textParam;var j=xutil.url.numberParam;var x=Array.prototype.push;var t=xutil.url.wrapArrayParam;var C=i.logError;var k=xutil.LinkedHashMap;var m=xui.XDatasource;var c=$namespace().MetaConditionModel=s(m,y);var e=c.prototype;function y(g){this._sReportType=g.reportType||"TABLE";this._fCommonParamGetter=g.commonParamGetter||function(){return""};this._oIndList=new k(null,"uniqName");this._oDimList=new k(null,"uniqName");this._oSelLineWrap=new k(null,"k","l");this._oStatusWrap={}}e.init=function(){};var F={META_DATA:{TABLE:f("META_CONDITION_IND_DIM_TABLE"),CHART:f("META_CONDITION_IND_DIM_CHART")},SELECT:{TABLE:f("META_CONDITION_SELECT_TABLE"),CHART:f("META_CONDITION_SELECT_CHART")}};e.url=function(g){return F[g.datasourceId][this._sReportType]};e.param=new m.Set({META_DATA:function(g){return this._fCommonParamGetter()},SELECT:function(H){var q=H.args;var g=q.changeWrap;var I=[];I.push(this._fCommonParamGetter());x.apply(I,t(g.uniqNameList,"uniqNameList"));I.push("from="+z(g.from));I.push("to="+z(g.to));I.push("toPosition="+j(g.toPosition,-1));return I.join("&")}});e.parse=new m.Set({META_DATA:function(q,L,N){try{var K=this;var g=q.metaData;this._oIndList.appendAll(g.inds);this._oDimList.appendAll(g.dims);a.call(this,this._oIndList,"IND");a.call(this,this._oDimList,"DIM");this._oSeriesCfg=q.seriesTypes;for(var H=0,M,J;M=q.index4Selected[H];H++){this._oSelLineWrap.addLast({k:M,l:J=new k(q.selected[M],"uniqName")});a.call(this,J)}}catch(I){C(I);this.$goError()}},SELECT:function(H,q,g){try{this._oStatusWrap=H.metaStatusData;D.call(this,this._oStatusWrap.indMetas,this._oIndList);D.call(this,this._oStatusWrap.dimMetas,this._oDimList);this.$updateSelected(g.args.changeWrap)}catch(I){C(I);this.$goError()}}});e.error=new m.Set({META_DATA:function(g,H,q){this._oIndList.clean();this._oDimList.clean();this._oSelLineWrap.clean();this._oStatusWrap={}},SAVE:function(g,H,q){}});function a(H,g){var q=this;H.foreach(function(I,J){if(g){J.clazz=g}else{if(q._oIndList.containsKey(J.uniqName)){J.clazz="IND"}else{if(q._oDimList.containsKey(J.uniqName)){J.clazz="DIM"}}}})}function D(q,J){J.foreach(function(K,M,L){M.status=l.META_STATUS.DISABLED});!q.validMetaNames&&(q.validMetaNames=[]);!q.selectedMetaNames&&(q.selectedMetaNames=[]);var g;var I;var H;for(g=0;I=q.validMetaNames[g];g++){if(H=J.get(I)){H.status=l.META_STATUS.NORMAL}}for(g=0;I=q.selectedMetaNames[g];g++){if(H=J.get(I)){H.status=l.META_STATUS.SELECTED}}q.disabledMetaNames=[];J.foreach(function(K,M,L){if(M.status==l.META_STATUS.DISABLED){q.disabledMetaNames.push(K)}})}e.getSelLineWrap=function(){return this._oSelLineWrap};e.getIndDim=function(){return{indList:this._oIndList,dimList:this._oDimList}};e.getStatusWrap=function(){return this._oStatusWrap};e.getMetaItem=function(g){var q=this._oIndList.get(g);if(!q){q=this._oDimList.get(g)}return q};e.diffSelected=function(H){var I;var K;var J;var g={uniqNameList:[]};for(var q in H){I=this._oSelLineWrap.get(q);b.call(this,q,H[q],I,g)}return g};function b(N,H,M,P){if(H.length==M.size()){var I;var J;var O;var q;var K;M.foreach(function(R,S,Q){if(J==null){if(R!=H[Q]){I=R;J=Q}}else{if(I==H[Q]){O=Q}if(H[J]==R){q=Q;K=R}}});if(J!=null){P.from=N;P.to=N;P.fromLineData=H;P.toLineData=H;if(q>O){P.uniqName=K;P.toPosition=J}else{P.uniqName=I;P.toPosition=O}P.uniqNameList.push(P.uniqName)}}else{if(H.length>M.size()){for(var L=0,g;L<H.length;L++){g=H[L];if(!M.containsKey(g)){P.uniqName=g;P.uniqNameList.splice(0,1,g);P.to=N;P.toLineData=H;if(P.toPosition==null){P.toPosition=L}}}}else{if(H.length<M.size()){M.foreach(function(R,S,Q){if(H[Q]!=R){P.uniqName=R;P.uniqNameList.push(R);P.from=N;P.fromLineData=H;return false}})}}}P.uniqNameList.splice(1,P.uniqNameList.length-1)}e.$updateSelected=function(g){var L=g.from!=g.to?this._oSelLineWrap.get(g.from):null;var J=this._oSelLineWrap.get(g.to);var q=g.fromLineData;var K=g.toLineData;var H=0;var I;if(L){L.cleanWithoutDefaultAttr();for(H=0;H<q.length;H++){I=q[H];L.addLast(this.getMetaItem(I))}}if(J){J.cleanWithoutDefaultAttr();for(H=0;H<K.length;H++){I=K[H];J.addLast(this.getMetaItem(I))}}}})();$namespace("di.shared.model");(function(){var z=di.helper.Formatter;var l=di.config.Dict;var f=di.config.Lang;var e=di.config.URL;var j=di.helper.Util;var t=xutil.object.inheritsObject;var n=xutil.dom.q;var w=xutil.dom.g;var B=xutil.fn.bind;var x=xutil.object.extend;var u=xutil.object.assign;var s=baidu.json.parse;var y=j.logError;var r=xutil.uid.getUID;var k=xutil.LinkedHashMap;var p=xui.XDatasource;var m=$namespace().OlapMetaConfigModel=t(p,v);var i=m.prototype;function v(g){this._sReportType=g.reportType||"TABLE";this._fCommonParamGetter=g.commonParamGetter;this._oIndList=new k(null,"uniqName");this._oDimList=new k(null,"uniqName");this._oSelLineWrap=new k(null,"k","l");this._oStatusWrap={};this._oSeriesCfg=null}i.init=function(){};var A={TABLE:{DATA:e("META_CONDITION_IND_DIM_TABLE"),SELECT:e("META_CONDITION_SELECT_TABLE")},CHART:{DATA:e("META_CONDITION_IND_DIM_CHART"),SELECT:e("META_CONDITION_SELECT_CHART"),LIST_SELECT:e("META_CONDITION_LIST_SELECT_CHART")}};i.url=function(g){return A[this._sReportType][g.datasourceId]};i.businessKey=new p.Set({DATA:"OLAP_META_CONFIG_MODEL_DATA_"+r(),SELECT:"OLAP_META_CONFIG_MODEL_SELECT_"+r()});i.complete=new p.Set({DATA:h,SELECT:h});function h(g){this._fCommonParamGetter.update(g.data)}i.param=new p.Set({DATA:function(g){return this._fCommonParamGetter(g.args.param)},SELECT:function(q){var g=q.args.changeWrap;var C=[];var D={from:g.from,to:g.to,toPosition:g.toPosition!=null?g.toPosition:-1,needShowCalcInds:q.args.needShowCalcInds,uniqNameList:[]};D.uniqNameList.push.apply(D.uniqNameList,g.uniqNameList);return this._fCommonParamGetter(D)},LIST_SELECT:function(g){var q={indNames:[g.args.selected]};return this._fCommonParamGetter(q)}});i.parse=new p.Set({DATA:function(q,G,I){try{var F=this;this.$clean();var g=q.metaData;this._oIndList.appendAll(g.inds);this._oDimList.appendAll(g.dims);a.call(this,this._oIndList,"IND");a.call(this,this._oDimList,"DIM");this._oSeriesCfg=q.seriesTypes;for(var C=0,H,E;H=q.index4Selected[C];C++){this._oSelLineWrap.addLast({k:H,l:E=new k(q.selected[H],"uniqName")});a.call(this,E)}d.call(this,q)}catch(D){y(D);this.$goError()}},SELECT:function(C,q,g){try{d.call(this,C);this.$updateSelected(g.args.changeWrap)}catch(D){y(D);this.$goError()}}});function d(C){if(this._oStatusWrap=C.metaStatusData){c.call(this,this._oStatusWrap.indMetas,this._oIndList);c.call(this,this._oStatusWrap.dimMetas,this._oDimList)}var g=this._oIndList;var q=this._oDimList;this._oSelLineWrap.foreach(function(F,D,E){D.foreach(function(H,I,G){var J;if((J=g.get(H))||(J=q.get(H))){x(I,J)}})})}i.error=new p.Set({DATA:function(g,C,q){this._oIndList.clean();this._oDimList.clean();this._oSelLineWrap.clean();this._oStatusWrap={}}});i.$clean=function(){this._oIndList.cleanWithoutDefaultAttr();this._oDimList.cleanWithoutDefaultAttr();this._oSelLineWrap.cleanWithoutDefaultAttr();this._oStatusWrap={};this._oSeriesCfg=null};function a(C,g){var q=this;C.foreach(function(D,E){if(g){E.clazz=g}else{if(q._oIndList.containsKey(E.uniqName)){E.clazz="IND"}else{if(q._oDimList.containsKey(E.uniqName)){E.clazz="DIM"}}}})}function c(C,H){H.foreach(function(I,K,J){K.status=l.META_STATUS.DISABLED});if(!C){return}var g=C.validMetaNames;!g&&(g=C.validMetaNames=[]);var E=C.selectedMetaNames;!E&&(E=C.selectedMetaNames=[]);var q;var G;var D;for(q=0;q<g.length;){if(D=H.get(g[q])){D.status=l.META_STATUS.NORMAL;q++}else{g.splice(q,1)}}for(q=0;q<E.length;){if(D=H.get(E[q])){D.status=l.META_STATUS.SELECTED;q++}else{E.splice(q,1)}}var F=C.disabledMetaNames=[];H.foreach(function(I,K,J){if(K.status==l.META_STATUS.DISABLED){F.push(I)}})}i.getSelLineWrap=function(){return this._oSelLineWrap};i.getIndDim=function(){return{indList:this._oIndList,dimList:this._oDimList}};i.getUpdateData=function(){return this._oStatusWrap};i.getMetaItem=function(g){var q=this._oIndList.get(g);if(!q){q=this._oDimList.get(g)}return q};i.diffSelected=function(C){var D;var F;var E;var g={uniqNameList:[]};for(var q in C){D=this._oSelLineWrap.get(q);b.call(this,q,C[q],D,g)}return g};function b(I,C,H,K){if(C.length==H.size()){var D;var E;var J;var q;var F;H.foreach(function(M,N,L){if(E==null){if(M!=C[L]){D=M;E=L}}else{if(D==C[L]){J=L}if(C[E]==M){q=L;F=M}}});if(E!=null){K.from=I;K.to=I;K.fromLineData=C;K.toLineData=C;if(q>J){K.uniqName=F;K.toPosition=E}else{K.uniqName=D;K.toPosition=J}K.uniqNameList.push(K.uniqName)}}else{if(C.length>H.size()){for(var G=0,g;G<C.length;G++){g=C[G];if(!H.containsKey(g)){K.uniqName=g;K.uniqNameList.splice(0,1,g);K.to=I;K.toLineData=C;if(K.toPosition==null){K.toPosition=G}}}}else{if(C.length<H.size()){H.foreach(function(M,N,L){if(C[L]!=M){K.uniqName=M;K.uniqNameList.push(M);K.from=I;K.fromLineData=C;return false}})}}}K.uniqNameList.splice(1,K.uniqNameList.length-1)}i.$updateSelected=function(g){var G=g.from!=g.to?this._oSelLineWrap.get(g.from):null;var E=this._oSelLineWrap.get(g.to);var q=g.fromLineData;var F=g.toLineData;var C=0;var D;if(G){G.cleanWithoutDefaultAttr();for(C=0;C<q.length;C++){D=q[C];G.addLast(this.getMetaItem(D))}}if(E){E.cleanWithoutDefaultAttr();for(C=0;C<F.length;C++){D=F[C];E.addLast(this.getMetaItem(D))}}}})();$namespace("di.shared.model");(function(){var a=xutil.url.textParam;var d=xutil.object.clone;var c=$namespace().PageInfo=function(e){this.disable;this.totalRecordCount;this.pageSize;this.setData(e)};var b=c.prototype;b.setData=function(e){if(e){if(e.disabled!=null){this.disabled=e.disabled}if(e.totalRecordCount!=null){this.totalRecordCount=e.totalRecordCount}if(e.pageSize!=null){this.pageSize=e.pageSize}if(e.currentPage!=null){this.currentPage=e.currentPage}}};b.setServerData=function(e,g){var f;switch(g){case"TCOM":f={};if(e){f.disabled=false;f.totalRecordCount=parseInt(e.totalRecNum)||0;f.pageSize=parseInt(e.pageSize)||0;f.currentPage=parseInt(e.curPageNum)||0}break;default:f=e}this.setData(f)};b.getServerParam=function(f,e){var g=[];if(f==null){f="page."}switch(e){case"TCOM":g.push(f+"curPageNum="+a(this.currentPage));g.push(f+"pageSize="+a(this.pageSize));break;default:g.push(f+"currentPage"+a(this.currentPage));g.push(f+"pageSize"+a(this.pageSize))}return g.join("&")}})();$namespace("di.shared.model");(function(){var m=ecui.inheritsModel;var b=xui.XDatasource;var h=xutil.fn.bind;var d=xutil.lang.isString;var l=xutil.lang.hasValue;var i=xutil.object.extend;var e=ecui.util.ref;var f=ecui.ui.Control;var g=ecui.ui.TabContainer;var j=ecui.ui.RadioContainer;var a=xutil.LinkedHashMap;var c=$namespace().PanelPageManager=m(b,function(n){this._oPanelPageSet=new a();this._oCurrPageWrap;this._sCurrPageId;i(this,n.adapter)});var k=c.prototype;k.init=function(){this.$bind()};k.add=function(q,p){var r,n;p=p||{};if(!q){return null}!l(n=p.pageId)&&(n=p.pageId=this.$genPageId());if(this._oPanelPageSet.containsKey(n)){throw new Error("Duplicate panel page ID! id="+n)}r=this.$addItem(q,p);this._oPanelPageSet.addFirst({page:r.content,item:r.item},n);return n};k.exists=function(n){return !!this._oPanelPageSet.containsKey(n)};k.select=function(q,n){var p=this._oPanelPageSet.get(q);if(p&&p!=this._oCurrPageWrap){if(this._oCurrPageWrap){this._oCurrPageWrap.page.inactive();this.notify("page.inactive",[this._sCurrPageId])}this._oCurrPageWrap=p;var r=this._sCurrPageId;this._sCurrPageId=q;this.$selectItem(p);this._oPanelPageSet.remove(q);this._oPanelPageSet.addLast(p,q);this.notify("page.change",[q,r]);p.page.active(n);this.notify("page.active",[q])}};k.goTo=function(n,p){this.select(n,p)};k.size=function(){return this._oPanelPageSet.size()};k.getPage=function(n){return this._oPanelPageSet.get(n).page};k.getCurrentPage=function(){return this._oCurrPageWrap?this._oCurrPageWrap.page:null};k.getCurrentPageId=function(){return this._sCurrPageId};k.setTitle=function(n,p){return this.$setTitle(n,p)};k.$pageBeforeChangeHandler=function(){if(this._oCurrPageWrap){this._oCurrPageWrap.page.inactive();this.notify("page.inactive",[this._sCurrPageId])}};k.$pageAfterChangeHandler=function(){var p=this.$retrievalPageId.apply(this,arguments);var q=this._sCurrPageId;var n;if(n=this._oPanelPageSet.get(p)){this._oCurrPageWrap=n;this._sCurrPageId=p;this._oPanelPageSet.remove(p);this._oPanelPageSet.addLast(n,p);this.notify("page.change",[p,q]);n.page.active();this.notify("page.active",[p])}};k.$pageCloseHandler=function(){var p=this.$retrievalPageId.apply(this,arguments);if(this._oPanelPageSet.size()<=1){return false}var n=this._oPanelPageSet.remove(p);this._oPanelPageSet.foreach(function(q,s,r){if(s.page.getFromPageId()==p){s.page.setFromPageId(n.page.getFromPageId())}});n.page.dispose();if(this._oCurrPageWrap&&this._oCurrPageWrap==n){this._oCurrPageWrap=null;this._sCurrPageId=null;this.goTo(this._oPanelPageSet.lastKey())}this.notify("page.close",[p])};k.$genPageId=function(){var n=1;while(this._oPanelPageSet.containsKey(n)){n++}return n}})();$namespace("di.shared.model");(function(){var j=ecui.inheritsModel,g,i,c,d,e,h,b=xui.XDatasource,a;$link(function(){g=ecui.xfn.bind;c=ecui.xlang.isString;i=ecui.xlang.hasValue;d=ecui.ui.Control;e=ecui.ui.TabContainer;h=ecui.ui.RadioContainer;a=ecui.ext.LinkedHashMap});var f=$namespace().PanelPageRadioAdapter={};f.$bind=function(){this._uPanelPageContainer.onbeforechange=g(this.$pageBeforeChangeHandler,this);this._uPanelPageContainer.onafterchange=g(this.$pageAfterChangeHandler,this)};f.$addItem=function(m,l){var k=this._uPanelPageContainer,n=k.add({value:l.id,text:l.title},function(){return m({el:null,parent:k,pageId:l.pageId})});return{content:n,item:l.id}};f.$selectItem=function(k){this._uPanelPageContainer.select(k.item)};f.$retrievalPageId=function(){return arguments[0]};f.$setTitle=function(k,l){}})();$namespace("di.shared.model");(function(){var j=ecui.inheritsModel,g,i,c,d,e,h,b=xui.XDatasource,a;$link(function(){g=ecui.xfn.bind;c=ecui.xlang.isString;i=ecui.xlang.hasValue;d=ecui.ui.Control;e=ecui.ui.TabContainer;h=ecui.ui.RadioContainer;a=ecui.ext.LinkedHashMap});var f=$namespace().PanelPageTabAdapter={};f.$bind=function(){this._uPanelPageContainer.onbeforechange=g(this.$pageBeforeChangeHandler,this);this._uPanelPageContainer.onafterchange=g(this.$pageAfterChangeHandler,this);this._uPanelPageContainer.ontabclose=g(this.$pageCloseHandler,this)};f.$addItem=function(l,k){var m=this._uPanelPageContainer.addTab(function(p,n){return l({el:p,parent:n,pageId:k.pageId})},{title:k.title,index:k.index,canClose:k.canClose,memo:k.pageId});return{content:m.tabContent,item:m.tabItem}};f.$selectItem=function(k){this._uPanelPageContainer.selectTab(k.item)};f.$retrievalPageId=function(){var k=arguments[0];return k.getMemo()};f.$setTitle=function(l,m){var k=this._oPanelPageSet.get(l);k&&k.item.setTitle(m)}})();$namespace("di.shared.model");(function(){var m=xutil.object;var r=xutil.lang;var p=m.extend;var e=m.inheritsObject;var b=xutil.dom.q;var l=xutil.dom.g;var h=xutil.collection.sortList;var s=r.hasValue;var k=r.isArray;var a=xui.XDatasource;var c=di.config.Dict;var n=di.config.URL;var i;$link(function(){i=di.shared.model.PageInfo});var f=$namespace().TableModel=e(a,d);var j=f.prototype;j.DEFAULT_PAGE_SIZE=20;function d(){this._oDatasource=[];this._oWrap={sortInfo:{},pageInfo:new i(),pageData:[]}}j.getData=function(){var g=p({},this._oWrap);g.sortInfo=this.$getMainSortInfo(g.sortInfo);return g};j.$getWrap=function(){return this._oWrap};j.getDatasource=function(){return this._oDatasource||[]};j.prepareArgs=function(q,t){var g=this._oWrap;return this["$"+q](q,t)};j.persistent=function(g,q,t){this._oWrap=p({},q);this._oDatasource=g||this._oDatasource;if(t){this._oWrap.pageData=g}else{this._oWrap.pageInfo.totalRecordCount=this._oDatasource.length;this.$sortTable(g,this._oWrap.sortInfo);this._oWrap.pageData=this.$pagingTable(g,this._oWrap.pageInfo)}};j.$CMD_INIT=function(u,v){var q=this._oWrap;var t={};var g=q.pageInfo.pageSize;t.sortInfo=this.$initSortInfo();t.pageInfo=this.$initPageInfo();g&&(t.pageInfo.pageSize=g);return t};j.$CMD_SORT=function(u,v){var q=this._oWrap;var t={};var g=q.pageInfo.pageSize;if(this.$getMainSortInfo(v.sortInfo).sortby!=this.$getMainSortInfo(q.sortInfo).sortby){t.sortInfo=this.$changeSortby(this.$getMainSortInfo(v.sortInfo).sortby)}else{t.sortInfo=q.sortInfo;this.$getMainSortInfo(t.sortInfo).orderby=this.$changeOrderby(t.sortInfo)}t.pageInfo=q.pageInfo;g&&(t.pageInfo.pageSize=g);return t};j.$CMD_CHANGE_PAGE=function(u,v){var q=this._oWrap;var t={};var g=q.pageInfo.pageSize;t.sortInfo=q.sortInfo;t.pageInfo=q.pageInfo;t.pageInfo.currentPage=Number(v.pageInfo.currentPage);g&&(t.pageInfo.pageSize=g);return t};j.$CMD_CHANGE_PAGE_SIZE=function(u,v){var q=this._oWrap;var t={};var g=q.pageInfo.pageSize;t.sortInfo=this.$initSortInfo();t.pageInfo=this.$initPageInfo();t.pageInfo.pageSize=Number(v.pageInfo.pageSize);return t};j.$initPageInfo=function(){return new i({disabled:false,currentPage:1,pageSize:this.DEFAULT_PAGE_SIZE})};j.$initSortInfo=function(){return{sortby:null,orderby:null,dataField:null}};j.$changeSortby=function(g){return{sortby:g,orderby:null,dataField:g}};j.$changeOrderby=function(q){var g=k(q)?q[0]:q;return g.orderby=="asc"?"desc":"asc"};j.$sortTable=function(q,g){if(!q||!g){return}var w=k(g)?g:[g];for(var t=w.length-1,v,u;v=w[t];t--){if(s(v.dataField)&&v.orderby){u=v.orderby=="asc"?"<":">";h(q,v.dataField,u,false)}}};j.$pagingTable=function(g,u){var x;var v;var q=[];if(u.disabled){x=0;v=g.length}else{x=(u.currentPage-1)*u.pageSize;v=u.pageSize}for(var t=0,w;t<v&&(w=g[x+t]);t++){q.push(w)}return q};j.$getMainSortInfo=function(g){return k(g)?g[0]:g}})();$namespace("di.shared.model");(function(){var a=ecui.inheritsModel,d=xui.XDatasource;$link(function(){});var c=$namespace().UserModel=a(d),b=c.prototype;b.getUserId=function(){}})();$namespace("di.shared.ui");(function(){var e=di.helper.Util;var j=di.config.URL;var c=xutil.object.inheritsObject;var p=xutil.object.assign;var g=xutil.dom.addClass;var n=xutil.lang.isObject;var b=xutil.dom.q;var i=xutil.fn.bind;var l=xutil.object.objKey;var f=xutil.object.getByPath;var m=xui.XObject;var a=di.config.Lang;var h;$link(function(){h=di.helper.Dialog.alert});var d=$namespace().InteractEntity=c(m,function(q){this.$di("start",q);this.$di("registerEventAgent");this.notify=this.attach=this.attachOnce=function(){throw new Error("Forbiden function")};var s=this.$di("getEl");var r=this.DEF.className;s&&r&&g(s,r);this.$createModelByDef(q);this.$createView&&this.$createView(q)});var k=d.prototype;k.DEF={};k.$createModelByDef=function(q){var s=this.DEF.model;if(!s){return}var r=s.clz||(s.clzPath&&f(s.clzPath));if(!r){return}this._mModel=new r(p({commonParamGetter:this.$di("getCommonParamGetter"),diFactory:this.$di("getDIFactory")},this.$createModelInitOpt(q)));this._mModel.ajaxOptions={defaultFailureHandler:i(this.$defaultFailureHandler,this)}};k.$createModelInitOpt=function(q){return{}};k.getModel=function(){return this._mModel};k.$sync=function(r,q,v,t,s){var u={datasourceId:q,args:{param:v,diEvent:t}};p(u.args,s);return r.sync(u)};k.$diEvent=function(q,r){if(arguments.length==1&&n(q)){r=q;q=null}var s=r.args.diEvent;return q?(s?s(q):q):s};k.$syncEnable=function(q){this.$di("syncViewDisable","enable",q);this.$di("enable","DI_SELF_"+q)};k.$syncDisable=function(q){this.$di("syncViewDisable","disable",q);this.$di("disable","DI_SELF_"+q)};k.$defaultFailureHandler=function(q,r){var s=this.$di("getEventChannel");switch(q){case 10001:s.triggerEvent("sessiontimeout");h(a.SAD_FACE+a.RE_LOGIN,null,true);break;case 20001:break;default:h(a.SAD_FACE+a.ERROR)}}})();$namespace("di.shared.ui");(function(){var f=di.config.URL;var D=di.helper.Dialog;var h=di.helper.Util;var l=di.config.Dict;var g=di.config.Lang;var j=ecui.dom.addClass;var n=ecui.dom.removeClass;var m=ecui.dom.create;var d=ecui.dom.getStyle;var b=ecui.triggerEvent;var v=ecui.dispose;var k=h.ecuiCreate;var e=h.disposeInnerControl;var F=xutil.string.template;var i=xutil.string.toShowText;var r=xutil.dom.q;var u=xutil.object.inheritsObject;var G=xutil.lang.hasValueNotBlank;var E=xutil.object.extend;var y=xutil.object.assign;var t=xutil.string.textLength;var a=xutil.string.textSubstr;var s=xutil.date.stringToDate;var z=xutil.string.trim;var H=xutil.fn.bind;var c=xui.XView;var C=ecui.ui.Form;var A=ecui.ui.Button;$link(function(){});var p=$namespace().BaseConfigPanel=u(c,B);var x=p.prototype;var w=['<div class="q-di-form">',"<label>#{0}</label>","#{1}","<div>",'<div class="di-dim-select-btn">','<div class="ui-button-g ui-button q-di-submit">确定</div>','<div class="ui-button q-di-cancel">取消</div>',"</div>","<div>","</div>"].join("");x.$doCreateView=function(q){};x.$doCreateModel=function(q){this._mModel};x.$doGetModel=function(){return this._mModel};x.$doInit=function(){};x.$doGetInnerTPL=function(q){return""};x.$doResetInput=function(){};x.$doRender=function(){};x.$doEnable=function(){};x.$doDisable=function(){};x.$doGetSubmitArgs=function(){};x.$doDispose=function(){};function B(q){this.$doCreateModel(q);var I=this._eMain=m(q.cssName||"di-config-panel");document.body.appendChild(I);I.innerHTML=F(w,i(q.panelTitle||this.PANEL_TITLE,"",true),this.$doGetInnerTPL(q));this._uForm=k(C,r("q-di-form",I)[0],null,{hide:true});this._uSubmitBtn=k(A,r("q-di-submit",I)[0]);this._uCancelBtn=k(A,r("q-di-cancel",I)[0]);this.$doCreateView(q);this.init()}x.init=function(){var q=this;this.$doGetModel().attach(["sync.preprocess.INIT",this.disable,this],["sync.result.INIT",this.$handleInitSuccess,this],["sync.error.INIT",this.$handleInitError,this],["sync.complete.INIT",this.enable,this]);this.$doGetModel().attach(["sync.preprocess.SUBMIT",this.disable,this],["sync.result.SUBMIT",this.$handleSubmitSuccess,this],["sync.error.SUBMIT",this.$handleSubmitError,this],["sync.complete.SUBMIT",this.enable,this]);this._uSubmitBtn.onclick=H(this.$submitHandler,this);this._uCancelBtn.onclick=H(this.$cancelHandler,this);this._uForm.init();this._uSubmitBtn.init();this._uCancelBtn.init();this.$doInit();this.$doResetInput()};x.dispose=function(){this._uForm&&this._uForm.dispose();this._uSubmitBtn&&this._uSubmitBtn.dispose();this._uCancelBtn&&this._uCancelBtn.dispose();this.$doDispose();p.superClass.dispose.call(this)};x.open=function(I,q){this._sMode=I;this._oOpenOptions=q;this.$doResetInput();if(!this.IGNORE_INIT_SYNC){this.$doGetModel().sync({datasourceId:this.DATASOURCEID_INIT||"INIT",args:this._oOpenOptions})}};x.enable=function(){if(this._bDisabled&&this._sMode=="EDIT"){this._uSubmitBtn.enable();this._uCancelBtn.enable();this.$doEnable()}p.superClass.enable.call(this)};x.disable=function(){if(!this._bDisabled){this._uSubmitBtn.disable();this._uCancelBtn.disable();this.$doDisable()}p.superClass.disable.call(this)};x.$submitHandler=function(){this._mDimSelectModel.sync({datasourceId:DATASOURCEID_SUBMIT||"SUBMIT",args:E({},this._oOpenOptions,this.$doGetSubmitArgs())})};x.$cancelHandler=function(){this._uForm.hide()};x.$handleInitSuccess=function(){try{this._uForm.showModal(l.DEFAULT_MASK_OPACITY);this.$doRender();this._uForm.center()}catch(q){this.$handleInitError()}};x.$handleInitError=function(){var q=this;D.alert(g.GET_DIM_TREE_ERROR,function(){q._uForm.hide()})};x.$handleSubmitSuccess=function(){this._uForm.hide();this.notify("submit.close")};x.$handleSubmitError=function(q){D.alert(g.SAVE_FAILURE)}})();$namespace("di.shared.ui");(function(){var h=di.helper.Util;var n=di.config.URL;var d=xutil.object.inheritsObject;var j=ecui.dom.addClass;var g=ecui.dispose;var c=xutil.dom.q;var m=xutil.fn.bind;var a=h.download;var r=h.foreachDo;var f=di.helper.Dialog;var b=di.config.Lang;var e=di.shared.ui.InteractEntity;var l;$link(function(){l=xutil.object.getByPath("xui.ui.HChart")});var p=$namespace().DIChart=d(e);var i=p.prototype;var k=['<div class="q-di-chart"></div>',].join("");i.EXPORT_HANDLER={sync:{datasourceId:"DATA"},syncX:{datasourceId:"X_DATA"},syncS:{datasourceId:"S_DATA"},syncSAdd:{datasourceId:"S_ADD_DATA"},syncSRemove:{datasourceId:"S_REMOVE_DATA"},clear:{}};i.DEF={exportHandler:{sync:{datasourceId:"DATA"},syncX:{datasourceId:"X_DATA"},syncS:{datasourceId:"S_DATA"},syncSAdd:{datasourceId:"S_ADD_DATA"},syncSRemove:{datasourceId:"S_REMOVE_DATA"},clear:{}},className:"di-chart",model:{clzPath:"di.shared.model.DIChartModel"}};i.$createView=function(s){var t=this.$di("getEl");var q=this.$di("getTplMode");if(q!="FROM_SNIPPET"){t.innerHTML=k}this._uChart=q=="FROM_SNIPPET"?this.$di("vuiCreate","mainChart"):new l({el:c("q-di-chart",t)[0]});this._uDownloadBtn=this.$di("vuiCreate","download");this._uOfflineDownloadBtn=this.$di("vuiCreate","offlineDownload")};i.init=function(){var q;var t=this.DEF.exportHandler;for(q in t){var s=t[q].datasourceId;this.getModel().attach(["sync.preprocess."+s,this.$syncDisable,this,s],["sync.result."+s,this.$renderMain,this],["sync.result."+s,this.$handleDataLoaded,this],["sync.error."+s,this.$handleDataError,this],["sync.complete."+s,this.$syncEnable,this,s])}q="OFFLINE_DOWNLOAD";this.getModel().attach(["sync.preprocess."+q,this.$syncDisable,this,q],["sync.error."+q,this.$handleOfflineDownloadError,this],["sync.complete."+q,this.$syncEnable,this,q]);this._uDownloadBtn&&(this._uDownloadBtn.onclick=m(this.$handleDownload,this));this._uOfflineDownloadBtn&&(this._uOfflineDownloadBtn.attach("confirm",this.$handleOfflineDownload,this));r([this.getModel(),this._uChart,this._uDownloadBtn,this._uOfflineDownloadBtn],"init")};i.dispose=function(){this._uChart&&this._uChart.$di("dispose");p.superClass.dispose.call(this)};(function(){var t=i.DEF.exportHandler;for(var q in t){i[q]=s(t[q].datasourceId)}function s(u){return function(v){this.$sync(this.getModel(),u,(v||{}),this.$di("getEvent"))}}})();i.clear=function(){this._uChart&&this._uChart.$di("setData")};i.$renderMain=function(t,s,q){this._uChart.$di("setData",this.getModel().getChartData(),{diEvent:this.$diEvent(q)});this.$di("dispatchEvent",this.$diEvent("rendered",q))};i.resize=function(){};i.enable=function(){r([this._uChart,this._uDownloadBtn,this._uOfflineDownloadBtn],"enable");p.superClass.enable.call(this)};i.disable=function(){r([this._uChart,this._uDownloadBtn,this._uOfflineDownloadBtn],"disable");p.superClass.disable.call(this)};i.$handleDownload=function(t){var q=this.$di("getCommonParamGetter");var s=n("OLAP_CHART_DOWNLOAD")+"?"+q();a(s,null,true);q.update()};i.$handleOfflineDownload=function(){var q=this._uOfflineDownloadBtn.getValue()||{};this.$sync(this.getModel(),"OFFLINE_DOWNLOAD",{email:q.email})};i.$handleDataLoaded=function(t,s,q){this.$di("dispatchEvent",this.$diEvent("dataloaded."+q.datasourceId,q));this.$di("dispatchEvent",this.$diEvent("dataloaded",q))};i.$handleDataError=function(q,t,s){this.clear();this.$di("dispatchEvent",this.$diEvent("rendered",s));this.$di("dispatchEvent",this.$diEvent("dataerror",s))};i.$handleOfflineDownloadError=function(q,t,s){f.alert(b.SAD_FACE+b.OFFLINE_DOWNLOAD_FAIL)}})();$namespace("di.shared.ui");(function(){var g=di.helper.Util;var c=xutil.object.inheritsObject;var h=ecui.dom.addClass;var e=ecui.dispose;var a=xutil.dom.q;var j=xutil.fn.bind;var l=xutil.object.objKey;var n=xutil.lang.isObject;var d=di.shared.ui.InteractEntity;var i=xutil.object.extend;var k=ecui.ui.OlapTable;var m=ecui.ui.Breadcrumb;var f=ecui.ui.Button;var b=$namespace().DIForm=c(d);var p=b.prototype;p.DEF={exportHandler:{sync:{datasourceId:"DATA"},clear:{}},className:"di-form",model:{clzPath:"di.shared.model.DIFormModel"}};p.$createView=function(q){this._oOptions=i({},q);q.submitMode=q.submitMode||"IMMEDIATE";this._aInput=[];for(var r=0,s;s=this.$di("vuiCreate","input."+r);r++){this._aInput.push(s);s.$di("setOpt","cfgOpt","paramMode","JSON")}this._uConfirmBtn=this.$di("vuiCreate","confirm")};p.init=function(){var s=this;var r;var q;var t;var u;this.getModel().attach(["sync.preprocess.DATA",this.$syncDisable,this,"DATA"],["sync.result.DATA",this.$renderMain,this],["sync.result.DATA",this.$handleDataLoaded,this],["sync.error.DATA",this.$handleDataError,this],["sync.complete.DATA",this.$syncEnable,this,"DATA"],["sync.result.ASYNC_DATA",this.$renderAsync,this],["sync.error.ASYNC_DATA",this.$handleAsyncError,this]);for(r=0;q=this._aInput[r];r++){t=q.$di("getDef");u=q.$di("getOpt","cfgOpt");if(!u.changeSilent){q.$di("addEventListener","change",this.$handleChange,this)}if(u.async){q.$di("addEventListener","async",this.$handleAsync,this,{bindArgs:[q]})}}if(this._uConfirmBtn){this._uConfirmBtn.onclick=function(){s.$submit()}}for(r=0;q=this._aInput[r];r++){q.$di("init")}};p.dispose=function(){for(var r=0,q;q=this._aInput[r];r++){q.$di("dispose")}b.superClass.dispose.call(this)};p.sync=function(s){var q=[];for(var t=0,r;r=this._aInput[t];t++){q.push(r.$di("getDef").name)}this.$sync(this.getModel(),"DATA",{paramList:q},this.$di("getEvent"))};p.clear=function(q){};p.$submit=function(){this.$di("dispatchEvent","submit",[this.$di("getValue")])};p.$renderMain=function(w,v,t){var r={diEvent:this.$diEvent(t)};var q=this.getModel().getInitData();for(var u=0,s;s=this._aInput[u];u++){s.$di("setData",q[s.$di("getDef").name],r)}this.$di("dispatchEvent",this.$diEvent("rendered",t))};p.$renderAsync=function(t,s,r){var q=r.args;q.callback(t[q.input.$di("getDef").name]||{})};p.resize=function(){};p.enable=function(){for(var r=0,q;q=this._aInput[r];r++){q.$di("enable")}this._uConfirmBtn&&this._uConfirmBtn.$di("enable");b.superClass.enable.call(this)};p.disable=function(){for(var r=0,q;q=this._aInput[r];r++){q.$di("disable")}this._uConfirmBtn&&this._uConfirmBtn.$di("disable");b.superClass.disable.call(this)};p.$handleDataLoaded=function(s,r,q){this.$di("dispatchEvent",this.$diEvent("dataloaded",q),[this.$di("getValue")])};p.$handleChange=function(){if(this._oOptions.submitMode=="IMMEDIATE"){this.$submit()}};p.$handleAsync=function(r,t,u){var s=r.$di("getDef").name;var q={};this.$sync(this.getModel(),"ASYNC_DATA",{paramName:s,arg:t},null,{value:t,callback:u,input:r})};p.$handleDataError=function(q,s,r){this.clear();this.$di("dispatchEvent",this.$diEvent("rendered",r))};p.$handleAsyncError=function(){this.$di("dispatchEvent","rendered")}})();$namespace("di.shared.ui");(function(){var g=di.helper.Util;var c=xutil.object.inheritsObject;var i=ecui.dom.addClass;var f=ecui.dispose;var a=xutil.dom.q;var n=xutil.object.assign;var j=xutil.fn.bind;var k=xutil.object.objKey;var l=g.ecuiCreate;var e=di.shared.ui.InteractEntity;var m=ecui.ui.TabContainer;var d=$namespace().DITab=c(e,b);var h=d.prototype;h.DEF={className:"di-tab",};function b(s){var v=this.$di("getEl");var w=document.createElement("div");v.appendChild(w);this._bAutoDeaf=s.autoDeaf==null?true:s.autoDeaf;this._bAutoComponentValueDisabled=s.autoComponentValueDisabled==null?false:s.autoComponentValueDisabled;this._bAutoVUIValueDisabled=s.autoVUIValueDisabled==null?true:s.autoVUIValueDisabled;this._aTab=[];this._uTab=l(m,w);this._aBodyPart=[];var u=this.$di("getRef","vpartRef","tab");var r=this.$di("getRef","vpartRef","body");for(var t=0,p,q;p=u[t];t++){q=r[t];this._aTab.push(this._uTab.addTab(null,n({tabEl:p.el,contentEl:q.el},p.$di("getOpt","dataOpt"),["title","canClose"])));this._aBodyPart.push(this.$di("vpartCreate","body."+t))}}h.init=function(){var r=this;this._uTab.onafterchange=function(v,x){r.$resetDisabled();for(var u=0,w,t;t=r._aBodyPart[u],w=r._aTab[u];u++){if(w.tabItem==v){t.$di("dispatchEvent","active")}if(w.tabItem==x){t.$di("dispatchEvent","inactive")}}r.$di("dispatchEvent","rendered");r.$di("dispatchEvent","change")};var q=this.$di("getOpt","dataOpt");var p=q.selected-1;var s;if(s=this._aTab[p]){this._uTab.selectTab(s.tabItem);r.$di("dispatchEvent","rendered")}this.$resetDisabled();s&&this._aBodyPart[p].$di("dispatchEvent","active")};h.$resetDisabled=function(){var u=this.$di("getId");var s=this.$di("getRef","vpartRef","body","DEF");for(var t=0,v,q,p;v=this._aTab[t];t++){p=this._uTab.getSelected()!=v.tabItem;q=s[t].$di("getRef","componentRef","inner","INS")||[];for(var r=0;r<q.length;r++){if(q[r]){this._bAutoDeaf&&q[r].$di("setDeaf",p,u);this._bAutoComponentValueDisabled&&q[r].$di("setValueDisabled",p,u)}}if(this._bAutoVUIValueDisabled){q=s[t].$di("getRef","vuiRef","inner","INS")||[];for(var r=0;r<q.length;r++){q[r]&&q[r].$di("setValueDisabled",p,u)}}}};h.dispose=function(){this._uTab&&f(this._uTab);this._aTab=[];d.superClass.dispose.call(this)};h.resize=function(){this._uTab&&this._uTab.resize()};h.enable=function(p){this._uTab&&this._uTab.enable();d.superClass.enable.call(this)};h.disable=function(p){this._uTab&&this._uTab.disable();d.superClass.disable.call(this)}})();$namespace("di.shared.ui");(function(){var g=di.helper.Util;var e=di.config.URL;var m=xutil.object.inheritsObject;var j=xutil.dom.addClass;var c=g.ecuiDispose;var r=xutil.object.assign;var l=xutil.dom.q;var v=xutil.fn.bind;var a=xutil.object.objKey;var h=xutil.object.getByPath;var k=g.ecuiCreate;var b=g.download;var i=g.foreachDo;var u=di.helper.Dialog;var f=di.config.Lang;var w=di.shared.ui.InteractEntity;var p;var d;$link(function(){p=h("ecui.ui.OlapTable");d=h("ecui.ui.Breadcrumb")});var s=$namespace().DITable=m(w);var t=s.prototype;var n=['<div class="q-di-table-area di-table-area">','<div class="q-di-breadcrumb"></div>','<div class="q-di-table"></div>',"</div>"].join("");t.DEF={exportHandler:{sync:{datasourceId:"DATA"},clear:{}},className:"di-table",model:{clzPath:"di.shared.model.DITableModel"}};t.$createView=function(x){var y=this.$di("getEl");var q=this.$di("getTplMode");if(q!="FROM_SNIPPET"){y.innerHTML=n}this._uTable=q=="FROM_SNIPPET"?this.$di("vuiCreate","mainTable"):k(p,l("q-di-table",y)[0]);this._eArea=y;this._uBreadcrumb=q=="FROM_SNIPPET"?this.$di("vuiCreate","breadcrumb",{maxShow:5}):k(d,l("q-di-breadcrumb",y)[0],null,{maxShow:5});this._uDownloadBtn=this.$di("vuiCreate","download");this._uOfflineDownloadBtn=this.$di("vuiCreate","offlineDownload");this._uCountInfo=this.$di("vuiCreate","countInfo")};t.init=function(){var x=this;var q;for(q in {DATA:1,DRILL:1,LINK_DRILL:1,SORT:1}){this.getModel().attach(["sync.preprocess."+q,this.$syncDisable,this,q],["sync.result."+q,this.$renderMain,this],["sync.result."+q,this.$handleDataLoaded,this],["sync.error."+q,this.$handleDataError,this],["sync.complete."+q,this.$syncEnable,this,q])}q="OFFLINE_DOWNLOAD";this.getModel().attach(["sync.preprocess."+q,this.$syncDisable,this,q],["sync.error."+q,this.$handleOfflineDownloadError,this],["sync.complete."+q,this.$syncEnable,this,q]);this.getModel().attach(["sync.preprocess.CHECK",this.$syncDisable,this,"CHECK"],["sync.result.CHECK",this.$handleRowAsync,this,false],["sync.error.CHECK",this.$handleRowAsync,this,true],["sync.complete.CHECK",this.$syncEnable,this,"CHECK"]);this.getModel().attach(["sync.preprocess.SELECT",this.$syncDisable,this,"SELECT"],["sync.result.SELECT",this.$handleRowAsync,this,false],["sync.error.SELECT",this.$handleRowAsync,this,true],["sync.complete.SELECT",this.$syncEnable,this,"SELECT"]);this.getModel().init();this._uTable.onexpand=v(this.$handleExpand,this);this._uTable.oncollapse=v(this.$handleCollapse,this);this._uTable.onsort=v(this.$handleSort,this);this._uTable.onrowclick=v(this.$handleRowClick,this);this._uTable.onrowselect=v(this.$handleRowCheck,this,"rowselect","SELECT");this._uTable.onrowcheck=v(this.$handleRowCheck,this,"rowcheck","CHECK");this._uTable.onrowuncheck=v(this.$handleRowCheck,this,"rowuncheck","CHECK");this._uTable.oncelllinkdrill=v(this.$handleLinkDrill,this);this._uTable.oncelllinkbridge=v(this.$handleLinkBridge,this);this._uBreadcrumb&&(this._uBreadcrumb.onchange=v(this.$handleBreadcrumbChange,this));this._uDownloadBtn&&(this._uDownloadBtn.onclick=v(this.$handleDownload,this));this._uOfflineDownloadBtn&&(this._uOfflineDownloadBtn.attach("confirm",this.$handleOfflineDownload,this));i([this._uTable,this._uBreadcrumb,this._uCountInfo,this._uDownloadBtn,this._uOfflineDownloadBtn],"init");this._uBreadcrumb&&this._uBreadcrumb.hide();this._eArea.style.display="none"};t.dispose=function(){this._uTable&&c(this._uTable);this._eArea=null;s.superClass.dispose.call(this)};t.sync=function(q){this.$sync(this.getModel(),"DATA",q||{},this.$di("getEvent"))};t.clear=function(){i([this._uTable,this._uBreadcrumb,this._uCountInfo],"setData")};t.$renderMain=function(z,y,x){this._eArea.style.display="";i([this._uTable,this._uBreadcrumb,this._uCountInfo,this._uDownloadBtn,this._uOfflineDownloadBtn],"diShow");var q={diEvent:this.$diEvent(x)};this._uTable.$di("setData",z.tableData,q);if(this._uBreadcrumb){if(z.breadcrumbData.datasource&&z.breadcrumbData.datasource.length>0){this._uBreadcrumb.show();this._uBreadcrumb.$di("setData",z.breadcrumbData,q)}else{this._uBreadcrumb.hide()}}this._uCountInfo&&this._uCountInfo.$di("setData",{args:{totalRecordCount:z.pageInfo.totalRecordCount,currRecordCount:z.pageInfo.currRecordCount}},q);this.$di("dispatchEvent",this.$diEvent("rendered",x))};t.resize=function(){this._uTable&&this._uTable.resize()};t.enable=function(){i([this._uTable,this._uBreadcrumb,this._uCountInfo,this._uDownloadBtn,this._uOfflineDownloadBtn],"enable");s.superClass.enable.call(this)};t.disable=function(){i([this._uTable,this._uBreadcrumb,this._uCountInfo,this._uDownloadBtn,this._uOfflineDownloadBtn],"disable");s.superClass.disable.call(this)};t.$handleDownload=function(y){var q=this.$di("getCommonParamGetter");var x=e("OLAP_TABLE_DOWNLOAD")+"?"+q();b(x,null,true);q.update()};t.$handleOfflineDownload=function(){var q=this._uOfflineDownloadBtn.getValue()||{};this.$sync(this.getModel(),"OFFLINE_DOWNLOAD",{email:q.email})};t.$handleBreadcrumbChange=function(q){this.$sync(this.getModel(),"LINK_DRILL",{action:"EXPAND",uniqueName:q.uniqName})};t.$handleLinkDrill=function(q,x){this.$sync(this.getModel(),"LINK_DRILL",{action:"EXPAND",uniqueName:q.uniqueName,lineUniqueName:(x||{})["uniqueName"]})};t.$handleLinkBridge=function(q,x){this.$di("linkBridge",q.linkBridge,e("OLAP_TABLE_LINK_BRIDGE"),this.$di("getCommonParamGetter")({colUniqName:q.uniqueName,rowUniqName:x.uniqueName,colDefineId:q.colDefineId}))};t.$handleExpand=function(q,x){this.$sync(this.getModel(),"DRILL",{action:"EXPAND",uniqueName:q.uniqueName,lineUniqueName:(x||{})["uniqueName"]})};t.$handleCollapse=function(q,x){this.$sync(this.getModel(),"DRILL",{action:"COLLAPSE",uniqueName:q.uniqueName,lineUniqueName:(x||{})["uniqueName"]})};t.$handleRowClick=function(q){this.$di("dispatchEvent","rowclick",[{uniqueName:q.uniqueName}])};t.$handleRowCheck=function(x,q,z,y){this.$sync(this.getModel(),q,{uniqueName:z.uniqueName},null,{eventName:x,callback:y})};t.$handleSort=function(q){this.$sync(this.getModel(),"SORT",q)};t.$handleRowAsync=function(z,y,x,q){q.args.callback(y.selected);this.$di("dispatchEvent",q.args.eventName,[{uniqueName:q.args.param.uniqueName}])};t.$handleDataLoaded=function(B,z,y){var q=y.datasourceId;var A=this.$di("getValue");var x;var C=y.args.param;if(q=="DATA"){x=[A]}else{if(q=="LINK_DRILL"){x=[r({},C,["uniqueName"])]}else{if(q=="DRILL"){x=[r({},C,["uniqueName","lineUniqueName"])]}else{if(q=="SORT"){x=[r({},C,["uniqueName","currentSort"])]}}}}this.$di("dispatchEvent",this.$diEvent("dataloaded."+q,y),x);if(q in {DATA:1,LINK_DRILL:1,SORT:1}){this.$di("dispatchEvent",this.$diEvent("datachange",y),[A])}this.$di("dispatchEvent",this.$diEvent("dataloaded",y),[A])};t.$handleDataError=function(q,y,x){this._eArea.style.display="";i([this._uTable,this._uBreadcrumb,this._uCountInfo,this._uDownloadBtn,this._uOfflineDownloadBtn],"diShow");this.clear();this.$di("dispatchEvent",this.$diEvent("rendered",x));this.$di("dispatchEvent",this.$diEvent("dataerror",x))};t.$handleOfflineDownloadError=function(q,y,x){u.alert(f.SAD_FACE+f.OFFLINE_DOWNLOAD_FAIL)}})();$namespace("di.shared.ui");(function(){var A=di.config.URL;var r=di.helper.Dialog;var y=di.helper.Util;var E=di.config.Dict;var u=di.config.Lang;var v=ecui.dom.addClass;var j=ecui.dom.removeClass;var L=ecui.dom.create;var G=ecui.dom.getStyle;var K=ecui.triggerEvent;var H=ecui.dispose;var h=y.ecuiCreate;var d=y.disposeInnerControl;var f=xutil.string.template;var I=xutil.dom.q;var w=xutil.object.createSingleton;var s=xutil.lang.hasValueNotBlank;var i=xutil.object.extend;var J=xutil.object.assign;var C=xutil.string.textLength;var t=xutil.string.textSubstr;var B=xutil.date.stringToDate;var a=xutil.string.trim;var e=xutil.fn.bind;var k=xui.XView;var N=ecui.ui.Textarea;var b=ecui.ui.Input;var M=ecui.ui.Form;var c=ecui.ui.Button;var x=ecui.ui.IndTree;var z=ecui.ui.IstCalendar;var m;$link(function(){m=di.shared.model.DimSelectModel});var D=$namespace().DimSelectPanel=w(k,g);var l=D.prototype;function g(q){F.call(this,q);n.call(this,q);this.init()}var p=['<div class="q-di-form">',"<label>维度选择</label>",'<div class="di-dim-select-tree">','<div class="q-di-tree"></div>',"</div>",'<div class="di-dim-select-cal">','<div class="q-calendar"></div>',"</div>","<div>",'<div class="di-dim-select-btn">','<div class="ui-button-g ui-button q-di-submit">确定</div>','<div class="ui-button q-di-cancel">取消</div>',"</div>","<div>","</div>"].join("");function F(){this._mDimSelectModel=new m()}function n(){var q=this._eMain=L("di-dim-select-panel");document.body.appendChild(q);q.innerHTML=p;this._uForm=h(M,I("q-di-form",q)[0],null,{hide:true});this._uDimTree=h(x,I("q-di-tree",q)[0]);this._uCalendar=h(z,I("q-calendar",q)[0],null,{mode:"RANGE",viewMode:"FIX",shiftBtnDisabled:true});this._uSubmitBtn=h(c,I("q-di-submit",q)[0]);this._uCancelBtn=h(c,I("q-di-cancel",q)[0])}l.init=function(){var q=this;this._mDimSelectModel.attach(["sync.preprocess.TREE",this.disable,this],["sync.result.TREE",this.$handleTreeSuccess,this],["sync.error.TREE",this.$handleTreeError,this],["sync.complete.TREE",this.enable,this]);this._mDimSelectModel.attach(["sync.preprocess.SAVE",this.disable,this],["sync.result.SAVE",this.$handleSubmitSuccess,this],["sync.error.SAVE",this.$handleSubmitError,this],["sync.complete.SAVE",this.enable,this]);this._uSubmitBtn.onclick=e(this.$submitHandler,this);this._uCancelBtn.onclick=e(this.$cancelHandler,this);this._uForm.init();this._uDimTree.init();this._uSubmitBtn.init();this._uCancelBtn.init();this._uCalendar.init();this._uCalendar.hide();this.$resetInput()};l.dispose=function(){D.superClass.dispose.call(this)};l.open=function(O,q){this._sMode=O;this._oOptions=q;this.$resetInput();this._mDimSelectModel.sync({datasourceId:"TREE",args:this._oOptions})};l.$resetInput=function(){this.$clearPrompt()};l.$clearPrompt=function(){};l.enable=function(q){if(this._bDisabled&&this._sMode=="EDIT"){this._uSubmitBtn.enable();this._uCancelBtn.enable();this._uDimTree.enable()}D.superClass.enable.call(this)};l.disable=function(q){if(!this._bDisabled){this._uSubmitBtn.disable();this._uCancelBtn.disable();this._uDimTree.disable()}D.superClass.disable.call(this)};l.$submitHandler=function(){this._mDimSelectModel.sync({datasourceId:"SAVE",args:i({treeSelected:this._uDimTree.getSelected(),levelSelected:this._uDimTree.getLevelSelected(),timeSelect:{start:this._uCalendar.getDate(),end:this._uCalendar.getDateEnd()}},this._oOptions)})};l.$cancelHandler=function(){this._uForm.hide()};l.$handleTreeSuccess=function(){try{var O=this._mDimSelectModel;this._uForm.showModal(E.DEFAULT_MASK_OPACITY);this._uDimTree.render({tree:O.getCurrDimTree(),level:O.getCurrLevelList()});if(this._oOptions.dimMode=="TIME"){this._uCalendar.show();var q=O.getTimeSelect();this._uCalendar.setDate(B(q.start),B(q.end))}else{this._uCalendar.hide()}this._uForm.center()}catch(P){this.$handleTreeError()}};l.$handleTreeError=function(){var q=this;r.alert(u.GET_DIM_TREE_ERROR,function(){q._uForm.hide()})};l.$handleSubmitSuccess=function(){this._uForm.hide();this.notify("submit.close")};l.$handleSubmitError=function(q){r.alert(u.SAVE_FAILURE)}})();$namespace("di.shared.ui");(function(){var g=di.helper.Util;var d=xutil.object.inheritsObject;var i=ecui.dom.addClass;var f=ecui.dispose;var a=xutil.dom.q;var m=xutil.object.assign;var j=xutil.fn.bind;var k=xutil.object.objKey;var e=di.shared.ui.InteractEntity;var l=ecui.ui.TabContainer;var b=$namespace().FoldPanel=d(e,c);var h=b.prototype;h.DEF={className:"di-fold-panel",};function c(n){var p=this.$di("getEl");var q=document.createElement("div");p.appendChild(q);this._bFolded=true;this._bAutoDeaf=n.autoDeaf==null?true:n.autoDeaf;this._bAutoComponentValueDisabled=n.autoComponentValueDisabled==null?false:n.autoComponentValueDisabled;this._bAutoVUIValueDisabled=n.autoVUIValueDisabled==null?true:n.autoVUIValueDisabled;this._oBodyDef=this.$di("getRef","vpartRef","body","DEF");this._oCtrlBtnDef=this.$di("getRef","vpartRef","ctrlBtn","DEF");this.$createCtrlBtn();this.$resetCtrlBtnText();this.$ctrlBtnChange(true)}h.init=function(){this.$resetDisabled()};h.$createCtrlBtn=function(){this._oCtrlBtnDef.el.innerHTML=['<a href="#" class="di-fold-panel-ctrl-btn">','<span class="di-fold-panel-ctrl-btn-text">&nbsp;</span>',"</a>",'<span class="di-fold-panel-ctrl-down"></span>'].join("");var n=this._oCtrlBtnDef.el.firstChild;var p=this;n.onclick=function(){if(!p._bDisabled){p.$ctrlBtnChange();p.$resetDisabled()}return false}};h.dispose=function(){this._oCtrlBtnDef=null;this._oBodyDef=null;b.superClass.dispose.call(this)};h.$resetDisabled=function(){var n;var q=this.$di("getId");n=this._oBodyDef.$di("getRef","componentRef","inner","INS")||[];for(var p=0;p<n.length;p++){if(n[p]){this._bAutoDeaf&&n[p].$di("setDeaf",this._bFolded,q);this._bAutoComponentValueDisabled&&n[p].$di("setValueDisabled",this._bFolded,q)}}if(this._bAutoVUIValueDisabled){n=this._oBodyDef.$di("getRef","vuiRef","inner","INS")||[];for(var p=0;p<n.length;p++){n[p]&&n[p].$di("setValueDisabled",this._bFolded,q)}}};h.resize=function(){};h.$resetCtrlBtnText=function(){var p=this._oCtrlBtnDef;var n=p.$di("getOpt","dataOpt");p.el.firstChild.firstChild.innerHTML=this._bFolded?n.expandText:n.collapseText;p.el.lastChild.className=this._bFolded?"di-fold-panel-ctrl-down":"di-fold-panel-ctrl-up"};h.$ctrlBtnChange=function(n){var p=this._oBodyDef.el.style;this._bFolded=n==null?!this._bFolded:n;this.$resetCtrlBtnText();p.display=this._bFolded?"none":"";this.$di("dispatchEvent","rendered")}})();$namespace("di.shared.ui");(function(){var f=di.helper.Util;var c=xutil.object.inheritsObject;var i=ecui.dom.addClass;var e=ecui.dispose;var a=xutil.dom.q;var j=xutil.fn.bind;var k=xutil.object.objKey;var d=di.shared.ui.InteractEntity;var h=$namespace().GeneralSnippet=c(d,b);var g=h.prototype;function b(l){}g.dispose=function(){}})();$namespace("di.shared.ui");(function(){var f=di.helper.Util;var c=xutil.object.inheritsObject;var g=ecui.dom.addClass;var d=ecui.dispose;var a=xutil.dom.q;var l=xutil.object.assign;var i=xutil.fn.bind;var j=xutil.object.objKey;var k=xui.XView;var h=$namespace().GeneralVContainer=c(k,b);var e=h.prototype;function b(m){this._oOptions=l({},m)}e.dispose=function(){this.$di("disposeMainEl")}})();$namespace("di.shared.ui");(function(){var g=di.helper.Util;var d=xutil.object.inheritsObject;var h=ecui.dom.addClass;var f=ecui.dispose;var a=xutil.dom.q;var l=xutil.object.assign;var i=xutil.fn.bind;var j=xutil.object.objKey;var k=xui.XView;var c=$namespace().GeneralVPart=d(k,b);var e=c.prototype;function b(m){this._oOptions=l({},m)}e.dispose=function(){this.$di("disposeMainEl")}})();$namespace("di.shared.ui");(function(){var p=di.config.Dict;var h=di.helper.Util;var u=xutil.object.inheritsObject;var l=xutil.dom.addClass;var f=h.ecuiDispose;var y=xutil.object.extend;var s=xutil.dom.q;var A=xutil.fn.bind;var e=xutil.object.objKey;var z=xutil.string.template;var n=h.ecuiCreate;var m=xutil.LinkedHashMap;var b;var a;var i=xutil.object.getByPath;var t=xutil.uid.getIncreasedUID;var d=xui.XView;var c;var x;$link(function(){b=i("ecui.ui.DroppableList");a=i("ecui.ui.DraggableList");c=di.shared.model.MetaConditionModel;x=di.shared.ui.DimSelectPanel});var j=$namespace().MetaCondition=u(d,function(q){r.call(this,q);w.call(this,q)});var g=j.prototype;var v=['<div class="meta-condition-src">','<div class="meta-condition-ind">','<div class="meta-condition-head-text">选择指标：</div>','<div class="meta-condition-ind-line q-di-meta-ind"></div>',"</div>",'<div class="meta-condition-dim">','<div class="meta-condition-head-text">选择维度：</div>','<div class="meta-condition-dim-line q-di-meta-dim"></div>',"</div>","</div>",'<div class="meta-condition-tar q-di-meta-tar">',"</div>"].join("");var k=['<div class="meta-condition-sel">','<div class="meta-condition-head-text">#{0}</div>','<div class="meta-condition-sel-line q-di-meta-sel-line"></div>',"</div>"].join("");function r(q){this._sReportType=q.reportType||"TABLE";this._fCommonParamGetter=q.commonParamGetter;this._mMetaConditionModel=new c({reportType:this._sReportType,commonParamGetter:this._fCommonParamGetter})}function w(q){var B=this._eMain=q.el;l(B,"meta-condition");B.innerHTML=v;this._eSelLineArea=s("q-di-meta-tar",B)[0];this._oSelLineWrap=new m();this._oSelLineIdWrap={}}g.init=function(){this._mMetaConditionModel.attach(["sync.preprocess.META_DATA",this.disable,this,"META_COND"],["sync.result.META_DATA",this.$renderMain,this],["sync.error.META_DATA",this.$handleMetaError,this],["sync.complete.META_DATA",this.enable,this,"META_COND"]);this._mMetaConditionModel.attach(["sync.preprocess.SELECT",this.disable,this,"META_COND"],["sync.result.SELECT",this.$refreshStatus,this],["sync.error.SELECT",this.$handleSelectError,this],["sync.complete.SELECT",this.enable,this,"META_COND"]);this._mMetaConditionModel.init()};g.dispose=function(){this._uIndSrc&&f(this._uIndSrc);this._uDimSrc&&f(this._uDimSrc);this._oSelLineWrap.foreach(function(B,C,q){f(C)});this._eSelLineArea=null;j.superClass.dispose.call(this)};g.sync=function(){this._mMetaConditionModel.sync({datasourceId:"META_DATA"})};g.getModel=function(){return this._mMetaConditionModel};g.$renderMain=function(){var F=this;var D=this._eMain;var G=["\x06_DI_META_COND_IND"+t("DI_META_COND"),"\x06_DI_META_COND_DIM"+t("DI_META_COND")];var B=this._mMetaConditionModel.getIndDim();var C=this._sReportType=="TABLE";var H=this._uIndSrc=n(a,s("q-di-meta-ind",D)[0],null,{id:G[0],disableSelected:C,clazz:"IND"});B.indList.foreach(function(I,J){H.addItem({value:J.uniqName,text:J.caption,clazz:J.clazz,fixed:J.fixed,align:J.align})});var q=this._uDimSrc=n(a,s("q-di-meta-dim",D)[0],null,{id:G[1],disableSelected:C,clazz:"DIM"});B.dimList.foreach(function(I,J){q.addItem({value:J.uniqName,text:J.caption,clazz:J.clazz,fixed:J.fixed,align:J.align})});var E=this._mMetaConditionModel.getSelLineWrap();E.foreach(function(J,K,I){F.$addSelLine(J,F.$getSelLineTitle(J),G.join(","),K)});this._uIndSrc.onchange=A(this.$handleSelLineChange,this,this._uIndSrc);this._uDimSrc.onchange=A(this.$handleSelLineChange,this,this._uDimSrc);this._oSelLineWrap.foreach(function(I,J){J.onitemclick=A(F.$handleItemClick,F,I)})};g.$getSelLineTitle=function(q){var B="";if(this._sReportType=="TABLE"){if(q=="ROW"){B="行："}else{if(q=="FILTER"){B="过滤："}else{B="列："}}}else{if(q=="ROW"){B="轴："}else{if(q=="FILTER"){B="过滤："}else{B="系列组："}}}return B};g.$addSelLine=function(C,H,F,E){if(C==null){return}var D=this._oSelLineWrap;var B=this._oSelLineIdWrap;var G=document.createElement("div");G.innerHTML=z(k,H);this._eSelLineArea.appendChild(G=G.firstChild);D.addLast(n(b,s("q-di-meta-sel-line",G)[0],null,{id:B[C]="\x06_DI_META_COND_SEL"+t("DI_META_COND"),source:F,configBtn:true}),C);for(var q in B){if(q!=C){D.get(q).addTarget(B[C])}D.get(C).addTarget(B[q])}this._uIndSrc.addTarget(B[C]);this._uDimSrc.addTarget(B[C]);if(E){E.foreach(function(J,K,I){D.get(C).addItem({value:K.uniqName,text:K.caption,clazz:K.clazz,fixed:K.fixed,align:K.align})})}};g.$refreshStatus=function(){var q=this._mMetaConditionModel.getStatusWrap();this._uIndSrc.setState({disable:q.indMetas.disabledMetaNames,selected:q.indMetas.selectedMetaNames});this._uDimSrc.setState({disable:q.dimMetas.disabledMetaNames,selected:q.dimMetas.selectedMetaNames})};g.enable=function(q){e.remove(this,q);if(e.size(this)==0&&this._bDisabled){this._uIndSrc&&this._uIndSrc.enable();this._uDimSrc&&this._uDimSrc.enable();this._oSelLineWrap.foreach(function(C,D,B){D.enable()})}j.superClass.enable.call(this)};g.disable=function(q){e.add(this,q);if(!this._bDisabled){this._uIndSrc&&this._uIndSrc.disable();this._uDimSrc&&this._uDimSrc.disable();this._oSelLineWrap.foreach(function(C,D,B){D.disable()})}j.superClass.disable.call(this)};g.$handleSelLineChange=function(){var B={};this._oSelLineWrap.foreach(function(C,E,D){B[C]=E.getValue()});var q=this._mMetaConditionModel.diffSelected(B);this._mMetaConditionModel.sync({datasourceId:"SELECT",args:{uniqNameList:B[name],changeWrap:q}})};g.$handleItemClick=function(C,D,B){var q=this._mMetaConditionModel.getMetaItem(B.value);if(q&&q.clazz=="DIM"){x().open("EDIT",{uniqName:B.value,reportType:this._sReportType,selLineName:C,dimMode:q.isTimeDim?"TIME":"NORMAL",commonParamGetter:this._fCommonParamGetter})}else{}};g.$handleMetaError=function(){};g.$handleSelectError=function(){}})();$namespace("di.shared.ui");(function(){var h=di.config.Dict;var d=di.helper.Util;var m=di.helper.Dialog;var k=xutil.object.inheritsObject;var e=xutil.dom.addClass;var c=d.ecuiDispose;var n=xutil.object.extend;var l=xutil.object.assign;var i=xutil.dom.q;var s=xutil.fn.bind;var b=xutil.object.objKey;var r=xutil.string.template;var g=d.ecuiCreate;var f=xutil.LinkedHashMap;var j=xutil.uid.getIncreasedUID;var t=di.shared.ui.InteractEntity;var a=$namespace().OlapMetaConfig=k(t);var p=a.prototype;p.DEF={exportHandler:{sync:{datasourceId:"DATA"},clear:{}},className:"olap-meta-config",model:{clzPath:"di.shared.model.OlapMetaConfigModel"}};p.$createModelInitOpt=function(q){return{reportType:q.reportType}};p.$createView=function(q){this._bNeedShowCalcInds=q.needShowCalcInds||false;var u=this._oDatasourceId=q.datasourceId||{};u.DATA=u.DATA||"DATA";u.SELECT=u.SELECT||"SELECT";this._sSubmitMode=q.submitMode;this._uOlapMetaSelector=this.$di("vuiCreate","main")};p.init=function(){this.getModel().attach(["sync.preprocess.DATA",this.$syncDisable,this,"DATA"],["sync.result.DATA",this.$renderMain,this],["sync.error.DATA",this.$handleMetaError,this],["sync.complete.DATA",this.$syncEnable,this,"DATA"]);this.getModel().attach(["sync.preprocess.SELECT",this.$syncDisable,this,"SELECT"],["sync.result.SELECT",this.$handleSelected,this],["sync.error.SELECT",this.$handleSelectError,this],["sync.complete.SELECT",this.$syncEnable,this,"SELECT"]);this.getModel().attach(["sync.preprocess.LIST_SELECT",this.$syncDisable,this,"LIST_SELECT"],["sync.result.LIST_SELECT",this.$handleSelected,this],["sync.error.LIST_SELECT",this.$handleSelectError,this],["sync.complete.LIST_SELECT",this.$syncEnable,this,"LIST_SELECT"]);this._uOlapMetaSelector.$di("addEventListener","change",this.$handleChange,this);this._uOlapMetaSelector.init();this.getModel().init()};p.dispose=function(){this._uOlapMetaSelector&&this._uOlapMetaSelector.dispose();this.getModel()&&this.getModel().dispose();a.superClass.dispose.call(this)};p.sync=function(){var q=this._oDatasourceId.DATA;this.$sync(this.getModel(),q,{needShowCalcInds:this._bNeedShowCalcInds},this.$di("getEvent"))};p.clear=function(){};p.$renderMain=function(y,w,u){var x=this;var v=this.$di("getEl");var q=this._sSubmitMode=="IMMEDIATE";this._uOlapMetaSelector.$di("setData",{inddim:this.getModel().getIndDim(),selLineDataWrap:this.getModel().getSelLineWrap(),model:this.getModel(),rule:{forbidColEmpty:q,forbidRowEmpty:q}},{diEvent:this.$diEvent(u)});this._uOlapMetaSelector.$di("updateData",this.getModel().getUpdateData())};p.$handleSelected=function(){this._uOlapMetaSelector.$di("updateData",this._mModel.getUpdateData());if(this._sSubmitMode=="IMMEDIATE"){this.$di("dispatchEvent","submit")}};p.$handleChange=function(u){var q=this._oDatasourceId.SELECT;this.$sync(this._mModel,q,null,null,q=="LIST_SELECT"?{selected:u}:{uniqNameList:u[name],changeWrap:this._mModel.diffSelected(u),needShowCalcInds:this._bNeedShowCalcInds})};p.enable=function(){this._uOlapMetaSelector&&this._uOlapMetaSelector.$di("enable");a.superClass.enable.call(this)};p.disable=function(){this._uOlapMetaSelector&&this._uOlapMetaSelector.$di("disable");a.superClass.disable.call(this)};p.$handleMetaError=function(){this.clear();m.errorAlert()};p.$handleSelectError=function(){m.errorAlert()}})();$namespace("di.shared.ui");(function(){var c=ecui.inherits;var e=Array.prototype.slice;var f=ecui.ui.Control;var b=f.prototype;var a=$namespace().PanelPage=c(f,"panel-page",null,function(h,g){this._bVisible=true;this._aPendingUpdater=[];this._sPageId=g.pageId;this._sFromPageId=g.fromPageId});var d=a.prototype;d.$dispose=function(){this._aPendingUpdater=[];a.superClass.$dispose.call(this)};d.updateView=function(i,h,g){if(this._bVisible){i.apply(h,e.call(arguments,2))}else{this._aPendingUpdater.push({updater:i,scope:h,args:e.call(arguments,2)})}};d.getPageId=function(){return this._sPageId};d.getFromPageId=function(){return this._sFromPageId};d.setFromPageId=function(g){this._sFromPageId=g};d.active=function(){this._bVisible=true;var g;while(g=this._aPendingUpdater.shift()){g.updater.apply(g.scope,g.args)}this.$active()};d.inactive=function(){this._bVisible=false;this.$inactive()};d.$active=function(){};d.$inactive=function(){}})();$namespace("di.shared.arg");(function(){var j=xutil.lang.isObject;var f=xutil.object.extend;var c=xutil.object.getByPath;var g=xutil.object.setByPath;var d=xutil.lang.isArray;var i=di.helper.Util.formatTime;var e=di.helper.Util.parseTimeUnitDef;var k=xutil.object.assign;var h=xutil.object.merge;var b;$link(function(){b=di.shared.model.DIFactory});$namespace().ArgHandlerFactory=function(n){if(arguments.length<1){return null}var l=[];for(var m=0,p;m<arguments.length;m++){p=arguments[m];l.push([p[0],a[p[1]],p.slice(2)]);if(!l[l.length-1][1]){return null}}return function(r){for(var q=0,s;s=l[q];q++){s[1].apply(s[0],[r].concat(s[2]))}return r}};var a={};a.clear=function(n,l){if(l!=null){n[l]=void 0}else{for(var m=0;m<n.length;m++){n[m]=void 0}}};a.attr=function(n,r,q,m,l){m=String(m||0);var p=n[m];g(!q?m:(m+"."+q),j(p)?c(r,p,l):p,n,l)};a.attrArr=function(s,t,m,l,u){var r=s[0];var p=j(r)?(t?c(t,r,u):r):null;if(d(p)){for(var n=0,q;n<p.length;n++){a.attr(p,m,l,n,u)}}};a.setData=function(m,n,l){m[l||0]=n};a.mergeData=function(m,n,l){h(m[l||0],n)};a.getValue=function(n,q,t,s,m){var l=b().getEntity(q,"INS");var r=[];if(l&&l.$di){var p=l.$di("getValue");g(!s?"0":("0."+s),j(p)?c(t,p,m):p,r,m);if(j(r[0])){f(n[0]||(n[0]={}),r[0])}else{n[0]=r[0]}}};a.patchTime=function(p,n,q){var m=p[0];if(j(m)&&j(m=m[n])){var l=m.granularity;m=e(q[l],[m.start,m.end,m.range]);m.start=i(m.start,l);m.end=i(m.end,l);f(p[0][n],m)}}})();$namespace("di.shared.adapter");(function(){var g=xutil.object.extend;var d=di.helper.Util.ecuiCreate;var b=xutil.number.formatNumber;var e=ecui.ui.BeakerChart;var f=e.prototype;$namespace().BeakerChartVUIAdapter=function(i,h){return{create:c,setData:a}};function c(i,h){return d(e,i.el,null,h)}function a(l){var k=l.series||[];var h={};var p=h.beakerA={water:[]};var m=h.beakerB={water:[]};var n;for(var j=3;n=k[j];j++){p.water.push({text:n.name,value:n.data[0]})}if(n=k[2]){p.mark={text:n.name,value:n.data[0]}}if(n=k[1]){m.water.push({text:n.name,value:n.data[0]})}if(n=k[0]){h.theRate={text:n.name,value:n.data[0]!=null?b(n.data[0],"I,III.DD%",void 0,void 0,true):"-"}}h.title=l.xAxis[0].data[0];var n={width:l.width,heigth:l.height,datasource:h};return f.setData.call(this,n)}})();$namespace("di.shared.adapter");(function(){var d=di.helper.Util;var m=d.ecuiCreate;var g=d.ecuiDispose;var h=ecui.util.detachEvent;var f=ecui.util.attachEvent;var b=ecui.dispose;var a=ecui.repaint;var i=d.parseTimeUnitDef;var q=d.formatTime;var l=ecui.ui.CalendarPlus;var n;$link(function(){n=di.shared.model.GlobalModel});$namespace().CalendarPlusVUIAdapter=function(s,r){return{create:e,setData:p,getValue:c}};function e(s,r){return m(l,s.el,null,k(r))}function p(r){this.setData(k(r))}function k(v){var u=n().getDateModel().now();var x={defaultTime:["0d"],range:["-1Y","0d"]};var t=v.granularities||{D:x,W:x,M:x,Q:x};var w={types:[],range:{},defaults:{}};var y={D:"day",W:"week",M:"month",Q:"quarter",Y:"year"};var s;for(var r in t){w.types.push(r);s=t[r];w.defaults[y[r]]=j(i(s.defaultTime,[u,u]),r).start;w.range[y[r]]=j(i(s.range,[u,u])||{},r)}return w}function j(s,t){for(var r in s){s[r]=q(s[r],t)}return s}function c(){var r=this.getDate();return{start:r.date,end:r.date,granularity:r.type}}})();$namespace("di.shared.adapter");(function(){var f=di.helper.Util.ecuiCreate;var g=xutil.date.dateToString;var b=xutil.lang.isArray;var e=di.config.Dict;$namespace().EcuiInputTreeVUIAdapter=function(i,h){return{create:d,setData:a,getValue:c}};function d(j,h){h.hideCancel=true;h.asyn=true;var i=f(j.clz,j.el,null,h);i.$di("registerEventAgent","async");i.onloadtree=function(l,k){i.$di("dispatchEvent","async",[l,function(m){k((m.datasource||{}).children||[])}])};i._uLayer.getOuter().setAttribute(e.TEST_ATTR,j.id);return i}function a(h){if(!h){return}this.setData({root:h.datasource,selected:b(h.value)?h.value[0]:(h.value||(h.datasource||{}).value)},{hideCancel:h.hideCancel==null?true:h.hideCancel,asyn:h.asyn==null?true:h.asyn})}function c(){var h=this.getValue();return h?[h.value]:[]}})();$namespace("di.shared.adapter");(function(){var b=di.helper.Util;var a=b.ecuiCreate;$namespace().EcuiInputVUIAdapter=function(d,c){return{}}})();$namespace("di.shared.adapter");(function(){var c=di.config.Dict;$namespace().EcuiSelectVUIAdapter=function(e,d){return{setData:a,getValue:b}};function a(g){g=g||{};var d=g.datasource||[];var f=(g.value&&g.value[0])||(d[0]&&d[0].value);this.setValue(null);while(this.remove(0)){}for(var e=0,h;h=d[e];e++){this.add(String(h.text!=null?h.text:""),null,{value:h.value})}f!=null&&this.setValue(f)}function b(){var d=this.getValue();return d==null?[]:[d]}})();$namespace("di.shared.adapter");(function(){var d=xutil.object.extend;var b=di.helper.Util.ecuiCreate;$namespace().EcuiSuggestVUIAdapter=function(f,e){return{create:a,getValue:c[e.valueType||"TEXT"]}};function a(g,e){var f=b(g.clz,g.el,null,e);f.$di("registerEventAgent","async");f.onquery=function(h){f.$di("dispatchEvent","async",[(h||{}).text,function(i){f.update(i.datasource||[])}])};return f}var c={TEXT:function(){return(this.getValue()||{}).text||""},VALUE:function(){return(this.getValue()||{}).value||""}}})();$namespace("di.shared.adapter");(function(){var c=di.helper.Util;var f=xutil.object.extend;$namespace().GeneralAdapterMethod={ecuiCreate:a,ecuiDispose:b,xuiCreate:e,xuiDispose:d};function a(h,g){return c.ecuiCreate(h.clz,h.el,null,g)}function b(){c.ecuiDispose(this)}function e(h,g){return new h.clz(g)}function d(){this.dispose&&this.dispose()}})();$namespace("di.shared.adapter");(function(){var d=di.helper.Util;var b=d.parseTimeUnitDef;var f=d.formatTime;var e=xutil.date.dateToString;var c;$link(function(){c=di.shared.model.GlobalModel});$namespace().HChartVUIAdapter=function(h,g){return{setData:a}};function a(m){var k=c().getDateModel().now();if(m.weekViewRange){var j=b(m.weekViewRange,[k,k]);if(j){var h="yyyy-MM-dd";j[0]=j.start?e(j.start,h):null;j[1]=j.end?e(j.end,h):null;for(var l=0,g;g=(m.xAxis||[])[l];l++){g.range=j}}}this.setData(m)}})();$namespace("di.shared.adapter");(function(){var g=di.helper.Util;var f=g.ecuiCreate;var h=xutil.date.dateToString;var d=g.parseTimeUnitDef;var b=xutil.object.assign;var e;$link(function(){e=di.shared.model.GlobalModel});$namespace().IstCalendarVUIAdapter=function(j,i){return{create:c,getValue:a}};function c(m,k){var j=e().getDateModel().now();var l={};l.now=j.getTime();var n=d(k.defaultTime,[j,j]);l.date=n.start;l.dateEnd=n.end;var i=d(k.range,[j,j]);l.start=i.start;l.end=i.end;b(l,k,["mode","viewMode","shiftBtnDisabled"]);return f(m.clz,m.el,null,l)}function a(){var i=h(this.getDate());if(this.getMode()=="RANGE"){return{start:i,end:h(this.getDateEnd())}}else{return{start:i,end:i}}}})();$namespace("di.shared.adapter");(function(){var h=xutil.date.dateToString;var a=xutil.lang.isArray;var d=di.helper.Util.ecuiCreate;var c=di.config.Dict;$namespace().MetaConfigVUIAdapter=function(j,i){var k=j.clzKey;return{create:g[k],setData:f[k],updateData:e[k]}};var g={OLAP_META_DRAGGER:function b(k,j){var i=new k.clz(j);i.$di("registerEventAgent","change");i.attach("sellinechange",function(l){i.$di("dispatchEvent","change",[l])});return i},OLAP_META_IND_SELECT:function b(k,j){var i=d(k.clz,k.el,null,j);i.$di("registerEventAgent","change");i.onchange=function(l){i.$di("dispatchEvent","change",[i.getValue()])};i.$mousewheel=new Function();return i}};var f={OLAP_META_DRAGGER:function(i){this.setData(i)},OLAP_META_IND_SELECT:function(n){var j=n.inddim.indList;var k=[];var m;if(j){j.foreach(function(i,r,q){if(r.status!=c.META_STATUS.DISABLED){k.push({text:r.caption,value:r.uniqName})}if(r.status==c.META_STATUS.SELECTED){m=r.uniqName}})}this.setValue(null);while(this.remove(0)){}for(var l=0,p;p=k[l];l++){this.add(String(p.text!=null?p.text:""),null,{value:p.value})}m!=null&&this.setValue(m)}};var e={OLAP_META_DRAGGER:function(i){this.refreshStatus(i)},OLAP_META_IND_SELECT:function(i){}}})();$namespace("di.shared.adapter");(function(){var h=di.helper.Util;var k=h.ecuiCreate;var d=h.ecuiDispose;var c=ecui.util.detachEvent;var n=ecui.util.attachEvent;var l=ecui.dispose;var a=ecui.repaint;var i=h.parseTimeDef;var r=h.formatTime;var p=ecui.ui.XCalendar;var m=xutil.object.assign;var q=xutil.object.clone;var e;$link(function(){e=di.shared.model.GlobalModel});$namespace().XCalendarVUIAdapter=function(v,u){return{create:j,setData:f,getValue:b}};function j(v,u){return k(p,v.el,null,g(u))}function f(u){this.setDatasource(t(u))}function g(u){var v=m({},u,["viewMode","headText","rangeLinkStr","weekLinkStr","blankText","forbidEmpty"]);v.timeTypeList=[];return v}function t(D){var w=e().getDateModel().now();var v=q(D);var A=D.timeTypeOpt;var C;var x;var y;var z;var B;var u;v.timeTypeOpt=v.timeTypeOpt||{};for(C in A){x=v.timeTypeOpt[C]=A[C];z=i(x.date,[w,w]);if(z.length>1){x.date=[];for(y=0;B=z[y];y++){x.date.push(s(B,C).start)}}else{B=s(z[0],C);x.date=B.end?[B.start,B.end]:[B.start]}x.range=s(i(x.range,[w,w])||{},C);x.range.offsetBase=w}return v}function s(w,v){for(var u in w){w[u]=r(w[u],v)}return w}function b(){var v=this.getValue();var u=this.getTimeType();return{start:r(v[0],u),end:r(v[1]||v[0],u),granularity:u}}})();$namespace("di.console.shared.model");(function(){var y=di.helper.Formatter;var h=di.config.Dict;var d=di.config.Lang;var c=di.config.URL;var e=di.helper.Util;var m=xutil.object.inheritsObject;var j=xutil.dom.q;var w=xutil.dom.g;var z=xutil.fn.bind;var x=xutil.object.extend;var s=xutil.object.assign;var l=baidu.json.parse;var p=baidu.json.stringify;var b=xutil.lang.hasValue;var k=xutil.date.stringToDate;var r=xutil.date.dateToString;var v=xutil.url.textParam;var n=xutil.url.wrapArrayParam;var f=xutil.LinkedHashMap;var i=xui.XDatasource;var u=$namespace().ChartConfigModel=m(i,t);var a=u.prototype;function t(g){}a.init=function(){};a.url=new i.Set({INIT:c("OLAP_CHART_BASE_CONFIG_INIT"),SUBMIT:c("OLAP_CHART_BASE_CONFIG_INIT")});a.param=new i.Set({INIT:function(g){return""}});a.parse=new i.Set({INIT:function(g){}})})();$namespace("di.console.shared.ui");(function(){var z=di.config.URL;var n=di.helper.Dialog;var w=di.helper.Util;var C=di.config.Dict;var s=di.config.Lang;var t=ecui.dom.addClass;var k=ecui.dom.removeClass;var J=ecui.dom.create;var D=ecui.dom.getStyle;var I=ecui.triggerEvent;var E=ecui.dispose;var h=w.ecuiCreate;var d=w.disposeInnerControl;var f=xutil.string.template;var G=xutil.dom.q;var u=xutil.object.createSingleton;var p=xutil.lang.hasValueNotBlank;var i=xutil.object.extend;var H=xutil.object.assign;var B=xutil.string.textLength;var r=xutil.string.textSubstr;var A=xutil.date.stringToDate;var a=xutil.string.trim;var e=xutil.fn.bind;var l=xui.XView;var L=ecui.ui.Textarea;var b=ecui.ui.Input;var K=ecui.ui.Form;var c=ecui.ui.Button;var v=ecui.ui.IndTree;var y=ecui.ui.IstCalendar;var g=di.shared.ui.BaseConfigPanel;var j;$link(function(){j=di.console.shared.model.ChartConfigModel});var x=$namespace().ChartConfigPanel=u(g);var F=x.prototype;var m=['<div class="di-dim-select-cal">','<div class="q-calendar"></div>',"</div>"].join("");F.PANEL_TITLE="图设置";F.$doCreateView=function(q){};F.$doCreateModel=function(q){this._mModel=new j()};F.$doInit=function(){};F.$doGetInnerTPL=function(q){return"asdfsadfasdfsadfsadfasdfsadfasdfsa"};F.$doResetInput=function(){};F.$doRender=function(){};F.$doEnable=function(){};F.$doDisable=function(){};F.$doGetSubmitArgs=function(){}})();$namespace("di.console.shared.ui");(function(){var r=ecui,q=r.dom,a=r.util,k=r.ui,n=r.inherits,e,l,j,c,b,s,t,f,g=k.Control;$link(function(){e=r.$fastCreate;l=r.dispose;j=q.create;b=q.setStyle;c=q.getStyle;s=a.extend;t=r.xstring.template;f=di.config.URL});var i=$namespace().GlobalMenu=n(g,"global-menu",null,function(v,u){v.innerHTML=t(m,{type:this.getType()});this._eInner=v.firstChild;this._aItems=[];this._uCurrSel}),p=i.prototype,h=(p.Item=n(g,"global-menu-item",null,function(w,u){var x=u.data,v=u.parent,y=u.selMenu;b(w,"display","inline-block");w.innerHTML=t(d,{type:this.getType(),text:x.menuName,url:f.WEB_ROOT+x.menuUrl});if(y.menuId==(this._sMenuId=x.menuId)){v._uCurrSel=this;this.alterClass("+selected")}})).prototype;var m='<div class="#{type}-items"></div>',d='<a href="#{url}" target="_blank"><div class="#{type}-ledge"></div><div class="#{type}-text">#{text}</div><div class="#{type}-redge"></div></a>';p.init=function(){this.$resetItems()};p.$dispose=function(){this._aCurrSel=null;this.$disposeItems();i.superClass.$dispose.call(this)};p.$resetItems=function(){var u,z,v,y,w,x;this._aCurrSel=null;this.$disposeItems();u=this._mGlobalMenuManager.getMenuData();z=this._mGlobalMenuManager.getSelected();for(v=0;y=u[v];v++){this._eInner.appendChild(w=j("global-menu-item"));this._aItems.push(x=e(this.Item,w,this,{data:y,selMenu:z,parent:this}))}};p.$disposeItems=function(){var u,v;for(u=0;v=this._aItems[u];u++){v.dispose()}this._aItem=[];this._eInner.innerHTML=""}})();$namespace("di.console.shared.ui");(function(){var k=xutil.object.inheritsObject;var i=xutil.dom.q;var c=ecui.util.ref;var a=ecui.util.preInit;var d=ecui.$fastCreate;var v=xutil.string.template;var b=xui.XView;var t=ecui.ui.PlFloatMenu;var m=ecui.ui.TabContainer;var g=di.config.Dict;var e=di.config.URL;var p;var j;var f;$link(function(){var q=di.shared;p=q.model.MenuPageManager;j=q.model.PanelPageManager;f=q.model.PanelPageTabAdapter});var n=$namespace().MenuMainPage=k(b,function(q){s.call(this,q);h.call(this,q);r.call(this,q)});var u=n.prototype;var l='<div class="main-left"><div class="ui-menu q-menu"><label>&nbsp;</label></div></div><div class="main-right"><div class="ui-tab q-main"></div></div><div class="clear"></div>';function s(q){this._eMain=q.el;this._eMain.innerHTML=v(l)}function h(q){this._mMenuPageManager=new p();this._mPanelPageManager=new j({adapter:f})}function r(q){this._uMenu=d(t,i("q-menu",this._eMain)[0],null);this._uMainContainer=d(m,i("q-main",this._eMain)[0],null,{primary:"ui-tab"})}u.init=function(){n.superClass.init.call(this);c(this._mMenuPageManager,"menu",this._uMenu);c(this._mPanelPageManager,"panelPageContainer",this._uMainContainer);c(this._mMenuPageManager,"panelPageManager",this._mPanelPageManager);this._mMenuPageManager.init();this._mPanelPageManager.init();this._mMenuPageManager.sync()};u.dispose=function(){this._mMenuPageManager.dispose();this._mPanelPageManager.dispose();this._eMain=null;n.superClass.$dispose.call(this)}})();$namespace("di.console.model");(function(){var y=di.helper.Formatter;var h=di.config.Dict;var d=di.config.Lang;var c=di.config.URL;var e=di.helper.Util;var m=xutil.object.inheritsObject;var j=xutil.dom.q;var w=xutil.dom.g;var z=xutil.fn.bind;var x=xutil.object.extend;var t=xutil.object.assign;var l=baidu.json.parse;var r=baidu.json.stringify;var b=xutil.lang.hasValue;var k=xutil.date.stringToDate;var s=xutil.date.dateToString;var v=xutil.url.textParam;var p=xutil.url.wrapArrayParam;var f=xutil.LinkedHashMap;var i=xui.XDatasource;var a=$namespace().OLAPEditorModel=m(i,u);var n=a.prototype;function u(g){this._sReportType=g.reportType||"TABLE";this._sSchemaName=g.schemaName;this._sCubeTreeNodeName=g.cubeTreeNodeName;this._sReportTemplateId}n.init=function(){};n.url=new i.Set({INIT:c("OLAP_REPORT_INIT")});n.param=new i.Set({INIT:function(g){var q=[];q.push("schemaName="+v(this._sSchemaName));q.push("treeNodeName="+v(this._sCubeTreeNodeName));return q.join("&")}});n.parse=new i.Set({INIT:function(g){this._sReportTemplateId=g?g.reportTemplateId:""}});n.getBaseWrap=function(){return{reportType:this._sReportType,reportTemplateId:this._sReportTemplateId,schemaName:this._sSchemaName,cubeTreeNodeName:this._sCubeTreeNodeName}};n.setReportTemplateId=function(g){this._sReportTemplateId=g}})();$namespace("di.console.editor.ui");(function(){var E=di.config.Dict;var y=di.helper.Util;var v=di.helper.Dialog;var w=di.config.Lang;var i=ecui.inherits;var x=ecui.dom.addClass;var p=ecui.dom.removeClass;var L=ecui.addEventListener;var I=ecui.dom.create;var G=ecui.dom.getStyle;var n=xutil.object.extend;var c=xutil.object.objKey;var H=xutil.dom.q;var f=xutil.fn.bind;var g=xutil.string.template;var k=y.preInit;var a=xutil.url.stringifyParam;var l=ecui.$fastCreate;var j=di.shared.ui.PanelPage;var t=xutil.url.textParam;var h=ecui.ui.Control;var e=ecui.ui.Button;var B=ecui.ui.Select;var K;var r;var s;var b;var A;var z;var D;$link(function(){D=di.shared.model.DIFactory;r=di.shared.ui.MetaCondition;K=di.shared.model.PanelPageManager;s=di.console.model.OLAPEditorModel;b=di.shared.ui.DITable;A=di.shared.ui.DIChart;z=di.console.shared.ui.ChartConfigPanel});var d=$namespace().OLAPEditor=i(j,"olap-editor",function(M,q){k(this,M,q);M.innerHTML=m},function(M,q){F.call(this,M,q);u.call(this,M,q)});var C=d.prototype;var m=['<div class="olap-editor-meta-condition q-di-meta-condition">',"</div>",'<div class="olap-editor-data">','<div class="olap-editor-operation q-di-operation">',"</div>",'<div class="olap-editor-data q-di-data">',"</div>","</div>"].join("");var J=['<div class="q-di-table-area di-table-area">','<div class="q-di-breadcrumb"></div>','<div class="q-di-table"></div>',"</div>"].join("");C.$setSize=new Function();function F(M,q){this._sReportType=q.reportType||"TABLE";this._mOLAPEditorModel=new s({reportType:this._sReportType,schemaName:q.schemaName,cubeTreeNodeName:q.cubeTreeNodeName})}function u(O,T){var S=this._mOLAPEditorModel;function P(U){var V={reportTemplateId:t(S.getBaseWrap().reportTemplateId)};n(V,U);return a(V).join("&")}P.update=function(U){var V=U&&U.reportTemplateId||null;if(V){S.setReportTemplateId(V)}};this._uMetaCondition=new r({el:H("q-di-meta-condition",O)[0],reportType:this._sReportType,commonParamGetter:P});this._mMetaConditionModel=this._uMetaCondition.getModel();var R=H("q-di-operation",O)[0];var N=I();N.innerHTML='<div class="ui-button-g ui-button">查询</div>';R.appendChild(N.firstChild);this._uQueryBtn=l(e,R.lastChild);N.innerHTML='<div class="ui-button-g ui-button">图设置</div>';R.appendChild(N.firstChild);this._uChartConfigBtn=l(e,R.lastChild);var Q;var q;if(this._sReportType=="TABLE"){Q=b;q="DI_TABLE"}else{if(this._sReportType=="CHART"){Q=A;q="DI_CHART"}}var M={id:"snipptEDITOR.OLAP-EDITOR-DATA-COMPONENT",el:H("q-di-data",O)[0],clzType:"COMPONENT",clzKey:q};D().addEntity(M,"DEF");M=D().getEntity(M.id,"DEF");this._uDIData=D().createIns(M,{tplMode:"SELF",commonParamGetter:P});this._mDIDataModel=this._uDIData.getModel()}C.init=function(){this._mOLAPEditorModel.attach("sync.result.INIT",this.$handleInit,this);this._mMetaConditionModel.attach(["sync.complete.META_DATA",this.enable,this,"OLAP_EDIROT"],["sync.error.META_DATA",this.$handleFatalError,this]);this._uQueryBtn.onclick=f(this.$handleQuery,this);this._uChartConfigBtn.onclick=f(this.$openChartConfig,this);this._mDIDataModel.attach(["sync.preprocess.DATA",this.disable,this,"OLAP_EDIROT"],["sync.complete.DATA",this.enable,this,"OLAP_EDIROT"]);this._uMetaCondition.init();this._uDIData.init();this.disable();this._mOLAPEditorModel.sync({datasourceId:"INIT"})};C.$dispose=function(){this._uMetaCondition&&this._uMetaCondition.dispose();d.superClass.$dispose.call(this)};C.$active=function(){};C.$inactive=function(){};C.enable=function(q){c.remove(this,q);if(c.size(this)==0&&this._bDisabled){this._uDIData.enable(q);this._uQueryBtn.enable();this._uMetaCondition.enable(q)}d.superClass.enable.call(this)};C.disable=function(q){c.add(this,q);if(!this._bDisabled){this._uDIData.disable(q);this._uQueryBtn.disable();this._uMetaCondition.disable(q)}d.superClass.disable.call(this)};C.$handleInit=function(){this._uMetaCondition.sync()};C.$handleFatalError=function(q){this.disable();if(q==1001){v.alert(w.SAD_FACE+w.PARAM_ERROR)}else{v.alert(w.SAD_FACE+w.FATAL_DATA_ERROR)}};C.$handleQuery=function(){var q=D().createDIEvent("editorfakeevent-query");D().setInteractMemo(this._uDIData,"diEvent",q);this._uDIData.sync();D().setInteractMemo(this._uDIData,"diEvent",void 0)};C.$openChartConfig=function(){z().open()}})();$namespace("di.console.editor.ui");(function(){var i=di.config.Dict;var g=di.helper.Util;var e=di.config.URL;var x=di.helper.Dialog;var f=di.config.Lang;var t=ecui.inherits;var h=ecui.dom.addClass;var k=ecui.dom.removeClass;var n=ecui.addEventListener;var j=ecui.dom.create;var c=ecui.dom.getStyle;var y=xutil.object.extend;var b=xutil.object.objKey;var p=xutil.dom.q;var B=xutil.fn.bind;var A=xutil.string.template;var a=g.preInit;var d=ecui.$fastCreate;var z=di.shared.ui.PanelPage;var v=xutil.url.textParam;var r;$link(function(){r=di.shared.model.PanelPageManager});var u=$namespace().ReportPreview=t(z,"page-preview",function(C,q){a(this,C,q);C.innerHTML=s},function(C,q){l.call(this,C,q);w.call(this,C,q)});var m=u.prototype;var s=["<p>预览</p>",'<div class="q-di-stub"></div>'].join("");m.$setSize=new Function();function l(C,q){}function w(C,q){}m.init=function(){var q=new $DataInsight$(p("q-di-stub",this.getMain())[0],{url:e("REPORT_PREVIEW"),widthMode:"FULLFILL",heightMode:"ADAPT"});q.load()};m.$dispose=function(){u.superClass.$dispose.call(this)};m.$active=function(){};m.$inactive=function(){}})();$namespace("di.console.mgr.ui");(function(){var y=ecui;var x=y.dom;var p=y.ui;var b=y.util;var w=ecui.inherits;var h=b.blank;var i=ecui.dom.addClass;var m=ecui.dom.removeClass;var r=y.addEventListener;var l=x.create;var e=x.getStyle;var B=b.extend;var s=y.xdom.q;var F=y.xfn.bind;var d=y.util.preInit;var E=y.xstring.template;var f=y.util.ref;var u=y.util.getModel;var j=di.helper.Util.ecuiCreate;var C=di.shared.ui.PanelPage;var g=p.Control;var A=p.Select;var a=p.RadioContainer;var k=di.config.Dict;var t;$link(function(){t=di.shared.model.PanelPageManager});var c=$namespace().ReportListPage=w(C,"report-list-page",function(G,q){d(this,G,q);G.innerHTML=E(v)},function(G,q){n(G,q);z(G,q)});var D=c.prototype;var v=['<div class="olap-condition">',"报表列表","</div>",'<div class="olap-table">',"表格","</div>"].join("");D.$setSize=h;function n(){}function z(G,q){}D.init=function(){};D.$active=function(){};D.$inactive=function(){};D.$dispose=function(){c.superClass.$dispose.call(this)}})();$namespace("di.console.frame.ui");(function(){var h=xutil.object.inheritsObject;var e=di.console.shared.ui.MenuMainPage;var d=di.config.Dict;var a=di.config.URL;var c;$link(function(){c=di.shared.model.CubeMetaModel});var g=$namespace().ConsoleFrame=h(e,function(i){b.call(this,i)});var f=g.prototype;function b(j){var l=this._mMenuPageManager;var i=this._mCubeMetaModel=new c();l.url=a("CUBE_META");var k=this._mMenuPageManager.parse;this._mMenuPageManager.parse=function(m){i.parse.INIT.call(i,m);var n=i.getMenuByCubeMeta();return k.call(l,n)}}})();$namespace("di.console.frame.ui");(function(){var e=xutil.object.inheritsObject;var b=xutil.dom.q;var i=xutil.object.getByPath;var p=xui.XView;var n=ecui.dom.create;var a=ecui.util.getModel;var l=di.helper.Util.ecuiCreate;var d=ecui.util.ref;var c=di.config.Dict;var f;var m;var h;$link(function(){f=di.console.shared.ui.GlobalMenu;m=di.shared.model.GlobalModel;h=di.shared.model.DIFactory});var j=$namespace().MainPage=e(p,function(q){h().installClz();g.call(this,q)});var k=j.prototype;p.$domReady=ecui.dom.ready;function g(q){var r;q=q||{};b("q-global-main")[0].appendChild(r=n());this._uGlobalMenu=l(f,b("q-global-menu")[0],null);if(q.pageClass){this._uMainContainer=new (i(q.pageClass,$getNamespaceBase()))({el:r})}}k.init=function(){j.superClass.init.call(this);m();var q=a(m(),"globalMenuManager");d(this._uGlobalMenu,"globalMenuManager",q);d(q,"globalMenu",this._uGlobalMenu);m().init();this._uGlobalMenu.init();this._uMainContainer&&this._uMainContainer.init()};k.dispose=function(){m().dispose();j.superClass.$dispose.call(this)}})();xui.XProject.doLink();xui.XProject.doEnd();