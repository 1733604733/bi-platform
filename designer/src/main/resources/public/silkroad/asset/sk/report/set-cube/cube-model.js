define(["url","data-sources/list/main-model"],function(a,b){return Backbone.Model.extend({initialize:function(){var a=this;a.dataSourcesModel=new b,a.listenToOnce(a.dataSourcesModel,"change:activeDataSourcesList",function(b,c){a._mergeDataSourcesList(c)})},loadSelectedDataSources:function(b){var c=this;$.ajax({url:a.loadSelectedDataSources(c.id),success:function(a){c.selectedDsId=a.data.selected,b()}})},loadFactTableList:function(a,b){var c=this,d=this.selectedDsId,e={};c.dataSourcesModel.loadTables(a,d,function(a){b?c.loadReportFactTableList(a):a.length>=0&&(e={factTables:a},c.set({factTableList:e},{silent:!0}),c.trigger("change:factTableList",c,e))})},loadReportFactTableList:function(b){var c=this,d={};$.ajax({url:a.loadReportFactTableList(c.id),success:function(a){d.prefixs=a.data.prefixs,d.factTables=c._mergeFactTablesList(b,a.data.selected),c.set({factTableList:d})}})},_mergeFactTablesList:function(a,b){for(var c=0,d=a.length;d>c;c++)for(var e=0,f=b.length;f>e;e++)a[c].id==b[e]&&(a[c].selected=!0);return a},_mergeDataSourcesList:function(a){var b=this,c=b.selectedDsId;if(void 0!==c){for(var d=0,e=a.length;e>d;d++)if(a[d].active.id==c){a[d].active.selected=!0;break}}else a.length>0&&(b.set("dsId",a[0].active.id),a[0].active.selected=!0,this.selectedDsId=a[0].active.id,b.loadFactTableList(a[0].id));b.set("activeDataSourcesList",a)},submit:function(b,c){var d=this;$.ajax({url:a.submitCubeSetInfo(d.id),type:"PUT",data:b,success:function(){c()}})}})});